<!doctype html>
<html lang="es">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>Configuración - Sistema de Evaluación Psicométrica</title>
    <!-- CSS Files - CDN -->
    <link href="https://cdn.jsdelivr.net/npm/@tabler/core@1.4.0/dist/css/tabler.min.css" rel="stylesheet" />
    <link href="https://cdn.jsdelivr.net/npm/@tabler/core@1.4.0/dist/css/tabler-flags.min.css" rel="stylesheet" />
    <link href="https://cdn.jsdelivr.net/npm/@tabler/core@1.4.0/dist/css/tabler-payments.min.css" rel="stylesheet" />
    <link href="https://cdn.jsdelivr.net/npm/@tabler/core@1.4.0/dist/css/tabler-vendors.min.css" rel="stylesheet" />
    <style>
      @import url("https://rsms.me/inter/inter.css");
      :root {
        --tblr-font-sans-serif: 'Inter Var', -apple-system, BlinkMacSystemFont, San Francisco, Segoe UI, Roboto, Helvetica Neue, sans-serif;
      }
      body {
        font-feature-settings: "cv03", "cv04", "cv11";
      }
      .nav-tabs .nav-link {
        color: var(--tblr-muted);
        border: none;
        padding: 0.75rem 1rem;
        background: transparent;
        border-radius: 0.375rem;
        transition: all 0.15s ease;
      }
      .nav-tabs .nav-link:hover {
        background: var(--tblr-bg-surface-secondary);
        border-color: transparent;
      }
      .nav-tabs .nav-link.active {
        color: var(--tblr-primary);
        background: var(--tblr-primary-lt);
        border-color: transparent;
      }
      .settings-card {
        border: 1px solid var(--tblr-border-color);
        border-radius: 0.5rem;
        background: var(--tblr-bg-surface);
      }
      .settings-section {
        border-bottom: 1px solid var(--tblr-border-color-light);
        padding: 1.5rem;
      }
      .settings-section:last-child {
        border-bottom: none;
      }
      .form-check-input:checked {
        background-color: var(--tblr-primary);
        border-color: var(--tblr-primary);
      }
      .preview-box {
        background: var(--tblr-bg-surface-secondary);
        border: 1px dashed var(--tblr-border-color);
        border-radius: 0.375rem;
        padding: 1rem;
        text-align: center;
        color: var(--tblr-muted);
      }
      .color-picker-wrapper {
        display: flex;
        align-items: center;
        gap: 0.5rem;
      }
      .color-picker {
        width: 40px;
        height: 40px;
        border: 2px solid var(--tblr-border-color);
        border-radius: 0.375rem;
        cursor: pointer;
        padding: 0;
        background: none;
      }
      .theme-preview-container {
        display: flex;
        gap: 1rem;
        justify-content: center;
      }
      .theme-preview-card {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 0.5rem;
        cursor: pointer;
        padding: 0.5rem;
        border-radius: 0.375rem;
        transition: background 0.15s ease;
      }
      .theme-preview-card:hover {
        background: var(--tblr-bg-surface-secondary);
      }
      .theme-preview-light {
        width: 60px;
        height: 40px;
        background: linear-gradient(135deg, #ffffff 50%, #f8f9fa 50%);
        border: 1px solid #dee2e6;
        border-radius: 0.375rem;
        position: relative;
      }
      .theme-preview-light::after {
        content: '';
        position: absolute;
        top: 4px;
        left: 4px;
        width: 12px;
        height: 12px;
        background: #206bc4;
        border-radius: 2px;
      }
      .theme-preview-dark {
        width: 60px;
        height: 40px;
        background: linear-gradient(135deg, #232e3c 50%, #1a1f2e 50%);
        border: 1px solid #495057;
        border-radius: 0.375rem;
        position: relative;
      }
      .theme-preview-dark::after {
        content: '';
        position: absolute;
        top: 4px;
        left: 4px;
        width: 12px;
        height: 12px;
        background: #74b3f7;
        border-radius: 2px;
      }
      .color-preview-section {
        border: 1px solid var(--tblr-border-color);
        border-radius: 0.5rem;
        padding: 1rem;
        background: var(--tblr-bg-surface-secondary);
      }
      .color-preview-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 1rem;
        margin-bottom: 1rem;
      }
      .color-preview-item {
        text-align: center;
      }
      .color-preview-btn {
        width: 100%;
        pointer-events: none;
      }
      .color-preview-alert {
        margin: 0;
        pointer-events: none;
      }
    </style>
    <script>
      // Theme detection and initialization
      (function() {
        const theme = localStorage.getItem('theme') || 'light';
        document.documentElement.setAttribute('data-bs-theme', theme);
      })();
    </script>
  </head>
  <body>
    <script src="https://cdn.jsdelivr.net/npm/@tabler/core@1.4.0/dist/js/demo-theme.min.js"></script>
    <script>
      // Update theme toggle icon based on current theme
      function updateThemeToggleIcon() {
        const currentTheme = localStorage.getItem('theme') || 'light';
        const themeIcon = document.querySelector('.theme-toggle-icon');

        if (!themeIcon) return;

        // Clear existing paths
        themeIcon.innerHTML = '<path stroke="none" d="M0 0h24v24H0z" fill="none"/>';

        if (currentTheme === 'dark') {
          // Moon icon for dark mode
          themeIcon.innerHTML += '<path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />';
        } else {
          // Sun icon for light mode
          themeIcon.innerHTML += '<path d="M12 12m-4 0a4 4 0 1 0 8 0a4 4 0 1 0 -8 0" />';
          themeIcon.innerHTML += '<path d="M3 12h1m8 -9v1m8 8h1m-9 8v1m-6.4 -15.4l.7 .7m12.1 -.7l-.7 .7m0 11.4l.7 .7m-12.1 -.7l-.7 .7" />';
        }
      }

      // Theme switcher
      document.addEventListener('DOMContentLoaded', function() {
        const currentTheme = localStorage.getItem('theme') || 'light';
        document.body.setAttribute('data-bs-theme', currentTheme);

        // Update theme toggle icon on page load
        updateThemeToggleIcon();

        // Update theme dropdown
        document.querySelectorAll('[data-bs-theme-value]').forEach(item => {
          item.addEventListener('click', function(e) {
            e.preventDefault();
            const newTheme = this.getAttribute('data-bs-theme-value');
            localStorage.setItem('theme', newTheme);
            document.documentElement.setAttribute('data-bs-theme', newTheme);
            document.body.setAttribute('data-bs-theme', newTheme);
            // Update the icon after theme change
            updateThemeToggleIcon();
          });
        });
      });
    </script>
    <div class="page">
      <!-- Navbar -->
      <header class="navbar navbar-expand-md d-print-none">
        <div class="container-xl">
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar-menu">
            <span class="navbar-toggler-icon"></span>
          </button>
          <h1 class="navbar-brand navbar-brand-autodark d-none-navbar-horizontal pe-0 pe-md-3">
            <a href="./dashboard.html">
              Sistema de Evaluación Psicométrica
            </a>
          </h1>
          <div class="navbar-nav flex-row order-md-last">
            <!-- Dark/Light Mode Toggle -->
            <div class="nav-item dropdown d-none d-md-flex me-3">
              <a href="#" class="nav-link px-0" data-bs-toggle="dropdown" tabindex="-1" aria-label="Toggle theme">
                <svg xmlns="http://www.w3.org/2000/svg" class="icon theme-toggle-icon" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
                  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                  <path d="M12 12m-4 0a4 4 0 1 0 8 0a4 4 0 1 0 -8 0" />
                  <path d="M3 12h1m8 -9v1m8 8h1m-9 8v1m-6.4 -15.4l.7 .7m12.1 -.7l-.7 .7m0 11.4l.7 .7m-12.1 -.7l-.7 .7" />
                </svg>
              </a>
              <div class="dropdown-menu dropdown-menu-end dropdown-menu-arrow">
                <a href="#" class="dropdown-item" data-bs-theme-value="light">
                  <svg xmlns="http://www.w3.org/2000/svg" class="icon dropdown-item-icon" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none">
                    <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                    <path d="M12 12m-4 0a4 4 0 1 0 8 0a4 4 0 1 0 -8 0" />
                    <path d="M3 12h1m8 -9v1m8 8h1m-9 8v1m-6.4 -15.4l.7 .7m12.1 -.7l-.7 .7m0 11.4l.7 .7m-12.1 -.7l-.7 .7" />
                  </svg>
                  Modo Claro
                </a>
                <a href="#" class="dropdown-item" data-bs-theme-value="dark">
                  <svg xmlns="http://www.w3.org/2000/svg" class="icon dropdown-item-icon" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none">
                    <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                    <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
                  </svg>
                  Modo Oscuro
                </a>
                <a href="#" class="dropdown-item" data-bs-theme-value="auto">
                  <svg xmlns="http://www.w3.org/2000/svg" class="icon dropdown-item-icon" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none">
                    <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                    <path d="M3 5a2 2 0 0 1 2 -2h14a2 2 0 0 1 2 2v14a2 2 0 0 1 -2 2h-14a2 2 0 0 1 -2 -2v-14z" />
                    <path d="M6 8h.01" />
                    <path d="M9 8h.01" />
                    <path d="M12 8h.01" />
                    <path d="M6 11h.01" />
                    <path d="M9 11h.01" />
                    <path d="M12 11h.01" />
                    <path d="M6 14h.01" />
                    <path d="M9 14h.01" />
                    <path d="M12 14h.01" />
                  </svg>
                  Automático
                </a>
              </div>
            </div>
            <div class="nav-item dropdown">
              <a href="#" class="nav-link d-flex lh-1 text-reset p-0" data-bs-toggle="dropdown">
                <span class="avatar avatar-sm" style="background-image: url(../Tabler/tabler-1.4.0/dashboard/dist/static/avatars/000m.jpg)"></span>
                <div class="d-none d-xl-block ps-2">
                  <div>Admin</div>
                  <div class="mt-1 small text-muted">Recursos Humanos</div>
                </div>
              </a>
              <div class="dropdown-menu dropdown-menu-end dropdown-menu-arrow">
                <a href="./configuracion.html" class="dropdown-item">Configuración</a>
                <div class="dropdown-divider"></div>
                <a href="login.html" class="dropdown-item">Cerrar sesión</a>
              </div>
            </div>
          </div>
        </div>
      </header>
      <!-- Navigation -->
      <header class="navbar-expand-md">
        <div class="collapse navbar-collapse" id="navbar-menu">
          <div class="navbar navbar-light">
            <div class="container-xl">
              <ul class="navbar-nav">
                <li class="nav-item">
                  <a class="nav-link" href="dashboard.html">
                    <span class="nav-link-icon d-md-none d-lg-inline-block">
                      <svg xmlns="http://www.w3.org/2000/svg" class="icon" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
                        <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                        <polyline points="5 12 3 12 12 3 21 12 19 12" />
                        <path d="M5 12v7a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-7" />
                        <path d="M9 21v-6a2 2 0 0 1 2 -2h2a2 2 0 0 1 2 2v6" />
                      </svg>
                    </span>
                    <span class="nav-link-title">Dashboard</span>
                  </a>
                </li>
                <li class="nav-item">
                  <a class="nav-link" href="candidatos.html">
                    <span class="nav-link-icon d-md-none d-lg-inline-block">
                      <svg xmlns="http://www.w3.org/2000/svg" class="icon" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
                        <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                        <circle cx="9" cy="7" r="4" />
                        <path d="M3 21v-2a4 4 0 0 1 4 -4h4a4 4 0 0 1 4 4v2" />
                        <path d="M16 3.13a4 4 0 0 1 0 7.75" />
                        <path d="M21 21v-2a4 4 0 0 0 -3 -3.87" />
                      </svg>
                    </span>
                    <span class="nav-link-title">Candidatos</span>
                  </a>
                </li>
                <li class="nav-item">
                  <a class="nav-link" href="./reportes.html">
                    <span class="nav-link-icon d-md-none d-lg-inline-block">
                      <svg xmlns="http://www.w3.org/2000/svg" class="icon" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
                        <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                        <path d="M3 12m0 1a1 1 0 0 1 1 -1h4a1 1 0 0 1 1 1v6a1 1 0 0 1 -1 1h-4a1 1 0 0 1 -1 -1z" />
                        <path d="M9 8m0 1a1 1 0 0 1 1 -1h4a1 1 0 0 1 1 1v10a1 1 0 0 1 -1 1h-4a1 1 0 0 1 -1 -1z" />
                        <path d="M15 4m0 1a1 1 0 0 1 1 -1h4a1 1 0 0 1 1 1v14a1 1 0 0 1 -1 1h-4a1 1 0 0 1 -1 -1z" />
                        <path d="M4 20l14 0" />
                      </svg>
                    </span>
                    <span class="nav-link-title">Reportes</span>
                  </a>
                </li>
                <li class="nav-item active">
                  <a class="nav-link" href="./configuracion.html">
                    <span class="nav-link-icon d-md-none d-lg-inline-block">
                      <svg xmlns="http://www.w3.org/2000/svg" class="icon" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
                        <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                        <path d="M10.325 4.317c.426 -1.756 2.924 -1.756 3.35 0a1.724 1.724 0 0 0 2.573 1.066c1.543 -.94 3.31 .826 2.37 2.37a1.724 1.724 0 0 0 1.065 2.572c1.756 .426 1.756 2.924 0 3.35a1.724 1.724 0 0 0 -1.066 2.573c.94 1.543 -.826 3.31 -2.37 2.37a1.724 1.724 0 0 0 -2.572 1.065c-.426 1.756 -2.924 1.756 -3.35 0a1.724 1.724 0 0 0 -2.573 -1.066c-1.543 .94 -3.31 -.826 -2.37 -2.37a1.724 1.724 0 0 0 -1.065 -2.572c-1.756 -.426 -1.756 -2.924 0 -3.35a1.724 1.724 0 0 0 1.066 -2.573c-.94 -1.543 .826 -3.31 2.37 -2.37c1 .608 2.296 .07 2.572 -1.065z"/>
                        <path d="M9 12a3 3 0 1 0 6 0a3 3 0 0 0 -6 0"/>
                      </svg>
                    </span>
                    <span class="nav-link-title">Configuración</span>
                  </a>
                </li>
              </ul>
            </div>
          </div>
        </div>
      </header>
      <!-- Page Content -->
      <div class="page-wrapper">
        <div class="page-header d-print-none">
          <div class="container-xl">
            <div class="row g-2 align-items-center">
              <div class="col">
                <div class="page-pretitle">Administración</div>
                <h2 class="page-title">Configuración del Sistema</h2>
              </div>
              <div class="col-auto ms-auto d-print-none">
                <div class="btn-list">
                  <span class="d-none d-sm-inline">
                    <a href="#" class="btn" onclick="event.preventDefault(); importarConfiguracion();">
                      <svg xmlns="http://www.w3.org/2000/svg" class="icon" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
                        <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                        <path d="M14 3v4a1 1 0 0 0 1 1h4"/>
                        <path d="M17 21h-10a2 2 0 0 1 -2 -2v-14a2 2 0 0 1 2 -2h7l5 5v11a2 2 0 0 1 -2 2z"/>
                        <path d="M12 11l-2 2l2 2"/>
                        <path d="M11 13h-1"/>
                      </svg>
                      Importar
                    </a>
                  </span>
                  <span class="d-none d-sm-inline">
                    <a href="#" class="btn" onclick="event.preventDefault(); exportarConfiguracion();">
                      <svg xmlns="http://www.w3.org/2000/svg" class="icon" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
                        <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                        <path d="M14 3v4a1 1 0 0 0 1 1h4"/>
                        <path d="M17 21h-10a2 2 0 0 1 -2 -2v-14a2 2 0 0 1 2 -2h7l5 5v11a2 2 0 0 1 -2 2z"/>
                        <path d="M12 11l2 2l-2 2"/>
                        <path d="M11 13h1"/>
                      </svg>
                      Exportar
                    </a>
                  </span>
                  <a href="#" class="btn btn-primary d-none d-sm-inline-block" onclick="event.preventDefault(); guardarConfiguracion();">
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
                      <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                      <path d="M6 4h10l4 4v10a2 2 0 0 1 -2 2h-12a2 2 0 0 1 -2 -2v-12a2 2 0 0 1 2 -2"/>
                      <path d="M12 14m-2 0a2 2 0 1 0 4 0a2 2 0 1 0 -4 0"/>
                      <path d="M14 4l0 4l-6 0l0 -4"/>
                    </svg>
                    Guardar Configuración
                  </a>
                </div>
              </div>
            </div>
          </div>
        </div>

            <!-- Page body -->
            <div class="page-body">
                <div class="container-xl">
                    <div class="row">
                        <div class="col-12">
                            <div class="card">
                                <div class="card-body">
                                    <!-- Tab Navigation -->
                                    <ul class="nav nav-tabs mb-4" id="configTabs" role="tablist">
                                        <li class="nav-item" role="presentation">
                                            <button class="nav-link active" id="company-tab" data-bs-toggle="tab" data-bs-target="#company" type="button" role="tab">
                                                <svg xmlns="http://www.w3.org/2000/svg" class="icon me-1" width="16" height="16" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
                                                    <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                                                    <path d="M3 21l18 0"/>
                                                    <path d="M5 21v-16a2 2 0 0 1 2 -2h8a2 2 0 0 1 2 2v16"/>
                                                    <path d="M9 9l0 0.01"/>
                                                    <path d="M15 9l0 0.01"/>
                                                    <path d="M9 12l0 0.01"/>
                                                    <path d="M15 12l0 0.01"/>
                                                    <path d="M9 15l0 0.01"/>
                                                    <path d="M15 15l0 0.01"/>
                                                    <path d="M9 18l0 0.01"/>
                                                    <path d="M15 18l0 0.01"/>
                                                </svg>
                                                Empresa
                                            </button>
                                        </li>
                                        <li class="nav-item" role="presentation">
                                            <button class="nav-link" id="evaluation-tab" data-bs-toggle="tab" data-bs-target="#evaluation" type="button" role="tab">
                                                <svg xmlns="http://www.w3.org/2000/svg" class="icon me-1" width="16" height="16" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
                                                    <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                                                    <path d="M14 3v4a1 1 0 0 0 1 1h4"/>
                                                    <path d="M17 21h-10a2 2 0 0 1 -2 -2v-14a2 2 0 0 1 2 -2h7l5 5v11a2 2 0 0 1 -2 2z"/>
                                                    <path d="M9 7l1 0"/>
                                                    <path d="M9 13l6 0"/>
                                                    <path d="M13 17l2 0"/>
                                                </svg>
                                                Evaluaciones
                                            </button>
                                        </li>
                                        <li class="nav-item" role="presentation">
                                            <button class="nav-link" id="positions-tab" data-bs-toggle="tab" data-bs-target="#positions" type="button" role="tab">
                                                <svg xmlns="http://www.w3.org/2000/svg" class="icon me-1" width="16" height="16" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
                                                    <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                                                    <path d="M12 3l8 4.5l0 9l-8 4.5l-8 -4.5l0 -9l8 -4.5"/>
                                                    <path d="M12 12l8 -4.5"/>
                                                    <path d="M12 12l0 9"/>
                                                    <path d="M12 12l-8 -4.5"/>
                                                </svg>
                                                Puestos
                                            </button>
                                        </li>
                                        <li class="nav-item" role="presentation">
                                            <button class="nav-link" id="email-tab" data-bs-toggle="tab" data-bs-target="#email" type="button" role="tab">
                                                <svg xmlns="http://www.w3.org/2000/svg" class="icon me-1" width="16" height="16" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
                                                    <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                                                    <path d="M3 7a2 2 0 0 1 2 -2h14a2 2 0 0 1 2 2v10a2 2 0 0 1 -2 2h-14a2 2 0 0 1 -2 -2v-10z"/>
                                                    <path d="M3 7l9 6l9 -6"/>
                                                </svg>
                                                Email
                                            </button>
                                        </li>
                                        <li class="nav-item" role="presentation">
                                            <button class="nav-link" id="security-tab" data-bs-toggle="tab" data-bs-target="#security" type="button" role="tab">
                                                <svg xmlns="http://www.w3.org/2000/svg" class="icon me-1" width="16" height="16" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
                                                    <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                                                    <path d="M12 3a12 12 0 0 0 8.5 3a12 12 0 0 1 -8.5 15a12 12 0 0 1 -8.5 -15a12 12 0 0 0 8.5 -3"/>
                                                </svg>
                                                Seguridad
                                            </button>
                                        </li>
                                        <li class="nav-item" role="presentation">
                                            <button class="nav-link" id="appearance-tab" data-bs-toggle="tab" data-bs-target="#appearance" type="button" role="tab">
                                                <svg xmlns="http://www.w3.org/2000/svg" class="icon me-1" width="16" height="16" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
                                                    <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                                                    <path d="M12 21a9 9 0 0 1 0 -18c5 0 9 4 9 9a4.5 4.5 0 0 1 -4.5 4.5h-1.5a2 2 0 0 0 -2 2a1 1 0 0 1 -1 1"/>
                                                    <path d="M8.5 10.5m-1 0a1 1 0 1 0 2 0a1 1 0 1 0 -2 0"/>
                                                    <path d="M12.5 7.5m-1 0a1 1 0 1 0 2 0a1 1 0 1 0 -2 0"/>
                                                    <path d="M16.5 10.5m-1 0a1 1 0 1 0 2 0a1 1 0 1 0 -2 0"/>
                                                </svg>
                                                Apariencia
                                            </button>
                                        </li>
                                        <li class="nav-item" role="presentation">
                                            <button class="nav-link" id="reports-tab" data-bs-toggle="tab" data-bs-target="#reports" type="button" role="tab">
                                                <svg xmlns="http://www.w3.org/2000/svg" class="icon me-1" width="16" height="16" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
                                                    <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                                                    <path d="M3 12m0 1a1 1 0 0 1 1 -1h4a1 1 0 0 1 1 1v6a1 1 0 0 1 -1 1h-4a1 1 0 0 1 -1 -1z"/>
                                                    <path d="M9 8m0 1a1 1 0 0 1 1 -1h4a1 1 0 0 1 1 1v10a1 1 0 0 1 -1 1h-4a1 1 0 0 1 -1 -1z"/>
                                                    <path d="M15 4m0 1a1 1 0 0 1 1 -1h4a1 1 0 0 1 1 1v14a1 1 0 0 1 -1 1h-4a1 1 0 0 1 -1 -1z"/>
                                                    <path d="M4 20l14 0"/>
                                                </svg>
                                                Reportes
                                            </button>
                                        </li>
                                        <li class="nav-item" role="presentation">
                                            <button class="nav-link" id="advanced-tab" data-bs-toggle="tab" data-bs-target="#advanced" type="button" role="tab">
                                                <svg xmlns="http://www.w3.org/2000/svg" class="icon me-1" width="16" height="16" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
                                                    <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                                                    <path d="M7 10h3v-3l-3.5 -3.5a6 6 0 0 1 8.5 0l-3.5 3.5v3h3l3.5 -3.5a6 6 0 0 1 0 8.5l-3.5 -3.5h-3v3l3.5 3.5a6 6 0 0 1 -8.5 0l3.5 -3.5v-3h-3l-3.5 3.5a6 6 0 0 1 0 -8.5l3.5 3.5"/>
                                                </svg>
                                                Avanzado
                                            </button>
                                        </li>
                                    </ul>

                                    <!-- Tab Content -->
                                    <div class="tab-content" id="configTabContent">
                                        <!-- Company Settings Tab -->
                                        <div class="tab-pane fade show active" id="company" role="tabpanel">
                                            <div class="settings-card">
                                                <div class="settings-section">
                                                    <h3 class="mb-3">Información de la Empresa</h3>
                                                    <div class="row">
                                                        <div class="col-md-6 mb-3">
                                                            <label class="form-label">Nombre de la Empresa</label>
                                                            <input type="text" class="form-control" placeholder="Mi Empresa S.A." value="Sistema Psicométrico">
                                                        </div>
                                                        <div class="col-md-6 mb-3">
                                                            <label class="form-label">RUC / NIT</label>
                                                            <input type="text" class="form-control" placeholder="20123456789">
                                                        </div>
                                                        <div class="col-md-6 mb-3">
                                                            <label class="form-label">Teléfono</label>
                                                            <input type="tel" class="form-control" placeholder="+51 999 999 999">
                                                        </div>
                                                        <div class="col-md-6 mb-3">
                                                            <label class="form-label">Email Corporativo</label>
                                                            <input type="email" class="form-control" placeholder="admin@empresa.com">
                                                        </div>
                                                        <div class="col-12 mb-3">
                                                            <label class="form-label">Dirección</label>
                                                            <textarea class="form-control" rows="2" placeholder="Av. Principal 123, Distrito, Ciudad"></textarea>
                                                        </div>
                                                    </div>
                                                </div>

                                                <div class="settings-section">
                                                    <h4 class="mb-3">Logo de la Empresa</h4>
                                                    <div class="row">
                                                        <div class="col-md-6">
                                                            <div class="preview-box">
                                                                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-lg text-muted mb-2" width="48" height="48" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
                                                                    <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                                                                    <path d="M15 8h.01"/>
                                                                    <path d="M3 6a3 3 0 0 1 3 -3h12a3 3 0 0 1 3 3v12a3 3 0 0 1 -3 3h-12a3 3 0 0 1 -3 -3v-12z"/>
                                                                    <path d="M3 16l5 -5c.928 -.893 2.072 -.893 3 0l5 5"/>
                                                                    <path d="M14 14l1 -1c.928 -.893 2.072 -.893 3 0l3 3"/>
                                                                </svg>
                                                                <div class="text-muted">Previsualización del logo</div>
                                                            </div>
                                                        </div>
                                                        <div class="col-md-6">
                                                            <label class="form-label">Subir Logo</label>
                                                            <input type="file" class="form-control" accept="image/*">
                                                            <div class="form-text">Formatos: PNG, JPG, SVG. Tamaño recomendado: 200x60px</div>
                                                        </div>
                                                    </div>
                                                </div>

                                                <div class="settings-section">
                                                    <h4 class="mb-3">Colores Corporativos</h4>
                                                    <div class="row">
                                                        <div class="col-md-6 mb-3">
                                                            <label class="form-label">Color Primario</label>
                                                            <div class="color-picker-wrapper">
                                                                <input type="color" class="color-picker" value="#206bc4">
                                                                <input type="text" class="form-control" value="#206bc4" readonly>
                                                            </div>
                                                        </div>
                                                        <div class="col-md-6 mb-3">
                                                            <label class="form-label">Color Secundario</label>
                                                            <div class="color-picker-wrapper">
                                                                <input type="color" class="color-picker" value="#6c757d">
                                                                <input type="text" class="form-control" value="#6c757d" readonly>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- Evaluation Settings Tab -->
                                        <div class="tab-pane fade" id="evaluation" role="tabpanel">
                                            <div class="settings-card">
                                                <div class="settings-section">
                                                    <h3 class="mb-3">Configuración de Evaluaciones</h3>
                                                    <div class="row">
                                                        <div class="col-md-4 mb-3">
                                                            <label class="form-label">Tiempo límite (minutos)</label>
                                                            <input type="number" class="form-control" value="60" min="30" max="120">
                                                            <div class="form-text">Tiempo máximo para completar la evaluación</div>
                                                        </div>
                                                        <div class="col-md-4 mb-3">
                                                            <label class="form-label">Expiración del token (horas)</label>
                                                            <input type="number" class="form-control" value="48" min="24" max="168">
                                                            <div class="form-text">Tiempo antes de que expire el enlace</div>
                                                        </div>
                                                        <div class="col-md-4 mb-3">
                                                            <label class="form-label">Intentos permitidos</label>
                                                            <select class="form-select">
                                                                <option value="1" selected>1 intento</option>
                                                                <option value="2">2 intentos</option>
                                                                <option value="3">3 intentos</option>
                                                            </select>
                                                        </div>
                                                    </div>
                                                </div>

                                                <div class="settings-section">
                                                    <h4 class="mb-3">Criterios de Puntuación</h4>
                                                    <div class="row">
                                                        <div class="col-md-3 mb-3">
                                                            <label class="form-label">Excelente (≥%)</label>
                                                            <input type="number" class="form-control" value="80" min="70" max="95">
                                                        </div>
                                                        <div class="col-md-3 mb-3">
                                                            <label class="form-label">Bueno (≥%)</label>
                                                            <input type="number" class="form-control" value="65" min="60" max="79">
                                                        </div>
                                                        <div class="col-md-3 mb-3">
                                                            <label class="form-label">Regular (≥%)</label>
                                                            <input type="number" class="form-control" value="50" min="40" max="64">
                                                        </div>
                                                        <div class="col-md-3 mb-3">
                                                            <label class="form-label">Deficiente (<%)</label>
                                                            <input type="number" class="form-control" value="50" readonly>
                                                        </div>
                                                    </div>
                                                </div>

                                                <div class="settings-section">
                                                    <h4 class="mb-3">Configuraciones Adicionales</h4>
                                                    <div class="row">
                                                        <div class="col-md-6">
                                                            <div class="form-check form-switch mb-2">
                                                                <input class="form-check-input" type="checkbox" id="autoSave" checked>
                                                                <label class="form-check-label" for="autoSave">Auto-guardar progreso</label>
                                                            </div>
                                                            <div class="form-check form-switch mb-2">
                                                                <input class="form-check-input" type="checkbox" id="showProgress" checked>
                                                                <label class="form-check-label" for="showProgress">Mostrar barra de progreso</label>
                                                            </div>
                                                            <div class="form-check form-switch">
                                                                <input class="form-check-input" type="checkbox" id="randomizeQuestions">
                                                                <label class="form-check-label" for="randomizeQuestions">Aleatorizar preguntas</label>
                                                            </div>
                                                        </div>
                                                        <div class="col-md-6">
                                                            <div class="form-check form-switch mb-2">
                                                                <input class="form-check-input" type="checkbox" id="requireCompleteAnswers" checked>
                                                                <label class="form-check-label" for="requireCompleteAnswers">Requerir todas las respuestas</label>
                                                            </div>
                                                            <div class="form-check form-switch mb-2">
                                                                <input class="form-check-input" type="checkbox" id="preventBackButton" checked>
                                                                <label class="form-check-label" for="preventBackButton">Prevenir botón atrás</label>
                                                            </div>
                                                            <div class="form-check form-switch">
                                                                <input class="form-check-input" type="checkbox" id="mobileFriendly" checked>
                                                                <label class="form-check-label" for="mobileFriendly">Optimizado para móviles</label>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- Job Positions Tab -->
                                        <div class="tab-pane fade" id="positions" role="tabpanel">
                                            <div class="settings-card">
                                                <div class="settings-section">
                                                    <div class="d-flex justify-content-between align-items-center mb-3">
                                                        <h3 class="mb-0">Puestos de Trabajo</h3>
                                                        <button type="button" class="btn btn-primary" onclick="agregarPuesto()">
                                                            <svg xmlns="http://www.w3.org/2000/svg" class="icon me-1" width="16" height="16" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
                                                                <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                                                                <path d="M12 5l0 14"/>
                                                                <path d="M5 12l14 0"/>
                                                            </svg>
                                                            Agregar Puesto
                                                        </button>
                                                    </div>

                                                    <div class="table-responsive">
                                                        <table class="table table-vcenter" id="positionsTable">
                                                            <thead>
                                                                <tr>
                                                                    <th>Puesto</th>
                                                                    <th>DISC Ideal</th>
                                                                    <th>Prioridad</th>
                                                                    <th>Estado</th>
                                                                    <th>Acciones</th>
                                                                </tr>
                                                            </thead>
                                                            <tbody id="positionsTableBody">
                                                                <!-- Default positions -->
                                                                <tr data-position-id="soldador">
                                                                    <td>
                                                                        <div class="d-flex align-items-center">
                                                                            <div class="avatar avatar-sm me-2" style="background-color: #206bc4; color: white;">
                                                                                S
                                                                            </div>
                                                                            <div>
                                                                                <div class="fw-bold">Soldador</div>
                                                                                <div class="text-muted small">Soldadura en letreros luminosos</div>
                                                                            </div>
                                                                        </div>
                                                                    </td>
                                                                    <td>
                                                                        <div class="d-flex gap-1">
                                                                            <span class="badge bg-secondary">D: 2-3</span>
                                                                            <span class="badge bg-warning">I: 4-5</span>
                                                                            <span class="badge bg-success">S: 7-9</span>
                                                                            <span class="badge bg-info">C: 7-8</span>
                                                                        </div>
                                                                    </td>
                                                                    <td><span class="badge bg-red">Crítico</span></td>
                                                                    <td><span class="badge bg-green">Activo</span></td>
                                                                    <td>
                                                                        <div class="btn-group" role="group">
                                                                            <button type="button" class="btn btn-sm btn-outline-primary" onclick="editarPuesto('soldador')">
                                                                                <svg xmlns="http://www.w3.org/2000/svg" class="icon" width="16" height="16" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none">
                                                                                    <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                                                                                    <path d="M7 7h-1a2 2 0 0 0 -2 2v9a2 2 0 0 0 2 2h9a2 2 0 0 0 2 -2v-1"/>
                                                                                    <path d="M20.385 6.585a2.1 2.1 0 0 0 -2.97 -2.97l-8.415 8.385v3h3l8.385 -8.415z"/>
                                                                                    <path d="M16 5l3 3"/>
                                                                                </svg>
                                                                            </button>
                                                                            <button type="button" class="btn btn-sm btn-outline-danger" onclick="eliminarPuesto('soldador')">
                                                                                <svg xmlns="http://www.w3.org/2000/svg" class="icon" width="16" height="16" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none">
                                                                                    <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                                                                                    <path d="M4 7l16 0"/>
                                                                                    <path d="M10 11l0 6"/>
                                                                                    <path d="M14 11l0 6"/>
                                                                                    <path d="M5 7l1 12a2 2 0 0 0 2 2h8a2 2 0 0 0 2 -2l1 -12"/>
                                                                                    <path d="M9 7v-3a1 1 0 0 1 1 -1h4a1 1 0 0 1 1 1v3"/>
                                                                                </svg>
                                                                            </button>
                                                                        </div>
                                                                    </td>
                                                                </tr>
                                                                <tr data-position-id="electricista">
                                                                    <td>
                                                                        <div class="d-flex align-items-center">
                                                                            <div class="avatar avatar-sm me-2" style="background-color: #f59f00; color: white;">
                                                                                E
                                                                            </div>
                                                                            <div>
                                                                                <div class="fw-bold">Electricista</div>
                                                                                <div class="text-muted small">Instalaciones eléctricas</div>
                                                                            </div>
                                                                        </div>
                                                                    </td>
                                                                    <td>
                                                                        <div class="d-flex gap-1">
                                                                            <span class="badge bg-secondary">D: 3-4</span>
                                                                            <span class="badge bg-warning">I: 3-4</span>
                                                                            <span class="badge bg-success">S: 6-8</span>
                                                                            <span class="badge bg-info">C: 8-9</span>
                                                                        </div>
                                                                    </td>
                                                                    <td><span class="badge bg-red">Crítico</span></td>
                                                                    <td><span class="badge bg-green">Activo</span></td>
                                                                    <td>
                                                                        <div class="btn-group" role="group">
                                                                            <button type="button" class="btn btn-sm btn-outline-primary" onclick="editarPuesto('electricista')">
                                                                                <svg xmlns="http://www.w3.org/2000/svg" class="icon" width="16" height="16" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none">
                                                                                    <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                                                                                    <path d="M7 7h-1a2 2 0 0 0 -2 2v9a2 2 0 0 0 2 2h9a2 2 0 0 0 2 -2v-1"/>
                                                                                    <path d="M20.385 6.585a2.1 2.1 0 0 0 -2.97 -2.97l-8.415 8.385v3h3l8.385 -8.415z"/>
                                                                                    <path d="M16 5l3 3"/>
                                                                                </svg>
                                                                            </button>
                                                                            <button type="button" class="btn btn-sm btn-outline-danger" onclick="eliminarPuesto('electricista')">
                                                                                <svg xmlns="http://www.w3.org/2000/svg" class="icon" width="16" height="16" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none">
                                                                                    <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                                                                                    <path d="M4 7l16 0"/>
                                                                                    <path d="M10 11l0 6"/>
                                                                                    <path d="M14 11l0 6"/>
                                                                                    <path d="M5 7l1 12a2 2 0 0 0 2 2h8a2 2 0 0 0 2 -2l1 -12"/>
                                                                                    <path d="M9 7v-3a1 1 0 0 1 1 -1h4a1 1 0 0 1 1 1v3"/>
                                                                                </svg>
                                                                            </button>
                                                                        </div>
                                                                    </td>
                                                                </tr>
                                                            </tbody>
                                                        </table>
                                                    </div>
                                                </div>

                                                <div class="settings-section">
                                                    <h4 class="mb-3">Criterios DISC por Defecto</h4>
                                                    <div class="row">
                                                        <div class="col-md-6">
                                                            <div class="card">
                                                                <div class="card-header">
                                                                    <h5 class="card-title">Perfil Ideal - Trabajos Técnicos</h5>
                                                                </div>
                                                                <div class="card-body">
                                                                    <div class="row g-3">
                                                                        <div class="col-6">
                                                                            <label class="form-label">Dominancia (D)</label>
                                                                            <div class="input-group">
                                                                                <input type="number" class="form-control" value="2" min="1" max="9" id="default-d-min">
                                                                                <span class="input-group-text">-</span>
                                                                                <input type="number" class="form-control" value="4" min="1" max="9" id="default-d-max">
                                                                            </div>
                                                                            <small class="form-text text-muted">Bajo control, sin agresividad</small>
                                                                        </div>
                                                                        <div class="col-6">
                                                                            <label class="form-label">Influencia (I)</label>
                                                                            <div class="input-group">
                                                                                <input type="number" class="form-control" value="3" min="1" max="9" id="default-i-min">
                                                                                <span class="input-group-text">-</span>
                                                                                <input type="number" class="form-control" value="5" min="1" max="9" id="default-i-max">
                                                                            </div>
                                                                            <small class="form-text text-muted">Moderada socialización</small>
                                                                        </div>
                                                                        <div class="col-6">
                                                                            <label class="form-label">Estabilidad (S)</label>
                                                                            <div class="input-group">
                                                                                <input type="number" class="form-control" value="6" min="1" max="9" id="default-s-min">
                                                                                <span class="input-group-text">-</span>
                                                                                <input type="number" class="form-control" value="9" min="1" max="9" id="default-s-max">
                                                                            </div>
                                                                            <small class="form-text text-muted">Alta paciencia y consistencia</small>
                                                                        </div>
                                                                        <div class="col-6">
                                                                            <label class="form-label">Conformidad (C)</label>
                                                                            <div class="input-group">
                                                                                <input type="number" class="form-control" value="7" min="1" max="9" id="default-c-min">
                                                                                <span class="input-group-text">-</span>
                                                                                <input type="number" class="form-control" value="9" min="1" max="9" id="default-c-max">
                                                                            </div>
                                                                            <small class="form-text text-muted">Alta precisión y normas</small>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <div class="col-md-6">
                                                            <div class="card">
                                                                <div class="card-header">
                                                                    <h5 class="card-title">Banderas Rojas DISC</h5>
                                                                </div>
                                                                <div class="card-body">
                                                                    <div class="row g-3">
                                                                        <div class="col-12">
                                                                            <div class="form-check form-switch">
                                                                                <input class="form-check-input" type="checkbox" id="flag-high-d" checked>
                                                                                <label class="form-check-label" for="flag-high-d">
                                                                                    <strong>D > 6:</strong> Demasiado dominante/agresivo
                                                                                </label>
                                                                            </div>
                                                                        </div>
                                                                        <div class="col-12">
                                                                            <div class="form-check form-switch">
                                                                                <input class="form-check-input" type="checkbox" id="flag-high-i" checked>
                                                                                <label class="form-check-label" for="flag-high-i">
                                                                                    <strong>I > 7:</strong> Demasiado extrovertido/distraído
                                                                                </label>
                                                                            </div>
                                                                        </div>
                                                                        <div class="col-12">
                                                                            <div class="form-check form-switch">
                                                                                <input class="form-check-input" type="checkbox" id="flag-low-s" checked>
                                                                                <label class="form-check-label" for="flag-low-s">
                                                                                    <strong>S < 5:</strong> Falta de paciencia/estabilidad
                                                                                </label>
                                                                            </div>
                                                                        </div>
                                                                        <div class="col-12">
                                                                            <div class="form-check form-switch">
                                                                                <input class="form-check-input" type="checkbox" id="flag-low-c" checked>
                                                                                <label class="form-check-label" for="flag-low-c">
                                                                                    <strong>C < 6:</strong> Falta de precisión/normas
                                                                                </label>
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                        <div class="tab-pane fade" id="email" role="tabpanel">
                                            <div class="settings-card">
                                                <!-- Email Server Configuration -->
                                                <div class="settings-section">
                                                    <h3 class="mb-3">Configuración del Servidor de Email</h3>
                                                    <div class="row">
                                                        <div class="col-md-6 mb-3">
                                                            <label class="form-label">Proveedor de Email</label>
                                                            <select class="form-select" id="email-provider">
                                                                <option value="custom">SMTP Personalizado</option>
                                                                <option value="gmail">Gmail</option>
                                                                <option value="outlook">Outlook</option>
                                                                <option value="sendgrid">SendGrid</option>
                                                                <option value="mailgun">Mailgun</option>
                                                            </select>
                                                        </div>
                                                        <div class="col-md-6 mb-3">
                                                            <label class="form-label">Estado del Servicio</label>
                                                            <div class="form-check form-switch">
                                                                <input class="form-check-input" type="checkbox" id="email-enabled">
                                                                <label class="form-check-label" for="email-enabled">
                                                                    Activar envío automático de emails
                                                                </label>
                                                            </div>
                                                        </div>
                                                    </div>

                                                    <div class="row">
                                                        <div class="col-md-6 mb-3">
                                                            <label class="form-label">Servidor SMTP</label>
                                                            <input type="text" class="form-control" id="smtp-host" placeholder="smtp.gmail.com">
                                                        </div>
                                                        <div class="col-md-6 mb-3">
                                                            <label class="form-label">Puerto</label>
                                                            <select class="form-select" id="smtp-port">
                                                                <option value="587">587 (TLS)</option>
                                                                <option value="465">465 (SSL)</option>
                                                                <option value="25">25 (Sin cifrado)</option>
                                                                <option value="2525">2525 (Alternativo)</option>
                                                            </select>
                                                        </div>
                                                    </div>

                                                    <div class="row">
                                                        <div class="col-md-6 mb-3">
                                                            <label class="form-label">Usuario/Email</label>
                                                            <input type="email" class="form-control" id="smtp-username" placeholder="admin@empresa.com">
                                                        </div>
                                                        <div class="col-md-6 mb-3">
                                                            <label class="form-label">Contraseña/API Key</label>
                                                            <input type="password" class="form-control" id="smtp-password" placeholder="••••••••">
                                                        </div>
                                                    </div>

                                                    <div class="row">
                                                        <div class="col-md-6 mb-3">
                                                            <label class="form-label">Seguridad</label>
                                                            <select class="form-select" id="smtp-security">
                                                                <option value="tls">TLS</option>
                                                                <option value="ssl">SSL</option>
                                                                <option value="none">Sin cifrado</option>
                                                            </select>
                                                        </div>
                                                        <div class="col-md-6 mb-3">
                                                            <label class="form-label">Email remitente</label>
                                                            <input type="email" class="form-control" id="from-email" placeholder="noreply@empresa.com">
                                                        </div>
                                                    </div>

                                                    <div class="row">
                                                        <div class="col-md-12 mb-3">
                                                            <button type="button" class="btn btn-outline-primary" onclick="testEmailConnection()">
                                                                <svg xmlns="http://www.w3.org/2000/svg" class="icon" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
                                                                    <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                                                                    <path d="M9 12l2 2l4 -4"/>
                                                                    <path d="M21 12c-1 0 -3 -1 -3 -3s2 -3 3 -3s3 1 3 3s-2 3 -3 3"/>
                                                                    <path d="M3 12c1 0 3 -1 3 -3s-2 -3 -3 -3s-3 1 -3 3s2 3 3 3"/>
                                                                </svg>
                                                                Probar Conexión
                                                            </button>
                                                            <span class="ms-2 text-muted">Envía un email de prueba para verificar la configuración</span>
                                                        </div>
                                                    </div>
                                                </div>

                                                <!-- Notification Settings -->
                                                <div class="settings-section">
                                                    <h3 class="mb-3">Configuración de Notificaciones</h3>
                                                    <div class="row">
                                                        <div class="col-md-6 mb-3">
                                                            <label class="form-label">Envío automático de invitaciones</label>
                                                            <div class="form-check form-switch">
                                                                <input class="form-check-input" type="checkbox" id="auto-send-invitations" checked>
                                                                <label class="form-check-label" for="auto-send-invitations">
                                                                    Enviar automáticamente al crear candidato
                                                                </label>
                                                            </div>
                                                        </div>
                                                        <div class="col-md-6 mb-3">
                                                            <label class="form-label">Recordatorios automáticos</label>
                                                            <div class="form-check form-switch">
                                                                <input class="form-check-input" type="checkbox" id="auto-reminders">
                                                                <label class="form-check-label" for="auto-reminders">
                                                                    Enviar recordatorios a candidatos pendientes
                                                                </label>
                                                            </div>
                                                        </div>
                                                    </div>

                                                    <div class="row">
                                                        <div class="col-md-6 mb-3">
                                                            <label class="form-label">Frecuencia de recordatorios</label>
                                                            <select class="form-select" id="reminder-frequency">
                                                                <option value="24">Cada 24 horas</option>
                                                                <option value="48">Cada 48 horas</option>
                                                                <option value="72">Cada 72 horas</option>
                                                                <option value="168">Semanal</option>
                                                            </select>
                                                        </div>
                                                        <div class="col-md-6 mb-3">
                                                            <label class="form-label">Notificaciones a administradores</label>
                                                            <div class="form-check form-switch">
                                                                <input class="form-check-input" type="checkbox" id="admin-notifications" checked>
                                                                <label class="form-check-label" for="admin-notifications">
                                                                    Notificar cuando se complete una evaluación
                                                                </label>
                                                            </div>
                                                        </div>
                                                    </div>

                                                    <div class="row">
                                                        <div class="col-md-12 mb-3">
                                                            <label class="form-label">Emails de administradores (separados por comas)</label>
                                                            <input type="text" class="form-control" id="admin-emails" placeholder="admin1@empresa.com, admin2@empresa.com">
                                                            <small class="form-text text-muted">Emails que recibirán notificaciones de nuevos resultados</small>
                                                        </div>
                                                    </div>
                                                </div>

                                                <!-- Email Templates -->
                                                <div class="settings-section">
                                                    <h3 class="mb-3">Plantillas de Email</h3>

                                                    <!-- Invitation Template -->
                                                    <div class="card mb-4">
                                                        <div class="card-header">
                                                            <h4 class="card-title">Invitación a Evaluación</h4>
                                                        </div>
                                                        <div class="card-body">
                                                            <div class="row">
                                                                <div class="col-md-12 mb-3">
                                                                    <label class="form-label">Asunto del email</label>
                                                                    <input type="text" class="form-control" id="invitation-subject"
                                                                           value="Invitación - Evaluación Psicométrica {{companyName}}">
                                                                </div>
                                                            </div>
                                                            <div class="row">
                                                                <div class="col-md-6">
                                                                    <label class="form-label">Contenido del email</label>
                                                                    <textarea class="form-control" rows="12" id="invitation-template">Estimado/a {{candidateName}},

Esperamos que te encuentres bien. Te contactamos desde {{companyName}} para invitarte a completar una evaluación psicométrica como parte de nuestro proceso de selección para el puesto de {{jobPosition}}.

La evaluación tiene una duración aproximada de 45-60 minutos y debe completarse en una sola sesión. El enlace es válido por {{tokenExpiration}} horas.

🔗 **Enlace de evaluación:**
{{testLink}}

**Instrucciones importantes:**
• Realiza la evaluación en un lugar tranquilo y sin distracciones
• Responde con honestidad, no hay respuestas correctas o incorrecas
• El enlace expira el {{expirationDate}}
• Si tienes problemas técnicos, contacta a: {{supportEmail}}

Gracias por tu tiempo e interés en formar parte de nuestro equipo.

Saludos cordiales,
{{companyName}}
Recursos Humanos</textarea>
                                                                </div>
                                                                <div class="col-md-6">
                                                                    <label class="form-label">Vista previa</label>
                                                                    <div class="preview-box" style="height: 300px; overflow-y: auto;">
                                                                        <div id="invitation-preview" class="text-start">
                                                                            <strong>Para:</strong> candidato@email.com<br>
                                                                            <strong>Asunto:</strong> <span id="preview-invitation-subject">Invitación - Evaluación Psicométrica Sistema Psicométrico</span><br><br>
                                                                            <div id="preview-invitation-content">
                                                                                Estimado/a Juan Pérez,<br><br>
                                                                                Esperamos que te encuentres bien. Te contactamos desde Sistema Psicométrico para invitarte a completar una evaluación psicométrica...
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                    <button type="button" class="btn btn-sm btn-outline-secondary mt-2" onclick="updateEmailPreview('invitation')">
                                                                        Actualizar Vista Previa
                                                                    </button>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>

                                                    <!-- Reminder Template -->
                                                    <div class="card mb-4">
                                                        <div class="card-header">
                                                            <h4 class="card-title">Recordatorio de Evaluación</h4>
                                                        </div>
                                                        <div class="card-body">
                                                            <div class="row">
                                                                <div class="col-md-12 mb-3">
                                                                    <label class="form-label">Asunto del email</label>
                                                                    <input type="text" class="form-control" id="reminder-subject"
                                                                           value="Recordatorio - Evaluación Psicométrica pendiente">
                                                                </div>
                                                            </div>
                                                            <div class="row">
                                                                <div class="col-md-6">
                                                                    <label class="form-label">Contenido del email</label>
                                                                    <textarea class="form-control" rows="10" id="reminder-template">Hola {{candidateName}},

Te escribimos para recordarte que tienes una evaluación psicométrica pendiente para el puesto de {{jobPosition}} en {{companyName}}.

⏰ **Tu evaluación expira en:** {{timeRemaining}}

🔗 **Enlace de evaluación:**
{{testLink}}

Si ya completaste la evaluación, puedes ignorar este mensaje.

Si necesitas asistencia, no dudes en contactarnos: {{supportEmail}}

Saludos,
{{companyName}}</textarea>
                                                                </div>
                                                                <div class="col-md-6">
                                                                    <label class="form-label">Vista previa</label>
                                                                    <div class="preview-box" style="height: 250px; overflow-y: auto;">
                                                                        <div id="reminder-preview" class="text-start">
                                                                            <strong>Para:</strong> candidato@email.com<br>
                                                                            <strong>Asunto:</strong> <span id="preview-reminder-subject">Recordatorio - Evaluación Psicométrica pendiente</span><br><br>
                                                                            <div id="preview-reminder-content">
                                                                                Hola Juan Pérez,<br><br>
                                                                                Te escribimos para recordarte que tienes una evaluación psicométrica pendiente...
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                    <button type="button" class="btn btn-sm btn-outline-secondary mt-2" onclick="updateEmailPreview('reminder')">
                                                                        Actualizar Vista Previa
                                                                    </button>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>

                                                    <!-- Results Template -->
                                                    <div class="card mb-4">
                                                        <div class="card-header">
                                                            <h4 class="card-title">Notificación de Resultados (Administradores)</h4>
                                                        </div>
                                                        <div class="card-body">
                                                            <div class="row">
                                                                <div class="col-md-12 mb-3">
                                                                    <label class="form-label">Asunto del email</label>
                                                                    <input type="text" class="form-control" id="results-subject"
                                                                           value="Nueva evaluación completada - {{candidateName}}">
                                                                </div>
                                                            </div>
                                                            <div class="row">
                                                                <div class="col-md-6">
                                                                    <label class="form-label">Contenido del email</label>
                                                                    <textarea class="form-control" rows="10" id="results-template">Hola equipo de RRHH,

Se ha completado una nueva evaluación psicométrica:

👤 **Candidato:** {{candidateName}}
📧 **Email:** {{candidateEmail}}
💼 **Puesto:** {{jobPosition}}
📊 **Puntuación:** {{totalScore}}%
🏷️ **Recomendación:** {{recommendation}}
📅 **Fecha:** {{completionDate}}

🔗 **Ver resultados completos:**
{{resultsLink}}

{{#redFlags}}
⚠️ **Alertas detectadas:**
{{redFlags}}
{{/redFlags}}

Sistema de Evaluación Psicométrica
{{companyName}}</textarea>
                                                                </div>
                                                                <div class="col-md-6">
                                                                    <label class="form-label">Vista previa</label>
                                                                    <div class="preview-box" style="height: 250px; overflow-y: auto;">
                                                                        <div id="results-preview" class="text-start">
                                                                            <strong>Para:</strong> admin@empresa.com<br>
                                                                            <strong>Asunto:</strong> <span id="preview-results-subject">Nueva evaluación completada - Juan Pérez</span><br><br>
                                                                            <div id="preview-results-content">
                                                                                Hola equipo de RRHH,<br><br>
                                                                                Se ha completado una nueva evaluación psicométrica...
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                    <button type="button" class="btn btn-sm btn-outline-secondary mt-2" onclick="updateEmailPreview('results')">
                                                                        Actualizar Vista Previa
                                                                    </button>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>

                                                    <!-- Variables Reference -->
                                                    <div class="card">
                                                        <div class="card-header">
                                                            <h4 class="card-title">Variables Disponibles</h4>
                                                        </div>
                                                        <div class="card-body">
                                                            <div class="row">
                                                                <div class="col-md-6">
                                                                    <h5>Variables del candidato:</h5>
                                                                    <ul class="list-unstyled">
                                                                        <li><code>{{candidateName}}</code> - Nombre del candidato</li>
                                                                        <li><code>{{candidateEmail}}</code> - Email del candidato</li>
                                                                        <li><code>{{jobPosition}}</code> - Puesto solicitado</li>
                                                                        <li><code>{{testLink}}</code> - Enlace de evaluación</li>
                                                                        <li><code>{{resultsLink}}</code> - Enlace a resultados</li>
                                                                    </ul>
                                                                </div>
                                                                <div class="col-md-6">
                                                                    <h5>Variables del sistema:</h5>
                                                                    <ul class="list-unstyled">
                                                                        <li><code>{{companyName}}</code> - Nombre de la empresa</li>
                                                                        <li><code>{{supportEmail}}</code> - Email de soporte</li>
                                                                        <li><code>{{tokenExpiration}}</code> - Horas de expiración</li>
                                                                        <li><code>{{expirationDate}}</code> - Fecha de expiración</li>
                                                                        <li><code>{{totalScore}}</code> - Puntuación total</li>
                                                                        <li><code>{{recommendation}}</code> - Recomendación</li>
                                                                    </ul>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                        <div class="tab-pane fade" id="security" role="tabpanel">
                                            <div class="settings-card">
                                                <!-- Password Policy Section -->
                                                <div class="settings-section">
                                                    <h3 class="mb-3">
                                                        <svg xmlns="http://www.w3.org/2000/svg" class="icon me-2" width="20" height="20" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
                                                            <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                                                            <path d="M5 13a2 2 0 0 1 2 -2h10a2 2 0 0 1 2 2v6a2 2 0 0 1 -2 2h-10a2 2 0 0 1 -2 -2v-6z"/>
                                                            <path d="M11 16a1 1 0 1 0 2 0a1 1 0 0 0 -2 0"/>
                                                            <path d="M8 11v-4a4 4 0 1 1 8 0v4"/>
                                                        </svg>
                                                        Política de Contraseñas
                                                    </h3>
                                                    <div class="row">
                                                        <div class="col-md-6 mb-3">
                                                            <label class="form-label">
                                                                Longitud mínima
                                                                <span class="text-muted" data-bs-toggle="tooltip" title="Número mínimo de caracteres requeridos">ⓘ</span>
                                                            </label>
                                                            <input type="number" class="form-control" id="minPasswordLength" value="8" min="6" max="20">
                                                        </div>
                                                        <div class="col-md-6 mb-3">
                                                            <label class="form-label">
                                                                Días de expiración
                                                                <span class="text-muted" data-bs-toggle="tooltip" title="Días antes de requerir cambio de contraseña">ⓘ</span>
                                                            </label>
                                                            <input type="number" class="form-control" id="passwordExpiry" value="90" min="30" max="365">
                                                        </div>
                                                        <div class="col-12">
                                                            <label class="form-label">Requisitos de complejidad</label>
                                                            <div class="row g-2">
                                                                <div class="col-md-3">
                                                                    <div class="form-check form-switch">
                                                                        <input class="form-check-input" type="checkbox" id="requireUppercase" checked>
                                                                        <label class="form-check-label" for="requireUppercase">Mayúsculas</label>
                                                                    </div>
                                                                </div>
                                                                <div class="col-md-3">
                                                                    <div class="form-check form-switch">
                                                                        <input class="form-check-input" type="checkbox" id="requireLowercase" checked>
                                                                        <label class="form-check-label" for="requireLowercase">Minúsculas</label>
                                                                    </div>
                                                                </div>
                                                                <div class="col-md-3">
                                                                    <div class="form-check form-switch">
                                                                        <input class="form-check-input" type="checkbox" id="requireNumbers" checked>
                                                                        <label class="form-check-label" for="requireNumbers">Números</label>
                                                                    </div>
                                                                </div>
                                                                <div class="col-md-3">
                                                                    <div class="form-check form-switch">
                                                                        <input class="form-check-input" type="checkbox" id="requireSpecialChars" checked>
                                                                        <label class="form-check-label" for="requireSpecialChars">Símbolos</label>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>

                                                <!-- Authentication & Session Section -->
                                                <div class="settings-section">
                                                    <h3 class="mb-3">
                                                        <svg xmlns="http://www.w3.org/2000/svg" class="icon me-2" width="20" height="20" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
                                                            <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                                                            <path d="M9 12l2 2l4 -4"/>
                                                            <path d="M21 12c-1 0 -3 -1 -3 -3s2 -3 3 -3s3 1 3 3s-2 3 -3 3"/>
                                                            <path d="M3 12c1 0 3 -1 3 -3s-2 -3 -3 -3s-3 1 -3 3s2 3 3 3"/>
                                                            <path d="M12 12m-3 0a3 3 0 1 0 6 0a3 3 0 1 0 -6 0"/>
                                                        </svg>
                                                        Autenticación y Sesiones
                                                    </h3>
                                                    <div class="row">
                                                        <div class="col-md-4 mb-3">
                                                            <div class="form-check form-switch">
                                                                <input class="form-check-input" type="checkbox" id="enableTwoFactor">
                                                                <label class="form-check-label" for="enableTwoFactor">
                                                                    <strong>Autenticación de 2 factores</strong>
                                                                    <div class="text-muted small">Requiere código SMS/Email</div>
                                                                </label>
                                                            </div>
                                                        </div>
                                                        <div class="col-md-4 mb-3">
                                                            <label class="form-label">
                                                                Timeout de sesión (minutos)
                                                                <span class="text-muted" data-bs-toggle="tooltip" title="Tiempo de inactividad antes de cerrar sesión">ⓘ</span>
                                                            </label>
                                                            <input type="number" class="form-control" id="sessionTimeout" value="30" min="5" max="480">
                                                        </div>
                                                        <div class="col-md-4 mb-3">
                                                            <label class="form-label">
                                                                Intentos de login máximos
                                                                <span class="text-muted" data-bs-toggle="tooltip" title="Intentos fallidos antes de bloquear cuenta">ⓘ</span>
                                                            </label>
                                                            <input type="number" class="form-control" id="maxLoginAttempts" value="5" min="3" max="10">
                                                        </div>
                                                    </div>
                                                </div>

                                                <!-- Access Control Section -->
                                                <div class="settings-section">
                                                    <h3 class="mb-3">
                                                        <svg xmlns="http://www.w3.org/2000/svg" class="icon me-2" width="20" height="20" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
                                                            <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                                                            <path d="M12 12m-9 0a9 9 0 1 0 18 0a9 9 0 1 0 -18 0"/>
                                                            <path d="M12 10m-3 0a3 3 0 1 0 6 0a3 3 0 1 0 -6 0"/>
                                                            <path d="M6.168 18.849a4 4 0 0 1 3.832 -2.849h4a4 4 0 0 1 3.834 2.855"/>
                                                        </svg>
                                                        Control de Acceso
                                                    </h3>
                                                    <div class="row">
                                                        <div class="col-md-6 mb-3">
                                                            <label class="form-label">IPs Permitidas (Whitelist)</label>
                                                            <textarea class="form-control" id="ipWhitelist" rows="4" placeholder="192.168.1.1&#10;10.0.0.0/24&#10;203.0.113.5">192.168.1.0/24
10.0.0.0/8</textarea>
                                                            <small class="form-text text-muted">Una IP o rango por línea. Usar formato CIDR para rangos.</small>
                                                        </div>
                                                        <div class="col-md-6 mb-3">
                                                            <label class="form-label">IPs Bloqueadas (Blacklist)</label>
                                                            <textarea class="form-control" id="ipBlacklist" rows="4" placeholder="192.168.1.100&#10;203.0.113.0/24"></textarea>
                                                            <small class="form-text text-muted">IPs que serán bloqueadas automáticamente.</small>
                                                        </div>
                                                        <div class="col-12">
                                                            <div class="form-check form-switch">
                                                                <input class="form-check-input" type="checkbox" id="enableIpRestriction">
                                                                <label class="form-check-label" for="enableIpRestriction">
                                                                    <strong>Activar restricción por IP</strong>
                                                                    <div class="text-muted small">Solo las IPs en whitelist podrán acceder</div>
                                                                </label>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>

                                                <!-- Data Protection Section -->
                                                <div class="settings-section">
                                                    <h3 class="mb-3">
                                                        <svg xmlns="http://www.w3.org/2000/svg" class="icon me-2" width="20" height="20" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
                                                            <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                                                            <path d="M12 3a12 12 0 0 0 8.5 3a12 12 0 0 1 -8.5 15a12 12 0 0 1 -8.5 -15a12 12 0 0 0 8.5 -3"/>
                                                            <path d="M12 11m-1 0a1 1 0 1 0 2 0a1 1 0 1 0 -2 0"/>
                                                            <path d="M12 12l0 2.5"/>
                                                        </svg>
                                                        Protección de Datos
                                                    </h3>
                                                    <div class="row">
                                                        <div class="col-md-4 mb-3">
                                                            <label class="form-label">
                                                                Retención de datos (días)
                                                                <span class="text-muted" data-bs-toggle="tooltip" title="Días antes de eliminar datos automáticamente">ⓘ</span>
                                                            </label>
                                                            <input type="number" class="form-control" id="dataRetentionDays" value="365" min="30" max="2555">
                                                        </div>
                                                        <div class="col-md-4 mb-3">
                                                            <label class="form-label">
                                                                Frecuencia de respaldo
                                                                <span class="text-muted" data-bs-toggle="tooltip" title="Frecuencia automática de copias de seguridad">ⓘ</span>
                                                            </label>
                                                            <select class="form-select" id="backupFrequency">
                                                                <option value="daily" selected>Diario</option>
                                                                <option value="weekly">Semanal</option>
                                                                <option value="monthly">Mensual</option>
                                                                <option value="manual">Solo manual</option>
                                                            </select>
                                                        </div>
                                                        <div class="col-md-4 mb-3">
                                                            <label class="form-label">
                                                                Copias a conservar
                                                                <span class="text-muted" data-bs-toggle="tooltip" title="Número de respaldos históricos a mantener">ⓘ</span>
                                                            </label>
                                                            <input type="number" class="form-control" id="backupRetention" value="30" min="5" max="365">
                                                        </div>
                                                        <div class="col-md-6">
                                                            <div class="form-check form-switch">
                                                                <input class="form-check-input" type="checkbox" id="enableAuditLog" checked>
                                                                <label class="form-check-label" for="enableAuditLog">
                                                                    <strong>Registro de auditoría</strong>
                                                                    <div class="text-muted small">Registrar todas las acciones del sistema</div>
                                                                </label>
                                                            </div>
                                                        </div>
                                                        <div class="col-md-6">
                                                            <div class="form-check form-switch">
                                                                <input class="form-check-input" type="checkbox" id="enableGdprCompliance" checked>
                                                                <label class="form-check-label" for="enableGdprCompliance">
                                                                    <strong>Cumplimiento GDPR</strong>
                                                                    <div class="text-muted small">Activar herramientas de protección de datos</div>
                                                                </label>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>

                                                <!-- Security Alert Section -->
                                                <div class="settings-section">
                                                    <div class="alert alert-warning">
                                                        <h4 class="alert-title">⚠️ Configuración Crítica</h4>
                                                        <div class="text-muted">
                                                            Los cambios en la configuración de seguridad pueden afectar el acceso al sistema.
                                                            Asegúrese de probar la configuración en un entorno de desarrollo antes de aplicarla en producción.
                                                        </div>
                                                        <div class="mt-2">
                                                            <button type="button" class="btn btn-warning btn-sm" onclick="exportarConfiguracionSeguridad()">
                                                                <svg xmlns="http://www.w3.org/2000/svg" class="icon" width="16" height="16" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none">
                                                                    <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                                                                    <path d="M14 3v4a1 1 0 0 0 1 1h4"/>
                                                                    <path d="M17 21h-10a2 2 0 0 1 -2 -2v-14a2 2 0 0 1 2 -2h7l5 5v11a2 2 0 0 1 -2 2z"/>
                                                                </svg>
                                                                Respaldar configuración actual
                                                            </button>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                        <div class="tab-pane fade" id="appearance" role="tabpanel">
                                            <div class="settings-card">
                                                <!-- Theme Configuration Section -->
                                                <div class="settings-section">
                                                    <h3 class="mb-3">
                                                        <svg xmlns="http://www.w3.org/2000/svg" class="icon me-2" width="20" height="20" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
                                                            <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                                                            <path d="M12 21a9 9 0 0 1 0 -18c5 0 9 4 9 9a4.5 4.5 0 0 1 -4.5 4.5h-1.5a2 2 0 0 0 -2 2a1 1 0 0 1 -1 1"/>
                                                            <path d="M8.5 10.5m-1 0a1 1 0 1 0 2 0a1 1 0 1 0 -2 0"/>
                                                            <path d="M12.5 7.5m-1 0a1 1 0 1 0 2 0a1 1 0 1 0 -2 0"/>
                                                            <path d="M16.5 10.5m-1 0a1 1 0 1 0 2 0a1 1 0 1 0 -2 0"/>
                                                        </svg>
                                                        Configuración de Tema
                                                    </h3>
                                                    <div class="row">
                                                        <div class="col-md-4 mb-3">
                                                            <label class="form-label">
                                                                Tema predeterminado
                                                                <span class="text-muted" data-bs-toggle="tooltip" title="Tema que se aplicará por defecto para nuevos usuarios">ⓘ</span>
                                                            </label>
                                                            <select class="form-select" id="defaultTheme">
                                                                <option value="light">Claro</option>
                                                                <option value="dark">Oscuro</option>
                                                                <option value="auto" selected>Automático (según sistema)</option>
                                                            </select>
                                                        </div>
                                                        <div class="col-md-4 mb-3">
                                                            <label class="form-label">
                                                                Permitir cambio de tema
                                                                <span class="text-muted" data-bs-toggle="tooltip" title="Permitir a los usuarios cambiar entre tema claro y oscuro">ⓘ</span>
                                                            </label>
                                                            <div class="form-check form-switch mt-2">
                                                                <input class="form-check-input" type="checkbox" id="allowThemeToggle" checked>
                                                                <label class="form-check-label" for="allowThemeToggle">
                                                                    Activar selector de tema
                                                                </label>
                                                            </div>
                                                        </div>
                                                        <div class="col-md-4 mb-3">
                                                            <label class="form-label">Vista previa</label>
                                                            <div class="theme-preview-container">
                                                                <div class="theme-preview-card" onclick="previewTheme('light')">
                                                                    <div class="theme-preview-light"></div>
                                                                    <small class="text-center">Claro</small>
                                                                </div>
                                                                <div class="theme-preview-card" onclick="previewTheme('dark')">
                                                                    <div class="theme-preview-dark"></div>
                                                                    <small class="text-center">Oscuro</small>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>

                                                <!-- Color Scheme Builder Section -->
                                                <div class="settings-section">
                                                    <h3 class="mb-3">
                                                        <svg xmlns="http://www.w3.org/2000/svg" class="icon me-2" width="20" height="20" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
                                                            <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                                                            <path d="M12 21a9 9 0 0 1 0 -18c5 0 9 4 9 9a4.5 4.5 0 0 1 -4.5 4.5h-1.5a2 2 0 0 0 -2 2a1 1 0 0 1 -1 1"/>
                                                            <path d="M8.5 10.5m-1 0a1 1 0 1 0 2 0a1 1 0 1 0 -2 0"/>
                                                            <path d="M12.5 7.5m-1 0a1 1 0 1 0 2 0a1 1 0 1 0 -2 0"/>
                                                            <path d="M16.5 10.5m-1 0a1 1 0 1 0 2 0a1 1 0 1 0 -2 0"/>
                                                        </svg>
                                                        Esquema de Colores Personalizado
                                                    </h3>
                                                    <div class="row">
                                                        <div class="col-md-3 mb-3">
                                                            <label class="form-label">Color Primario</label>
                                                            <div class="color-picker-wrapper">
                                                                <input type="color" class="color-picker" id="appearance-primary" value="#206bc4" onchange="updateColorText('appearance-primary', 'appearance-primary-text')">
                                                                <input type="text" class="form-control" id="appearance-primary-text" value="#206bc4" onchange="updateColorPicker('appearance-primary-text', 'appearance-primary')">
                                                            </div>
                                                            <small class="form-text text-muted">Botones principales, enlaces</small>
                                                        </div>
                                                        <div class="col-md-3 mb-3">
                                                            <label class="form-label">Color Secundario</label>
                                                            <div class="color-picker-wrapper">
                                                                <input type="color" class="color-picker" id="appearance-secondary" value="#6c757d" onchange="updateColorText('appearance-secondary', 'appearance-secondary-text')">
                                                                <input type="text" class="form-control" id="appearance-secondary-text" value="#6c757d" onchange="updateColorPicker('appearance-secondary-text', 'appearance-secondary')">
                                                            </div>
                                                            <small class="form-text text-muted">Texto secundario, bordes</small>
                                                        </div>
                                                        <div class="col-md-3 mb-3">
                                                            <label class="form-label">Color de Acento</label>
                                                            <div class="color-picker-wrapper">
                                                                <input type="color" class="color-picker" id="appearance-accent" value="#17a2b8" onchange="updateColorText('appearance-accent', 'appearance-accent-text')">
                                                                <input type="text" class="form-control" id="appearance-accent-text" value="#17a2b8" onchange="updateColorPicker('appearance-accent-text', 'appearance-accent')">
                                                            </div>
                                                            <small class="form-text text-muted">Notificaciones, alertas</small>
                                                        </div>
                                                        <div class="col-md-3 mb-3">
                                                            <label class="form-label">Color de Éxito</label>
                                                            <div class="color-picker-wrapper">
                                                                <input type="color" class="color-picker" id="appearance-success" value="#198754" onchange="updateColorText('appearance-success', 'appearance-success-text')">
                                                                <input type="text" class="form-control" id="appearance-success-text" value="#198754" onchange="updateColorPicker('appearance-success-text', 'appearance-success')">
                                                            </div>
                                                            <small class="form-text text-muted">Mensajes de éxito</small>
                                                        </div>
                                                    </div>
                                                    <div class="row">
                                                        <div class="col-12">
                                                            <div class="color-preview-section mt-3">
                                                                <h5>Vista Previa de Colores</h5>
                                                                <div class="color-preview-grid">
                                                                    <div class="color-preview-item">
                                                                        <button class="btn btn-primary color-preview-btn" id="preview-primary">Botón Primario</button>
                                                                    </div>
                                                                    <div class="color-preview-item">
                                                                        <button class="btn btn-secondary color-preview-btn" id="preview-secondary">Botón Secundario</button>
                                                                    </div>
                                                                    <div class="color-preview-item">
                                                                        <div class="alert alert-info color-preview-alert" id="preview-accent">Mensaje informativo</div>
                                                                    </div>
                                                                    <div class="color-preview-item">
                                                                        <div class="alert alert-success color-preview-alert" id="preview-success">Mensaje de éxito</div>
                                                                    </div>
                                                                </div>
                                                                <button type="button" class="btn btn-outline-primary btn-sm mt-2" onclick="applyColorPreview()">
                                                                    <svg xmlns="http://www.w3.org/2000/svg" class="icon me-1" width="16" height="16" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none">
                                                                        <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                                                                        <path d="M5 12l5 5l10 -10"/>
                                                                    </svg>
                                                                    Aplicar vista previa
                                                                </button>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>

                                                <!-- Advanced Branding Section -->
                                                <div class="settings-section">
                                                    <h3 class="mb-3">
                                                        <svg xmlns="http://www.w3.org/2000/svg" class="icon me-2" width="20" height="20" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
                                                            <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                                                            <path d="M12 3l8 4.5l0 9l-8 4.5l-8 -4.5l0 -9l8 -4.5"/>
                                                            <path d="M12 12l8 -4.5"/>
                                                            <path d="M12 12l0 9"/>
                                                            <path d="M12 12l-8 -4.5"/>
                                                        </svg>
                                                        Personalización Avanzada de Marca
                                                    </h3>
                                                    <div class="row">
                                                        <div class="col-md-6 mb-3">
                                                            <label class="form-label">Favicon personalizado</label>
                                                            <input type="file" class="form-control" id="faviconUpload" accept=".ico,.png,.svg">
                                                            <div class="form-text">Formatos: ICO, PNG (32x32), SVG. Tamaño recomendado: 32x32px</div>
                                                        </div>
                                                        <div class="col-md-6 mb-3">
                                                            <label class="form-label">Fuente personalizada (Google Fonts)</label>
                                                            <input type="text" class="form-control" id="customFont" placeholder="Inter, Roboto, Open Sans">
                                                            <div class="form-text">Nombre de la fuente de Google Fonts (se aplicará automáticamente)</div>
                                                        </div>
                                                        <div class="col-12 mb-3">
                                                            <label class="form-label">
                                                                CSS personalizado avanzado
                                                                <span class="text-muted" data-bs-toggle="tooltip" title="Para usuarios avanzados: CSS personalizado que se aplicará en todo el sistema">ⓘ</span>
                                                            </label>
                                                            <textarea class="form-control" id="customCSS" rows="6" placeholder="/* CSS personalizado para usuarios avanzados */
.custom-class {
    background-color: #f8f9fa;
    border-radius: 8px;
}"></textarea>
                                                            <div class="form-text">Solo para usuarios con conocimientos de CSS. Use con precaución.</div>
                                                        </div>
                                                    </div>
                                                </div>

                                                <!-- Dashboard Layout Section -->
                                                <div class="settings-section">
                                                    <h3 class="mb-3">
                                                        <svg xmlns="http://www.w3.org/2000/svg" class="icon me-2" width="20" height="20" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
                                                            <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                                                            <path d="M4 4h6v8h-6z"/>
                                                            <path d="M4 16h6v4h-6z"/>
                                                            <path d="M14 12h6v8h-6z"/>
                                                            <path d="M14 4h6v4h-6z"/>
                                                        </svg>
                                                        Diseño del Dashboard
                                                    </h3>
                                                    <div class="row">
                                                        <div class="col-md-4 mb-3">
                                                            <label class="form-label">Posición de la barra lateral</label>
                                                            <select class="form-select" id="sidebarPosition">
                                                                <option value="left" selected>Izquierda</option>
                                                                <option value="right">Derecha</option>
                                                            </select>
                                                        </div>
                                                        <div class="col-md-4 mb-3">
                                                            <label class="form-label">Estilo de navegación</label>
                                                            <select class="form-select" id="navStyle">
                                                                <option value="horizontal" selected>Horizontal</option>
                                                                <option value="vertical">Vertical expandido</option>
                                                                <option value="collapsed">Vertical colapsado</option>
                                                            </select>
                                                        </div>
                                                        <div class="col-md-4 mb-3">
                                                            <label class="form-label">Diseño de tarjetas</label>
                                                            <select class="form-select" id="cardLayout">
                                                                <option value="standard" selected>Estándar</option>
                                                                <option value="compact">Compacto</option>
                                                                <option value="expanded">Expandido</option>
                                                            </select>
                                                        </div>
                                                        <div class="col-md-6">
                                                            <div class="form-check form-switch">
                                                                <input class="form-check-input" type="checkbox" id="stickyHeader" checked>
                                                                <label class="form-check-label" for="stickyHeader">
                                                                    <strong>Encabezado fijo</strong>
                                                                    <div class="text-muted small">Mantener el encabezado visible al hacer scroll</div>
                                                                </label>
                                                            </div>
                                                        </div>
                                                        <div class="col-md-6">
                                                            <div class="form-check form-switch">
                                                                <input class="form-check-input" type="checkbox" id="showBreadcrumbs" checked>
                                                                <label class="form-check-label" for="showBreadcrumbs">
                                                                    <strong>Mostrar navegación de migas</strong>
                                                                    <div class="text-muted small">Ruta de navegación en las páginas</div>
                                                                </label>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>

                                                <!-- User Interface Options Section -->
                                                <div class="settings-section">
                                                    <h3 class="mb-3">
                                                        <svg xmlns="http://www.w3.org/2000/svg" class="icon me-2" width="20" height="20" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
                                                            <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                                                            <path d="M10.325 4.317c.426 -1.756 2.924 -1.756 3.35 0a1.724 1.724 0 0 0 2.573 1.066c1.543 -.94 3.31 .826 2.37 2.37a1.724 1.724 0 0 0 1.065 2.572c1.756 .426 1.756 2.924 0 3.35a1.724 1.724 0 0 0 -1.066 2.573c.94 1.543 -.826 3.31 -2.37 2.37a1.724 1.724 0 0 0 -2.572 1.065c-.426 1.756 -2.924 1.756 -3.35 0a1.724 1.724 0 0 0 -2.573 -1.066c-1.543 .94 -3.31 -.826 -2.37 -2.37a1.724 1.724 0 0 0 -1.065 -2.572c-1.756 -.426 -1.756 -2.924 0 -3.35a1.724 1.724 0 0 0 1.066 -2.573c-.94 -1.543 .826 -3.31 2.37 -2.37c1 .608 2.296 .07 2.572 -1.065z"/>
                                                            <path d="M9 12a3 3 0 1 0 6 0a3 3 0 0 0 -6 0"/>
                                                        </svg>
                                                        Opciones de Interfaz de Usuario
                                                    </h3>
                                                    <div class="row">
                                                        <div class="col-md-3 mb-3">
                                                            <label class="form-label">Tamaño de fuente</label>
                                                            <select class="form-select" id="fontSize">
                                                                <option value="small">Pequeña</option>
                                                                <option value="medium" selected>Mediana</option>
                                                                <option value="large">Grande</option>
                                                            </select>
                                                        </div>
                                                        <div class="col-md-3 mb-3">
                                                            <label class="form-label">Velocidad de animaciones</label>
                                                            <select class="form-select" id="animationSpeed">
                                                                <option value="fast">Rápida</option>
                                                                <option value="normal" selected>Normal</option>
                                                                <option value="slow">Lenta</option>
                                                                <option value="disabled">Deshabilitadas</option>
                                                            </select>
                                                        </div>
                                                        <div class="col-md-3 mb-3">
                                                            <label class="form-label">Idioma de la interfaz</label>
                                                            <select class="form-select" id="interfaceLanguage">
                                                                <option value="es" selected>Español</option>
                                                                <option value="en">English</option>
                                                            </select>
                                                        </div>
                                                        <div class="col-md-3 mb-3">
                                                            <label class="form-label">Densidad de información</label>
                                                            <select class="form-select" id="dataDensity">
                                                                <option value="compact">Compacta</option>
                                                                <option value="standard" selected>Estándar</option>
                                                                <option value="comfortable">Cómoda</option>
                                                            </select>
                                                        </div>
                                                        <div class="col-md-4">
                                                            <div class="form-check form-switch">
                                                                <input class="form-check-input" type="checkbox" id="showTooltips" checked>
                                                                <label class="form-check-label" for="showTooltips">
                                                                    <strong>Mostrar tooltips</strong>
                                                                    <div class="text-muted small">Ayuda contextual al pasar el mouse</div>
                                                                </label>
                                                            </div>
                                                        </div>
                                                        <div class="col-md-4">
                                                            <div class="form-check form-switch">
                                                                <input class="form-check-input" type="checkbox" id="enableAnimations" checked>
                                                                <label class="form-check-label" for="enableAnimations">
                                                                    <strong>Activar animaciones</strong>
                                                                    <div class="text-muted small">Transiciones y efectos visuales</div>
                                                                </label>
                                                            </div>
                                                        </div>
                                                        <div class="col-md-4">
                                                            <div class="form-check form-switch">
                                                                <input class="form-check-input" type="checkbox" id="highContrast">
                                                                <label class="form-check-label" for="highContrast">
                                                                    <strong>Alto contraste</strong>
                                                                    <div class="text-muted small">Para mejor accesibilidad</div>
                                                                </label>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>

                                                <!-- Candidate Test Interface Section -->
                                                <div class="settings-section">
                                                    <h3 class="mb-3">
                                                        <svg xmlns="http://www.w3.org/2000/svg" class="icon me-2" width="20" height="20" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
                                                            <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                                                            <path d="M9 7m-4 0a4 4 0 1 0 8 0a4 4 0 1 0 -8 0"/>
                                                            <path d="M3 21v-2a4 4 0 0 1 4 -4h4a4 4 0 0 1 4 4v2"/>
                                                            <path d="M16 3.13a4 4 0 0 1 0 7.75"/>
                                                            <path d="M21 21v-2a4 4 0 0 0 -3 -3.87"/>
                                                        </svg>
                                                        Interfaz para Candidatos
                                                    </h3>
                                                    <div class="row">
                                                        <div class="col-md-4 mb-3">
                                                            <label class="form-label">Esquema de colores para evaluación</label>
                                                            <select class="form-select" id="testColorScheme">
                                                                <option value="professional" selected>Profesional (azul)</option>
                                                                <option value="calming">Relajante (verde)</option>
                                                                <option value="neutral">Neutral (gris)</option>
                                                                <option value="custom">Personalizado</option>
                                                            </select>
                                                        </div>
                                                        <div class="col-md-4 mb-3">
                                                            <label class="form-label">Fuente para candidatos</label>
                                                            <select class="form-select" id="testFontFamily">
                                                                <option value="system" selected>Fuente del sistema</option>
                                                                <option value="inter">Inter (moderna)</option>
                                                                <option value="roboto">Roboto (legible)</option>
                                                                <option value="open-sans">Open Sans (amigable)</option>
                                                            </select>
                                                        </div>
                                                        <div class="col-md-4 mb-3">
                                                            <label class="form-label">Diseño para móviles</label>
                                                            <select class="form-select" id="mobileLayout">
                                                                <option value="stacked" selected>Apilado (tradicional)</option>
                                                                <option value="tabs">Por pestañas</option>
                                                                <option value="progressive">Progresivo</option>
                                                            </select>
                                                        </div>
                                                        <div class="col-md-6">
                                                            <div class="form-check form-switch">
                                                                <input class="form-check-input" type="checkbox" id="showTestProgress" checked>
                                                                <label class="form-check-label" for="showTestProgress">
                                                                    <strong>Mostrar progreso del test</strong>
                                                                    <div class="text-muted small">Barra de progreso visible para candidatos</div>
                                                                </label>
                                                            </div>
                                                        </div>
                                                        <div class="col-md-6">
                                                            <div class="form-check form-switch">
                                                                <input class="form-check-input" type="checkbox" id="largeButtonsTouch" checked>
                                                                <label class="form-check-label" for="largeButtonsTouch">
                                                                    <strong>Botones grandes para táctil</strong>
                                                                    <div class="text-muted small">Optimizado para dispositivos móviles</div>
                                                                </label>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>

                                                <!-- Accessibility Section -->
                                                <div class="settings-section">
                                                    <h3 class="mb-3">
                                                        <svg xmlns="http://www.w3.org/2000/svg" class="icon me-2" width="20" height="20" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
                                                            <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                                                            <path d="M12 12m-4 0a4 4 0 1 0 8 0a4 4 0 1 0 -8 0"/>
                                                            <path d="M12 12v-8"/>
                                                            <path d="M12 12h4"/>
                                                            <path d="M12 12v4"/>
                                                            <path d="M12 12h-4"/>
                                                            <path d="M12 4l1.5 1.5"/>
                                                            <path d="M16 12l1.5 -1.5"/>
                                                            <path d="M12 20l-1.5 -1.5"/>
                                                            <path d="M8 12l-1.5 1.5"/>
                                                        </svg>
                                                        Opciones de Accesibilidad
                                                    </h3>
                                                    <div class="row">
                                                        <div class="col-md-6">
                                                            <div class="form-check form-switch mb-2">
                                                                <input class="form-check-input" type="checkbox" id="screenReaderSupport" checked>
                                                                <label class="form-check-label" for="screenReaderSupport">
                                                                    <strong>Soporte para lectores de pantalla</strong>
                                                                    <div class="text-muted small">Etiquetas ARIA y navegación por teclado</div>
                                                                </label>
                                                            </div>
                                                            <div class="form-check form-switch mb-2">
                                                                <input class="form-check-input" type="checkbox" id="keyboardNavigation" checked>
                                                                <label class="form-check-label" for="keyboardNavigation">
                                                                    <strong>Navegación por teclado</strong>
                                                                    <div class="text-muted small">Acceso completo sin mouse</div>
                                                                </label>
                                                            </div>
                                                            <div class="form-check form-switch">
                                                                <input class="form-check-input" type="checkbox" id="reducedMotion">
                                                                <label class="form-check-label" for="reducedMotion">
                                                                    <strong>Movimiento reducido</strong>
                                                                    <div class="text-muted small">Para usuarios sensibles al movimiento</div>
                                                                </label>
                                                            </div>
                                                        </div>
                                                        <div class="col-md-6">
                                                            <div class="form-check form-switch mb-2">
                                                                <input class="form-check-input" type="checkbox" id="focusIndicators" checked>
                                                                <label class="form-check-label" for="focusIndicators">
                                                                    <strong>Indicadores de foco</strong>
                                                                    <div class="text-muted small">Bordes visibles en elementos activos</div>
                                                                </label>
                                                            </div>
                                                            <div class="form-check form-switch mb-2">
                                                                <input class="form-check-input" type="checkbox" id="alternativeText" checked>
                                                                <label class="form-check-label" for="alternativeText">
                                                                    <strong>Texto alternativo</strong>
                                                                    <div class="text-muted small">Descripciones para imágenes e iconos</div>
                                                                </label>
                                                            </div>
                                                            <div class="form-check form-switch">
                                                                <input class="form-check-input" type="checkbox" id="autoPlayVideo">
                                                                <label class="form-check-label" for="autoPlayVideo">
                                                                    <strong>Reproducción automática</strong>
                                                                    <div class="text-muted small">Videos y animaciones automáticas</div>
                                                                </label>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>

                                                <!-- Preview and Actions Section -->
                                                <div class="settings-section">
                                                    <h3 class="mb-3">
                                                        <svg xmlns="http://www.w3.org/2000/svg" class="icon me-2" width="20" height="20" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
                                                            <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                                                            <path d="M5 12l5 5l10 -10"/>
                                                        </svg>
                                                        Vista Previa y Acciones
                                                    </h3>
                                                    <div class="row">
                                                        <div class="col-12 mb-3">
                                                            <div class="alert alert-info">
                                                                <h4 class="alert-title">💡 Vista Previa en Tiempo Real</h4>
                                                                <div class="text-muted">
                                                                    Los cambios en colores y temas se aplicarán inmediatamente para que puedas ver el resultado.
                                                                    Utiliza los botones de abajo para probar diferentes configuraciones.
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <div class="col-12">
                                                            <div class="btn-group mb-3" role="group">
                                                                <button type="button" class="btn btn-outline-primary" onclick="previewAppearanceChanges()">
                                                                    <svg xmlns="http://www.w3.org/2000/svg" class="icon me-1" width="16" height="16" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none">
                                                                        <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                                                                        <path d="M1 12l2 2l5 -5"/>
                                                                        <path d="M12 12l2 2l5 -5"/>
                                                                    </svg>
                                                                    Aplicar Vista Previa
                                                                </button>
                                                                <button type="button" class="btn btn-outline-secondary" onclick="resetAppearanceChanges()">
                                                                    <svg xmlns="http://www.w3.org/2000/svg" class="icon me-1" width="16" height="16" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none">
                                                                        <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                                                                        <path d="M20 11a8.1 8.1 0 0 0 -15.5 -2m-.5 -4v4h4"/>
                                                                        <path d="M4 13a8.1 8.1 0 0 0 15.5 2m.5 4v-4h-4"/>
                                                                    </svg>
                                                                    Restaurar Original
                                                                </button>
                                                                <button type="button" class="btn btn-outline-warning" onclick="exportAppearanceConfig()">
                                                                    <svg xmlns="http://www.w3.org/2000/svg" class="icon me-1" width="16" height="16" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none">
                                                                        <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                                                                        <path d="M14 3v4a1 1 0 0 0 1 1h4"/>
                                                                        <path d="M17 21h-10a2 2 0 0 1 -2 -2v-14a2 2 0 0 1 2 -2h7l5 5v11a2 2 0 0 1 -2 2z"/>
                                                                    </svg>
                                                                    Exportar Tema
                                                                </button>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                        <div class="tab-pane fade" id="reports" role="tabpanel">
                                            <div class="settings-card">
                                                <!-- Available Reports Configuration -->
                                                <div class="settings-section">
                                                    <h3 class="mb-3">
                                                        <svg xmlns="http://www.w3.org/2000/svg" class="icon me-2" width="20" height="20" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
                                                            <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                                                            <path d="M3 12m0 1a1 1 0 0 1 1 -1h4a1 1 0 0 1 1 1v6a1 1 0 0 1 -1 1h-4a1 1 0 0 1 -1 -1z"/>
                                                            <path d="M9 8m0 1a1 1 0 0 1 1 -1h4a1 1 0 0 1 1 1v10a1 1 0 0 1 -1 1h-4a1 1 0 0 1 -1 -1z"/>
                                                            <path d="M15 4m0 1a1 1 0 0 1 1 -1h4a1 1 0 0 1 1 1v14a1 1 0 0 1 -1 1h-4a1 1 0 0 1 -1 -1z"/>
                                                            <path d="M4 20l14 0"/>
                                                        </svg>
                                                        Reportes Disponibles
                                                    </h3>
                                                    <p class="text-muted mb-4">Configura qué reportes están disponibles en el sistema y sus características</p>

                                                    <div class="row">
                                                        <div class="col-md-6 mb-3">
                                                            <div class="card border">
                                                                <div class="card-body">
                                                                    <div class="d-flex align-items-center justify-content-between mb-2">
                                                                        <h4 class="card-title mb-0">Reporte Individual</h4>
                                                                        <div class="form-check form-switch">
                                                                            <input class="form-check-input" type="checkbox" id="report-individual" checked>
                                                                        </div>
                                                                    </div>
                                                                    <p class="text-muted small mb-3">Resultados detallados por candidato</p>
                                                                    <div class="row">
                                                                        <div class="col-12 mb-2">
                                                                            <label class="form-label">Campos incluidos</label>
                                                                            <div class="row">
                                                                                <div class="col-sm-6">
                                                                                    <div class="form-check">
                                                                                        <input class="form-check-input" type="checkbox" id="individual-scores" checked>
                                                                                        <label class="form-check-label" for="individual-scores">Puntuaciones</label>
                                                                                    </div>
                                                                                    <div class="form-check">
                                                                                        <input class="form-check-input" type="checkbox" id="individual-disc" checked>
                                                                                        <label class="form-check-label" for="individual-disc">Perfil DISC</label>
                                                                                    </div>
                                                                                    <div class="form-check">
                                                                                        <input class="form-check-input" type="checkbox" id="individual-recommendations" checked>
                                                                                        <label class="form-check-label" for="individual-recommendations">Recomendaciones</label>
                                                                                    </div>
                                                                                </div>
                                                                                <div class="col-sm-6">
                                                                                    <div class="form-check">
                                                                                        <input class="form-check-input" type="checkbox" id="individual-red-flags" checked>
                                                                                        <label class="form-check-label" for="individual-red-flags">Banderas rojas</label>
                                                                                    </div>
                                                                                    <div class="form-check">
                                                                                        <input class="form-check-input" type="checkbox" id="individual-responses">
                                                                                        <label class="form-check-label" for="individual-responses">Respuestas detalladas</label>
                                                                                    </div>
                                                                                    <div class="form-check">
                                                                                        <input class="form-check-input" type="checkbox" id="individual-charts" checked>
                                                                                        <label class="form-check-label" for="individual-charts">Gráficos</label>
                                                                                    </div>
                                                                                </div>
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>

                                                        <div class="col-md-6 mb-3">
                                                            <div class="card border">
                                                                <div class="card-body">
                                                                    <div class="d-flex align-items-center justify-content-between mb-2">
                                                                        <h4 class="card-title mb-0">Reporte Masivo</h4>
                                                                        <div class="form-check form-switch">
                                                                            <input class="form-check-input" type="checkbox" id="report-bulk" checked>
                                                                        </div>
                                                                    </div>
                                                                    <p class="text-muted small mb-3">Análisis de múltiples candidatos</p>
                                                                    <div class="row">
                                                                        <div class="col-12 mb-2">
                                                                            <label class="form-label">Campos incluidos</label>
                                                                            <div class="row">
                                                                                <div class="col-sm-6">
                                                                                    <div class="form-check">
                                                                                        <input class="form-check-input" type="checkbox" id="bulk-summary" checked>
                                                                                        <label class="form-check-label" for="bulk-summary">Resumen ejecutivo</label>
                                                                                    </div>
                                                                                    <div class="form-check">
                                                                                        <input class="form-check-input" type="checkbox" id="bulk-statistics" checked>
                                                                                        <label class="form-check-label" for="bulk-statistics">Estadísticas</label>
                                                                                    </div>
                                                                                    <div class="form-check">
                                                                                        <input class="form-check-input" type="checkbox" id="bulk-comparisons" checked>
                                                                                        <label class="form-check-label" for="bulk-comparisons">Comparaciones</label>
                                                                                    </div>
                                                                                </div>
                                                                                <div class="col-sm-6">
                                                                                    <div class="form-check">
                                                                                        <input class="form-check-input" type="checkbox" id="bulk-trends" checked>
                                                                                        <label class="form-check-label" for="bulk-trends">Tendencias</label>
                                                                                    </div>
                                                                                    <div class="form-check">
                                                                                        <input class="form-check-input" type="checkbox" id="bulk-rankings" checked>
                                                                                        <label class="form-check-label" for="bulk-rankings">Rankings</label>
                                                                                    </div>
                                                                                    <div class="form-check">
                                                                                        <input class="form-check-input" type="checkbox" id="bulk-filters">
                                                                                        <label class="form-check-label" for="bulk-filters">Filtros avanzados</label>
                                                                                    </div>
                                                                                </div>
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>

                                                        <div class="col-md-6 mb-3">
                                                            <div class="card border">
                                                                <div class="card-body">
                                                                    <div class="d-flex align-items-center justify-content-between mb-2">
                                                                        <h4 class="card-title mb-0">Análisis DISC</h4>
                                                                        <div class="form-check form-switch">
                                                                            <input class="form-check-input" type="checkbox" id="report-disc" checked>
                                                                        </div>
                                                                    </div>
                                                                    <p class="text-muted small mb-3">Perfiles de personalidad detallados</p>
                                                                    <div class="row">
                                                                        <div class="col-12 mb-2">
                                                                            <label class="form-label">Campos incluidos</label>
                                                                            <div class="row">
                                                                                <div class="col-sm-6">
                                                                                    <div class="form-check">
                                                                                        <input class="form-check-input" type="checkbox" id="disc-profiles" checked>
                                                                                        <label class="form-check-label" for="disc-profiles">Perfiles detallados</label>
                                                                                    </div>
                                                                                    <div class="form-check">
                                                                                        <input class="form-check-input" type="checkbox" id="disc-charts" checked>
                                                                                        <label class="form-check-label" for="disc-charts">Gráficos DISC</label>
                                                                                    </div>
                                                                                    <div class="form-check">
                                                                                        <input class="form-check-input" type="checkbox" id="disc-compatibilities" checked>
                                                                                        <label class="form-check-label" for="disc-compatibilities">Compatibilidades</label>
                                                                                    </div>
                                                                                </div>
                                                                                <div class="col-sm-6">
                                                                                    <div class="form-check">
                                                                                        <input class="form-check-input" type="checkbox" id="disc-interpretations" checked>
                                                                                        <label class="form-check-label" for="disc-interpretations">Interpretaciones</label>
                                                                                    </div>
                                                                                    <div class="form-check">
                                                                                        <input class="form-check-input" type="checkbox" id="disc-recommendations" checked>
                                                                                        <label class="form-check-label" for="disc-recommendations">Recomendaciones</label>
                                                                                    </div>
                                                                                    <div class="form-check">
                                                                                        <input class="form-check-input" type="checkbox" id="disc-development" checked>
                                                                                        <label class="form-check-label" for="disc-development">Desarrollo profesional</label>
                                                                                    </div>
                                                                                </div>
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>

                                                        <div class="col-md-6 mb-3">
                                                            <div class="card border">
                                                                <div class="card-body">
                                                                    <div class="d-flex align-items-center justify-content-between mb-2">
                                                                        <h4 class="card-title mb-0">Reporte de Contratación</h4>
                                                                        <div class="form-check form-switch">
                                                                            <input class="form-check-input" type="checkbox" id="report-hiring" checked>
                                                                        </div>
                                                                    </div>
                                                                    <p class="text-muted small mb-3">Recomendaciones de contratación</p>
                                                                    <div class="row">
                                                                        <div class="col-12 mb-2">
                                                                            <label class="form-label">Campos incluidos</label>
                                                                            <div class="row">
                                                                                <div class="col-sm-6">
                                                                                    <div class="form-check">
                                                                                        <input class="form-check-input" type="checkbox" id="hiring-decisions" checked>
                                                                                        <label class="form-check-label" for="hiring-decisions">Decisiones de contratación</label>
                                                                                    </div>
                                                                                    <div class="form-check">
                                                                                        <input class="form-check-input" type="checkbox" id="hiring-risks" checked>
                                                                                        <label class="form-check-label" for="hiring-risks">Análisis de riesgos</label>
                                                                                    </div>
                                                                                    <div class="form-check">
                                                                                        <input class="form-check-input" type="checkbox" id="hiring-strengths" checked>
                                                                                        <label class="form-check-label" for="hiring-strengths">Fortalezas</label>
                                                                                    </div>
                                                                                </div>
                                                                                <div class="col-sm-6">
                                                                                    <div class="form-check">
                                                                                        <input class="form-check-input" type="checkbox" id="hiring-areas" checked>
                                                                                        <label class="form-check-label" for="hiring-areas">Áreas de mejora</label>
                                                                                    </div>
                                                                                    <div class="form-check">
                                                                                        <input class="form-check-input" type="checkbox" id="hiring-fit" checked>
                                                                                        <label class="form-check-label" for="hiring-fit">Ajuste al puesto</label>
                                                                                    </div>
                                                                                    <div class="form-check">
                                                                                        <input class="form-check-input" type="checkbox" id="hiring-scores" checked>
                                                                                        <label class="form-check-label" for="hiring-scores">Puntuaciones finales</label>
                                                                                    </div>
                                                                                </div>
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>

                                                <!-- Report Customization -->
                                                <div class="settings-section">
                                                    <h3 class="mb-3">
                                                        <svg xmlns="http://www.w3.org/2000/svg" class="icon me-2" width="20" height="20" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
                                                            <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                                                            <path d="M12 21a9 9 0 0 1 0 -18c5 0 9 4 9 9a4.5 4.5 0 0 1 -4.5 4.5h-1.5a2 2 0 0 0 -2 2a1 1 0 0 1 -1 1"/>
                                                            <path d="M8.5 10.5m-1 0a1 1 0 1 0 2 0a1 1 0 1 0 -2 0"/>
                                                            <path d="M12.5 7.5m-1 0a1 1 0 1 0 2 0a1 1 0 1 0 -2 0"/>
                                                            <path d="M16.5 10.5m-1 0a1 1 0 1 0 2 0a1 1 0 1 0 -2 0"/>
                                                        </svg>
                                                        Personalización de Reportes
                                                    </h3>

                                                    <div class="row">
                                                        <div class="col-md-6 mb-3">
                                                            <label class="form-label">
                                                                Plantilla por defecto
                                                                <span class="text-muted" data-bs-toggle="tooltip" title="Plantilla que se aplicará por defecto a todos los reportes">ⓘ</span>
                                                            </label>
                                                            <select class="form-select" id="default-template">
                                                                <option value="professional" selected>Profesional</option>
                                                                <option value="detailed">Detallado</option>
                                                                <option value="summary">Resumen ejecutivo</option>
                                                                <option value="minimal">Minimalista</option>
                                                            </select>
                                                        </div>

                                                        <div class="col-md-6 mb-3">
                                                            <label class="form-label">
                                                                Idioma de reportes
                                                                <span class="text-muted" data-bs-toggle="tooltip" title="Idioma principal para la generación de reportes">ⓘ</span>
                                                            </label>
                                                            <select class="form-select" id="report-language">
                                                                <option value="es" selected>Español</option>
                                                                <option value="en">English</option>
                                                                <option value="pt">Português</option>
                                                            </select>
                                                        </div>

                                                        <div class="col-md-12 mb-3">
                                                            <label class="form-label">Visualizaciones por defecto</label>
                                                            <div class="row">
                                                                <div class="col-sm-3">
                                                                    <div class="form-check">
                                                                        <input class="form-check-input" type="checkbox" id="chart-bar" checked>
                                                                        <label class="form-check-label" for="chart-bar">Gráficos de barras</label>
                                                                    </div>
                                                                </div>
                                                                <div class="col-sm-3">
                                                                    <div class="form-check">
                                                                        <input class="form-check-input" type="checkbox" id="chart-pie" checked>
                                                                        <label class="form-check-label" for="chart-pie">Gráficos circulares</label>
                                                                    </div>
                                                                </div>
                                                                <div class="col-sm-3">
                                                                    <div class="form-check">
                                                                        <input class="form-check-input" type="checkbox" id="chart-line" checked>
                                                                        <label class="form-check-label" for="chart-line">Gráficos lineales</label>
                                                                    </div>
                                                                </div>
                                                                <div class="col-sm-3">
                                                                    <div class="form-check">
                                                                        <input class="form-check-input" type="checkbox" id="chart-radar">
                                                                        <label class="form-check-label" for="chart-radar">Gráficos radiales</label>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>

                                                        <div class="col-md-6 mb-3">
                                                            <div class="form-check form-switch">
                                                                <input class="form-check-input" type="checkbox" id="include-company-branding" checked>
                                                                <label class="form-check-label" for="include-company-branding">
                                                                    Incluir branding de la empresa
                                                                </label>
                                                            </div>
                                                        </div>

                                                        <div class="col-md-6 mb-3">
                                                            <div class="form-check form-switch">
                                                                <input class="form-check-input" type="checkbox" id="include-watermark">
                                                                <label class="form-check-label" for="include-watermark">
                                                                    Incluir marca de agua
                                                                </label>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>

                                                <!-- Export Settings -->
                                                <div class="settings-section">
                                                    <h3 class="mb-3">
                                                        <svg xmlns="http://www.w3.org/2000/svg" class="icon me-2" width="20" height="20" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
                                                            <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                                                            <path d="M14 3v4a1 1 0 0 0 1 1h4"/>
                                                            <path d="M17 21h-10a2 2 0 0 1 -2 -2v-14a2 2 0 0 1 2 -2h7l5 5v11a2 2 0 0 1 -2 2z"/>
                                                            <path d="M12 11l2 2l-2 2"/>
                                                            <path d="M11 13h1"/>
                                                        </svg>
                                                        Configuración de Exportación
                                                    </h3>

                                                    <div class="row">
                                                        <div class="col-md-4 mb-3">
                                                            <label class="form-label">Formato por defecto</label>
                                                            <select class="form-select" id="default-export-format">
                                                                <option value="pdf" selected>PDF</option>
                                                                <option value="excel">Excel (.xlsx)</option>
                                                                <option value="csv">CSV</option>
                                                                <option value="json">JSON</option>
                                                            </select>
                                                        </div>

                                                        <div class="col-md-4 mb-3">
                                                            <label class="form-label">
                                                                Calidad de PDF
                                                                <span class="text-muted" data-bs-toggle="tooltip" title="Mayor calidad = archivos más grandes">ⓘ</span>
                                                            </label>
                                                            <select class="form-select" id="pdf-quality">
                                                                <option value="high" selected>Alta calidad</option>
                                                                <option value="medium">Calidad media</option>
                                                                <option value="low">Calidad baja (archivos pequeños)</option>
                                                            </select>
                                                        </div>

                                                        <div class="col-md-4 mb-3">
                                                            <label class="form-label">Convención de nombres</label>
                                                            <select class="form-select" id="file-naming" onchange="toggleCustomNaming()">
                                                                <option value="datetime" selected>Fecha y hora</option>
                                                                <option value="candidate">Nombre del candidato</option>
                                                                <option value="custom">Personalizado</option>
                                                            </select>
                                                        </div>

                                                        <div class="col-md-12 mb-3" id="custom-naming-pattern" style="display: none;">
                                                            <label class="form-label">
                                                                Patrón personalizado
                                                                <span class="text-muted" data-bs-toggle="tooltip" title="Usa {candidato}, {fecha}, {puesto}, {tipo} como variables">ⓘ</span>
                                                            </label>
                                                            <input type="text" class="form-control" id="custom-pattern" placeholder="Reporte_{candidato}_{fecha}_{tipo}">
                                                            <div class="form-text">Ejemplo: Reporte_Juan_Perez_2025-01-18_Individual.pdf</div>
                                                        </div>

                                                        <div class="col-md-12 mb-3">
                                                            <label class="form-label">Formatos disponibles para usuarios</label>
                                                            <div class="row">
                                                                <div class="col-sm-3">
                                                                    <div class="form-check">
                                                                        <input class="form-check-input" type="checkbox" id="format-pdf" checked>
                                                                        <label class="form-check-label" for="format-pdf">PDF</label>
                                                                    </div>
                                                                </div>
                                                                <div class="col-sm-3">
                                                                    <div class="form-check">
                                                                        <input class="form-check-input" type="checkbox" id="format-excel" checked>
                                                                        <label class="form-check-label" for="format-excel">Excel</label>
                                                                    </div>
                                                                </div>
                                                                <div class="col-sm-3">
                                                                    <div class="form-check">
                                                                        <input class="form-check-input" type="checkbox" id="format-csv" checked>
                                                                        <label class="form-check-label" for="format-csv">CSV</label>
                                                                    </div>
                                                                </div>
                                                                <div class="col-sm-3">
                                                                    <div class="form-check">
                                                                        <input class="form-check-input" type="checkbox" id="format-json">
                                                                        <label class="form-check-label" for="format-json">JSON</label>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>

                                                <!-- Data Privacy & Access -->
                                                <div class="settings-section">
                                                    <h3 class="mb-3">
                                                        <svg xmlns="http://www.w3.org/2000/svg" class="icon me-2" width="20" height="20" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
                                                            <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                                                            <path d="M12 3a12 12 0 0 0 8.5 3a12 12 0 0 1 -8.5 15a12 12 0 0 1 -8.5 -15a12 12 0 0 0 8.5 -3"/>
                                                            <path d="M9 12l2 2l4 -4"/>
                                                        </svg>
                                                        Privacidad y Acceso
                                                    </h3>

                                                    <div class="row">
                                                        <div class="col-md-12 mb-4">
                                                            <h4 class="mb-3">Permisos de Acceso a Reportes</h4>
                                                            <div class="table-responsive">
                                                                <table class="table table-striped">
                                                                    <thead>
                                                                        <tr>
                                                                            <th>Tipo de Reporte</th>
                                                                            <th>Administradores</th>
                                                                            <th>HR Manager</th>
                                                                            <th>HR Analyst</th>
                                                                            <th>Solo Lectura</th>
                                                                        </tr>
                                                                    </thead>
                                                                    <tbody>
                                                                        <tr>
                                                                            <td>Reporte Individual</td>
                                                                            <td>
                                                                                <div class="form-check">
                                                                                    <input class="form-check-input" type="checkbox" id="individual-admin" checked>
                                                                                </div>
                                                                            </td>
                                                                            <td>
                                                                                <div class="form-check">
                                                                                    <input class="form-check-input" type="checkbox" id="individual-manager" checked>
                                                                                </div>
                                                                            </td>
                                                                            <td>
                                                                                <div class="form-check">
                                                                                    <input class="form-check-input" type="checkbox" id="individual-analyst" checked>
                                                                                </div>
                                                                            </td>
                                                                            <td>
                                                                                <div class="form-check">
                                                                                    <input class="form-check-input" type="checkbox" id="individual-readonly">
                                                                                </div>
                                                                            </td>
                                                                        </tr>
                                                                        <tr>
                                                                            <td>Reporte Masivo</td>
                                                                            <td>
                                                                                <div class="form-check">
                                                                                    <input class="form-check-input" type="checkbox" id="bulk-admin" checked>
                                                                                </div>
                                                                            </td>
                                                                            <td>
                                                                                <div class="form-check">
                                                                                    <input class="form-check-input" type="checkbox" id="bulk-manager" checked>
                                                                                </div>
                                                                            </td>
                                                                            <td>
                                                                                <div class="form-check">
                                                                                    <input class="form-check-input" type="checkbox" id="bulk-analyst">
                                                                                </div>
                                                                            </td>
                                                                            <td>
                                                                                <div class="form-check">
                                                                                    <input class="form-check-input" type="checkbox" id="bulk-readonly">
                                                                                </div>
                                                                            </td>
                                                                        </tr>
                                                                        <tr>
                                                                            <td>Análisis DISC</td>
                                                                            <td>
                                                                                <div class="form-check">
                                                                                    <input class="form-check-input" type="checkbox" id="disc-admin" checked>
                                                                                </div>
                                                                            </td>
                                                                            <td>
                                                                                <div class="form-check">
                                                                                    <input class="form-check-input" type="checkbox" id="disc-manager" checked>
                                                                                </div>
                                                                            </td>
                                                                            <td>
                                                                                <div class="form-check">
                                                                                    <input class="form-check-input" type="checkbox" id="disc-analyst" checked>
                                                                                </div>
                                                                            </td>
                                                                            <td>
                                                                                <div class="form-check">
                                                                                    <input class="form-check-input" type="checkbox" id="disc-readonly">
                                                                                </div>
                                                                            </td>
                                                                        </tr>
                                                                        <tr>
                                                                            <td>Reporte de Contratación</td>
                                                                            <td>
                                                                                <div class="form-check">
                                                                                    <input class="form-check-input" type="checkbox" id="hiring-admin" checked>
                                                                                </div>
                                                                            </td>
                                                                            <td>
                                                                                <div class="form-check">
                                                                                    <input class="form-check-input" type="checkbox" id="hiring-manager" checked>
                                                                                </div>
                                                                            </td>
                                                                            <td>
                                                                                <div class="form-check">
                                                                                    <input class="form-check-input" type="checkbox" id="hiring-analyst">
                                                                                </div>
                                                                            </td>
                                                                            <td>
                                                                                <div class="form-check">
                                                                                    <input class="form-check-input" type="checkbox" id="hiring-readonly">
                                                                                </div>
                                                                            </td>
                                                                        </tr>
                                                                    </tbody>
                                                                </table>
                                                            </div>
                                                        </div>

                                                        <div class="col-md-6 mb-3">
                                                            <h4 class="mb-3">Opciones de Privacidad</h4>
                                                            <div class="form-check form-switch mb-2">
                                                                <input class="form-check-input" type="checkbox" id="anonymize-data">
                                                                <label class="form-check-label" for="anonymize-data">
                                                                    Anonimizar datos sensibles
                                                                </label>
                                                            </div>
                                                            <div class="form-check form-switch mb-2">
                                                                <input class="form-check-input" type="checkbox" id="mask-personal-info">
                                                                <label class="form-check-label" for="mask-personal-info">
                                                                    Enmascarar información personal
                                                                </label>
                                                            </div>
                                                            <div class="form-check form-switch mb-2">
                                                                <input class="form-check-input" type="checkbox" id="gdpr-compliance" checked>
                                                                <label class="form-check-label" for="gdpr-compliance">
                                                                    Cumplimiento GDPR
                                                                </label>
                                                            </div>
                                                        </div>

                                                        <div class="col-md-6 mb-3">
                                                            <h4 class="mb-3">Retención de Reportes</h4>
                                                            <div class="mb-3">
                                                                <label class="form-label">
                                                                    Tiempo de retención (días)
                                                                    <span class="text-muted" data-bs-toggle="tooltip" title="Tiempo que se mantendrán los reportes generados">ⓘ</span>
                                                                </label>
                                                                <select class="form-select" id="retention-period">
                                                                    <option value="30">30 días</option>
                                                                    <option value="90" selected>90 días</option>
                                                                    <option value="180">180 días</option>
                                                                    <option value="365">1 año</option>
                                                                    <option value="0">Permanente</option>
                                                                </select>
                                                            </div>
                                                            <div class="form-check form-switch">
                                                                <input class="form-check-input" type="checkbox" id="auto-delete" checked>
                                                                <label class="form-check-label" for="auto-delete">
                                                                    Eliminación automática
                                                                </label>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>

                                                <!-- Report Automation -->
                                                <div class="settings-section">
                                                    <h3 class="mb-3">
                                                        <svg xmlns="http://www.w3.org/2000/svg" class="icon me-2" width="20" height="20" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
                                                            <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                                                            <path d="M12 8l0 4l2 2"/>
                                                            <path d="M3.05 11a9 9 0 1 1 .5 4m-.5 5v-5h5"/>
                                                        </svg>
                                                        Automatización de Reportes
                                                    </h3>

                                                    <div class="row">
                                                        <div class="col-md-6 mb-3">
                                                            <div class="form-check form-switch">
                                                                <input class="form-check-input" type="checkbox" id="enable-scheduled-reports">
                                                                <label class="form-check-label" for="enable-scheduled-reports">
                                                                    Habilitar reportes programados
                                                                </label>
                                                            </div>
                                                        </div>

                                                        <div class="col-md-6 mb-3">
                                                            <div class="form-check form-switch">
                                                                <input class="form-check-input" type="checkbox" id="enable-email-delivery">
                                                                <label class="form-check-label" for="enable-email-delivery">
                                                                    Entrega automática por email
                                                                </label>
                                                            </div>
                                                        </div>

                                                        <div class="col-md-4 mb-3">
                                                            <label class="form-label">Frecuencia por defecto</label>
                                                            <select class="form-select" id="default-frequency">
                                                                <option value="daily">Diario</option>
                                                                <option value="weekly" selected>Semanal</option>
                                                                <option value="monthly">Mensual</option>
                                                                <option value="quarterly">Trimestral</option>
                                                            </select>
                                                        </div>

                                                        <div class="col-md-4 mb-3">
                                                            <label class="form-label">Día de envío semanal</label>
                                                            <select class="form-select" id="weekly-day">
                                                                <option value="1" selected>Lunes</option>
                                                                <option value="2">Martes</option>
                                                                <option value="3">Miércoles</option>
                                                                <option value="4">Jueves</option>
                                                                <option value="5">Viernes</option>
                                                            </select>
                                                        </div>

                                                        <div class="col-md-4 mb-3">
                                                            <label class="form-label">Hora de envío</label>
                                                            <input type="time" class="form-control" id="delivery-time" value="08:00">
                                                        </div>

                                                        <div class="col-md-12 mb-3">
                                                            <label class="form-label">Emails para entrega automática</label>
                                                            <textarea class="form-control" id="auto-delivery-emails" rows="3" placeholder="manager@empresa.com, hr@empresa.com"></textarea>
                                                            <div class="form-text">Separa múltiples emails con comas</div>
                                                        </div>
                                                    </div>
                                                </div>

                                                <!-- Performance Settings -->
                                                <div class="settings-section">
                                                    <h3 class="mb-3">
                                                        <svg xmlns="http://www.w3.org/2000/svg" class="icon me-2" width="20" height="20" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
                                                            <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                                                            <path d="M3 12h4l3 8l4 -16l3 8h4"/>
                                                        </svg>
                                                        Rendimiento y Optimización
                                                    </h3>

                                                    <div class="row">
                                                        <div class="col-md-4 mb-3">
                                                            <label class="form-label">
                                                                Máximo candidatos por reporte masivo
                                                                <span class="text-muted" data-bs-toggle="tooltip" title="Limita el número de candidatos para evitar reportes muy pesados">ⓘ</span>
                                                            </label>
                                                            <input type="number" class="form-control" id="max-candidates" value="500" min="10" max="10000">
                                                        </div>

                                                        <div class="col-md-4 mb-3">
                                                            <label class="form-label">
                                                                Timeout de generación (segundos)
                                                                <span class="text-muted" data-bs-toggle="tooltip" title="Tiempo máximo para generar un reporte">ⓘ</span>
                                                            </label>
                                                            <input type="number" class="form-control" id="generation-timeout" value="300" min="30" max="1800">
                                                        </div>

                                                        <div class="col-md-4 mb-3">
                                                            <label class="form-label">
                                                                Frecuencia de actualización de datos
                                                                <span class="text-muted" data-bs-toggle="tooltip" title="Con qué frecuencia se actualizan los datos en tiempo real">ⓘ</span>
                                                            </label>
                                                            <select class="form-select" id="data-refresh">
                                                                <option value="realtime">Tiempo real</option>
                                                                <option value="5min">Cada 5 minutos</option>
                                                                <option value="15min" selected>Cada 15 minutos</option>
                                                                <option value="30min">Cada 30 minutos</option>
                                                                <option value="1hour">Cada hora</option>
                                                            </select>
                                                        </div>

                                                        <div class="col-md-6 mb-3">
                                                            <div class="form-check form-switch">
                                                                <input class="form-check-input" type="checkbox" id="enable-caching" checked>
                                                                <label class="form-check-label" for="enable-caching">
                                                                    Habilitar caché de reportes
                                                                </label>
                                                            </div>
                                                        </div>

                                                        <div class="col-md-6 mb-3">
                                                            <div class="form-check form-switch">
                                                                <input class="form-check-input" type="checkbox" id="compress-files" checked>
                                                                <label class="form-check-label" for="compress-files">
                                                                    Comprimir archivos automáticamente
                                                                </label>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>

                                                <!-- Preview Section -->
                                                <div class="settings-section">
                                                    <h3 class="mb-3">
                                                        <svg xmlns="http://www.w3.org/2000/svg" class="icon me-2" width="20" height="20" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
                                                            <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                                                            <path d="M10 12a2 2 0 1 0 4 0a2 2 0 0 0 -4 0"/>
                                                            <path d="M21 12c-2.4 4 -5.4 6 -9 6c-3.6 0 -6.6 -2 -9 -6c2.4 -4 5.4 -6 9 -6c3.6 0 6.6 2 9 6"/>
                                                        </svg>
                                                        Vista Previa de Configuración
                                                    </h3>

                                                    <div class="row">
                                                        <div class="col-md-12">
                                                            <div class="card">
                                                                <div class="card-header">
                                                                    <h4 class="card-title">Configuración Actual de Reportes</h4>
                                                                </div>
                                                                <div class="card-body">
                                                                    <div class="row">
                                                                        <div class="col-md-3">
                                                                            <h5 class="text-muted">Reportes Habilitados</h5>
                                                                            <div id="enabled-reports-preview">
                                                                                <span class="badge bg-success-lt me-1">Individual</span>
                                                                                <span class="badge bg-success-lt me-1">Masivo</span>
                                                                                <span class="badge bg-success-lt me-1">DISC</span>
                                                                                <span class="badge bg-success-lt me-1">Contratación</span>
                                                                            </div>
                                                                        </div>
                                                                        <div class="col-md-3">
                                                                            <h5 class="text-muted">Formatos Disponibles</h5>
                                                                            <div id="formats-preview">
                                                                                <span class="badge bg-primary-lt me-1">PDF</span>
                                                                                <span class="badge bg-primary-lt me-1">Excel</span>
                                                                                <span class="badge bg-primary-lt me-1">CSV</span>
                                                                            </div>
                                                                        </div>
                                                                        <div class="col-md-3">
                                                                            <h5 class="text-muted">Plantilla</h5>
                                                                            <div id="template-preview">
                                                                                <span class="badge bg-info-lt">Profesional</span>
                                                                            </div>
                                                                        </div>
                                                                        <div class="col-md-3">
                                                                            <h5 class="text-muted">Automatización</h5>
                                                                            <div id="automation-preview">
                                                                                <span class="badge bg-warning-lt">Deshabilitado</span>
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>

                                                    <div class="row mt-3">
                                                        <div class="col-md-12">
                                                            <button type="button" class="btn btn-outline-primary" onclick="previewReportConfiguration()">
                                                                <svg xmlns="http://www.w3.org/2000/svg" class="icon me-1" width="16" height="16" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
                                                                    <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                                                                    <path d="M4 12v-3a3 3 0 0 1 3 -3h13m-3 -3l3 3l-3 3"/>
                                                                </svg>
                                                                Actualizar Vista Previa
                                                            </button>
                                                            <button type="button" class="btn btn-success" onclick="testReportGeneration()">
                                                                <svg xmlns="http://www.w3.org/2000/svg" class="icon me-1" width="16" height="16" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
                                                                    <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                                                                    <path d="M5 12l5 5l10 -10"/>
                                                                </svg>
                                                                Probar Generación
                                                            </button>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                        <div class="tab-pane fade" id="advanced" role="tabpanel">
                                            <div class="settings-card">
                                                <!-- Database & Performance Section -->
                                                <div class="settings-section">
                                                    <h3 class="mb-3">
                                                        <svg xmlns="http://www.w3.org/2000/svg" class="icon me-2" width="20" height="20" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
                                                            <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                                                            <path d="M12 6m-8 0a8 3 0 1 0 16 0a8 3 0 1 0 -16 0"/>
                                                            <path d="M4 6v6a8 3 0 0 0 16 0v-6"/>
                                                            <path d="M4 12v6a8 3 0 0 0 16 0v-6"/>
                                                        </svg>
                                                        Base de Datos y Rendimiento
                                                    </h3>
                                                    <div class="row">
                                                        <div class="col-md-4 mb-3">
                                                            <label class="form-label">
                                                                Horario de mantenimiento
                                                                <span class="text-muted" data-bs-toggle="tooltip" title="Hora diaria para tareas de mantenimiento automático">ⓘ</span>
                                                            </label>
                                                            <input type="time" class="form-control" id="maintenanceTime" value="02:00">
                                                        </div>
                                                        <div class="col-md-4 mb-3">
                                                            <label class="form-label">
                                                                Límite de consultas por hora
                                                                <span class="text-muted" data-bs-toggle="tooltip" title="Máximo número de consultas API por hora por usuario">ⓘ</span>
                                                            </label>
                                                            <input type="number" class="form-control" id="queryLimit" value="1000" min="100" max="10000">
                                                        </div>
                                                        <div class="col-md-4 mb-3">
                                                            <label class="form-label">
                                                                Tiempo de cache (minutos)
                                                                <span class="text-muted" data-bs-toggle="tooltip" title="Tiempo de cacheo para consultas frecuentes">ⓘ</span>
                                                            </label>
                                                            <input type="number" class="form-control" id="cacheTime" value="15" min="1" max="1440">
                                                        </div>
                                                        <div class="col-md-6">
                                                            <div class="form-check form-switch">
                                                                <input class="form-check-input" type="checkbox" id="enableAutoVacuum" checked>
                                                                <label class="form-check-label" for="enableAutoVacuum">
                                                                    <strong>Auto-optimización DB</strong>
                                                                    <div class="text-muted small">Optimización automática de base de datos</div>
                                                                </label>
                                                            </div>
                                                        </div>
                                                        <div class="col-md-6">
                                                            <div class="form-check form-switch">
                                                                <input class="form-check-input" type="checkbox" id="enableCompression" checked>
                                                                <label class="form-check-label" for="enableCompression">
                                                                    <strong>Compresión de respuestas</strong>
                                                                    <div class="text-muted small">Comprimir respuestas API para mejor rendimiento</div>
                                                                </label>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>

                                                <!-- API Configuration Section -->
                                                <div class="settings-section">
                                                    <h3 class="mb-3">
                                                        <svg xmlns="http://www.w3.org/2000/svg" class="icon me-2" width="20" height="20" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
                                                            <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                                                            <path d="M7 10h3v-3l-3.5 -3.5a6 6 0 0 1 8.5 0l-3.5 3.5v3h3l3.5 -3.5a6 6 0 0 1 0 8.5l-3.5 -3.5h-3v3l3.5 3.5a6 6 0 0 1 -8.5 0l3.5 -3.5v-3h-3l-3.5 3.5a6 6 0 0 1 0 -8.5l3.5 3.5"/>
                                                        </svg>
                                                        Configuración de API
                                                    </h3>
                                                    <div class="row">
                                                        <div class="col-md-6 mb-3">
                                                            <label class="form-label">
                                                                Rate Limit por minuto
                                                                <span class="text-muted" data-bs-toggle="tooltip" title="Máximo número de requests por minuto por IP">ⓘ</span>
                                                            </label>
                                                            <input type="number" class="form-control" id="apiRateLimit" value="60" min="10" max="1000">
                                                        </div>
                                                        <div class="col-md-6 mb-3">
                                                            <label class="form-label">
                                                                Timeout de API (segundos)
                                                                <span class="text-muted" data-bs-toggle="tooltip" title="Tiempo límite para respuestas de API">ⓘ</span>
                                                            </label>
                                                            <input type="number" class="form-control" id="apiTimeout" value="30" min="5" max="300">
                                                        </div>
                                                        <div class="col-12 mb-3">
                                                            <label class="form-label">CORS Origins Permitidos</label>
                                                            <textarea class="form-control" id="corsOrigins" rows="3" placeholder="https://mi-dominio.com&#10;https://app.empresa.com">https://localhost:3000
https://psicometrico.netlify.app</textarea>
                                                            <small class="form-text text-muted">Un dominio por línea. Usar * para permitir todos (no recomendado en producción).</small>
                                                        </div>
                                                        <div class="col-md-6">
                                                            <div class="form-check form-switch">
                                                                <input class="form-check-input" type="checkbox" id="enableApiLogging" checked>
                                                                <label class="form-check-label" for="enableApiLogging">
                                                                    <strong>Logging de API</strong>
                                                                    <div class="text-muted small">Registrar todas las llamadas a API</div>
                                                                </label>
                                                            </div>
                                                        </div>
                                                        <div class="col-md-6">
                                                            <div class="form-check form-switch">
                                                                <input class="form-check-input" type="checkbox" id="enableApiCache">
                                                                <label class="form-check-label" for="enableApiCache">
                                                                    <strong>Cache de API</strong>
                                                                    <div class="text-muted small">Cachear respuestas para mejor rendimiento</div>
                                                                </label>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>

                                                <!-- Webhooks & Integrations Section -->
                                                <div class="settings-section">
                                                    <h3 class="mb-3">
                                                        <svg xmlns="http://www.w3.org/2000/svg" class="icon me-2" width="20" height="20" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
                                                            <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                                                            <path d="M9 15l6 -6"/>
                                                            <path d="M11 6l.463 -.536a5 5 0 0 1 7.071 7.072l-.534 .464"/>
                                                            <path d="M13 18l-.397 .534a5.068 5.068 0 0 1 -7.127 0a4.972 4.972 0 0 1 0 -7.071l.524 -.463"/>
                                                        </svg>
                                                        Webhooks e Integraciones
                                                    </h3>
                                                    <div class="row">
                                                        <div class="col-12 mb-3">
                                                            <div class="d-flex justify-content-between align-items-center mb-2">
                                                                <label class="form-label mb-0">URLs de Webhooks</label>
                                                                <button type="button" class="btn btn-sm btn-outline-primary" onclick="agregarWebhook()">
                                                                    <svg xmlns="http://www.w3.org/2000/svg" class="icon" width="16" height="16" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none">
                                                                        <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                                                                        <path d="M12 5l0 14"/>
                                                                        <path d="M5 12l14 0"/>
                                                                    </svg>
                                                                    Agregar Webhook
                                                                </button>
                                                            </div>
                                                            <div id="webhooksList" class="border rounded p-3">
                                                                <div class="webhook-item mb-2 p-2 border rounded">
                                                                    <div class="row align-items-center">
                                                                        <div class="col-md-4">
                                                                            <input type="text" class="form-control form-control-sm" placeholder="Nombre del webhook" value="Notificación de resultado">
                                                                        </div>
                                                                        <div class="col-md-6">
                                                                            <input type="url" class="form-control form-control-sm" placeholder="https://mi-sistema.com/webhook" value="">
                                                                        </div>
                                                                        <div class="col-md-2">
                                                                            <button type="button" class="btn btn-sm btn-outline-danger" onclick="eliminarWebhook(this)">
                                                                                <svg xmlns="http://www.w3.org/2000/svg" class="icon" width="16" height="16" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none">
                                                                                    <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                                                                                    <path d="M4 7l16 0"/>
                                                                                    <path d="M10 11l0 6"/>
                                                                                    <path d="M14 11l0 6"/>
                                                                                    <path d="M5 7l1 12a2 2 0 0 0 2 2h8a2 2 0 0 0 2 -2l1 -12"/>
                                                                                    <path d="M9 7v-3a1 1 0 0 1 1 -1h4a1 1 0 0 1 1 1v3"/>
                                                                                </svg>
                                                                            </button>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                            <small class="form-text text-muted">Los webhooks se activarán cuando se complete una evaluación.</small>
                                                        </div>
                                                        <div class="col-md-6">
                                                            <div class="form-check form-switch">
                                                                <input class="form-check-input" type="checkbox" id="enableWebhooks">
                                                                <label class="form-check-label" for="enableWebhooks">
                                                                    <strong>Activar Webhooks</strong>
                                                                    <div class="text-muted small">Enviar notificaciones automáticas</div>
                                                                </label>
                                                            </div>
                                                        </div>
                                                        <div class="col-md-6">
                                                            <label class="form-label">Reintentos fallidos</label>
                                                            <input type="number" class="form-control" id="webhookRetries" value="3" min="0" max="10">
                                                        </div>
                                                    </div>
                                                </div>

                                                <!-- Development & Debug Section -->
                                                <div class="settings-section">
                                                    <h3 class="mb-3">
                                                        <svg xmlns="http://www.w3.org/2000/svg" class="icon me-2" width="20" height="20" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
                                                            <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                                                            <path d="M7 10l5 -6l5 6"/>
                                                            <path d="M21 10l-2 8a2 2.5 0 0 1 -2 2h-10a2 2.5 0 0 1 -2 -2l-2 -8"/>
                                                            <path d="M12 15l0 -6"/>
                                                        </svg>
                                                        Desarrollo y Debug
                                                    </h3>
                                                    <div class="row">
                                                        <div class="col-md-4 mb-3">
                                                            <label class="form-label">Nivel de logging</label>
                                                            <select class="form-select" id="logLevel">
                                                                <option value="error">Solo errores</option>
                                                                <option value="warn">Errores y advertencias</option>
                                                                <option value="info" selected>Información general</option>
                                                                <option value="debug">Debug completo</option>
                                                            </select>
                                                        </div>
                                                        <div class="col-md-4 mb-3">
                                                            <label class="form-label">
                                                                Días de retención de logs
                                                                <span class="text-muted" data-bs-toggle="tooltip" title="Días antes de eliminar logs automáticamente">ⓘ</span>
                                                            </label>
                                                            <input type="number" class="form-control" id="logRetentionDays" value="30" min="7" max="365">
                                                        </div>
                                                        <div class="col-md-4 mb-3">
                                                            <label class="form-label">
                                                                Alertas de monitoreo
                                                                <span class="text-muted" data-bs-toggle="tooltip" title="Email para recibir alertas del sistema">ⓘ</span>
                                                            </label>
                                                            <input type="email" class="form-control" id="monitoringEmail" placeholder="admin@empresa.com">
                                                        </div>
                                                        <div class="col-md-6">
                                                            <div class="form-check form-switch">
                                                                <input class="form-check-input" type="checkbox" id="enableDebugMode">
                                                                <label class="form-check-label" for="enableDebugMode">
                                                                    <strong>Modo de desarrollo</strong>
                                                                    <div class="text-muted small">Activa logging detallado y herramientas de debug</div>
                                                                </label>
                                                            </div>
                                                        </div>
                                                        <div class="col-md-6">
                                                            <div class="form-check form-switch">
                                                                <input class="form-check-input" type="checkbox" id="enablePerformanceMonitoring" checked>
                                                                <label class="form-check-label" for="enablePerformanceMonitoring">
                                                                    <strong>Monitoreo de rendimiento</strong>
                                                                    <div class="text-muted small">Recopilar métricas de rendimiento del sistema</div>
                                                                </label>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>

                                                <!-- Custom Code Section -->
                                                <div class="settings-section">
                                                    <h3 class="mb-3">
                                                        <svg xmlns="http://www.w3.org/2000/svg" class="icon me-2" width="20" height="20" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
                                                            <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                                                            <path d="M7 8l-4 4l4 4"/>
                                                            <path d="M17 8l4 4l-4 4"/>
                                                            <path d="M14 4l-4 16"/>
                                                        </svg>
                                                        Código Personalizado
                                                    </h3>
                                                    <div class="row">
                                                        <div class="col-12 mb-3">
                                                            <label class="form-label">CSS Personalizado</label>
                                                            <textarea class="form-control font-monospace" id="customCSS" rows="6" placeholder="/* Ingresa tu CSS personalizado aquí */&#10;.custom-style {&#10;    color: #007bff;&#10;    font-weight: bold;&#10;}"></textarea>
                                                            <small class="form-text text-muted">CSS que se aplicará a todas las páginas del sistema.</small>
                                                        </div>
                                                        <div class="col-12 mb-3">
                                                            <label class="form-label">JavaScript Personalizado</label>
                                                            <textarea class="form-control font-monospace" id="customJS" rows="6" placeholder="// Ingresa tu JavaScript personalizado aquí&#10;console.log('Sistema psicométrico cargado');&#10;&#10;// Ejemplo: tracking personalizado&#10;// gtag('config', 'GA_MEASUREMENT_ID');"></textarea>
                                                            <small class="form-text text-muted">JavaScript que se ejecutará en todas las páginas del sistema.</small>
                                                        </div>
                                                        <div class="col-12">
                                                            <div class="form-check form-switch">
                                                                <input class="form-check-input" type="checkbox" id="enableCustomCode">
                                                                <label class="form-check-label" for="enableCustomCode">
                                                                    <strong>Activar código personalizado</strong>
                                                                    <div class="text-muted small">⚠️ Solo activar si confías en el código ingresado</div>
                                                                </label>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>

                                                <!-- Export/Import Advanced Section -->
                                                <div class="settings-section">
                                                    <h3 class="mb-3">
                                                        <svg xmlns="http://www.w3.org/2000/svg" class="icon me-2" width="20" height="20" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
                                                            <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                                                            <path d="M14 3v4a1 1 0 0 0 1 1h4"/>
                                                            <path d="M17 21h-10a2 2 0 0 1 -2 -2v-14a2 2 0 0 1 2 -2h7l5 5v11a2 2 0 0 1 -2 2z"/>
                                                            <path d="M8 11h8"/>
                                                            <path d="M8 15h8"/>
                                                        </svg>
                                                        Exportación e Importación Avanzada
                                                    </h3>
                                                    <div class="row">
                                                        <div class="col-md-6 mb-3">
                                                            <label class="form-label">Formato de exportación</label>
                                                            <select class="form-select" id="exportFormat">
                                                                <option value="json" selected>JSON</option>
                                                                <option value="csv">CSV</option>
                                                                <option value="xlsx">Excel (XLSX)</option>
                                                                <option value="xml">XML</option>
                                                            </select>
                                                        </div>
                                                        <div class="col-md-6 mb-3">
                                                            <div class="form-check form-switch">
                                                                <input class="form-check-input" type="checkbox" id="includeSystemData" checked>
                                                                <label class="form-check-label" for="includeSystemData">
                                                                    <strong>Incluir datos del sistema</strong>
                                                                    <div class="text-muted small">Exportar configuraciones y metadatos</div>
                                                                </label>
                                                            </div>
                                                        </div>
                                                        <div class="col-12">
                                                            <div class="btn-group" role="group">
                                                                <button type="button" class="btn btn-outline-primary" onclick="exportarDatosCompletos()">
                                                                    <svg xmlns="http://www.w3.org/2000/svg" class="icon" width="16" height="16" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none">
                                                                        <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                                                                        <path d="M14 3v4a1 1 0 0 0 1 1h4"/>
                                                                        <path d="M17 21h-10a2 2 0 0 1 -2 -2v-14a2 2 0 0 1 2 -2h7l5 5v11a2 2 0 0 1 -2 2z"/>
                                                                        <path d="M12 11l2 2l-2 2"/>
                                                                        <path d="M11 13h1"/>
                                                                    </svg>
                                                                    Exportar Datos Completos
                                                                </button>
                                                                <button type="button" class="btn btn-outline-warning" onclick="importarDatosCompletos()">
                                                                    <svg xmlns="http://www.w3.org/2000/svg" class="icon" width="16" height="16" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none">
                                                                        <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                                                                        <path d="M14 3v4a1 1 0 0 0 1 1h4"/>
                                                                        <path d="M17 21h-10a2 2 0 0 1 -2 -2v-14a2 2 0 0 1 2 -2h7l5 5v11a2 2 0 0 1 -2 2z"/>
                                                                        <path d="M12 11l-2 2l2 2"/>
                                                                        <path d="M11 13h-1"/>
                                                                    </svg>
                                                                    Importar Datos
                                                                </button>
                                                                <button type="button" class="btn btn-outline-danger" onclick="resetearSistema()">
                                                                    <svg xmlns="http://www.w3.org/2000/svg" class="icon" width="16" height="16" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none">
                                                                        <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                                                                        <path d="M20 11a8.1 8.1 0 0 0 -15.5 -2m-.5 -4v4h4"/>
                                                                        <path d="M4 13a8.1 8.1 0 0 0 15.5 2m.5 4v-4h-4"/>
                                                                    </svg>
                                                                    Resetear Sistema
                                                                </button>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>

                                                <!-- Advanced Warning Section -->
                                                <div class="settings-section">
                                                    <div class="alert alert-danger">
                                                        <h4 class="alert-title">🚨 Zona de Peligro</h4>
                                                        <div class="text-muted mb-3">
                                                            Las configuraciones avanzadas pueden afectar significativamente el funcionamiento del sistema.
                                                            Solo modifique estos valores si tiene experiencia técnica y ha realizado copias de seguridad.
                                                        </div>
                                                        <div class="d-flex gap-2">
                                                            <button type="button" class="btn btn-danger btn-sm" onclick="confirmarReseteoCompleto()">
                                                                <svg xmlns="http://www.w3.org/2000/svg" class="icon" width="16" height="16" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none">
                                                                    <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                                                                    <path d="M4 7v-1a2 2 0 0 1 2 -2h12a2 2 0 0 1 2 2v1"/>
                                                                    <path d="M4 7h16"/>
                                                                    <path d="M10 11l0 6"/>
                                                                    <path d="M14 11l0 6"/>
                                                                    <path d="M5 7l1 12a2 2 0 0 0 2 2h8a2 2 0 0 0 2 -2l1 -12"/>
                                                                </svg>
                                                                Eliminar Todos los Datos
                                                            </button>
                                                            <button type="button" class="btn btn-outline-danger btn-sm" onclick="restaurarConfiguracionDefecto()">
                                                                <svg xmlns="http://www.w3.org/2000/svg" class="icon" width="16" height="16" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none">
                                                                    <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                                                                    <path d="M20 11a8.1 8.1 0 0 0 -15.5 -2m-.5 -4v4h4"/>
                                                                    <path d="M4 13a8.1 8.1 0 0 0 15.5 2m.5 4v-4h-4"/>
                                                                </svg>
                                                                Restaurar Valores por Defecto
                                                            </button>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- Footer -->
        <footer class="footer footer-transparent d-print-none">
          <div class="container-xl">
            <div class="row text-center align-items-center flex-row-reverse">
              <div class="col-lg-auto ms-lg-auto">
                <ul class="list-inline list-inline-dots mb-0">
                  <li class="list-inline-item"><a href="#" class="link-secondary">Documentación</a></li>
                  <li class="list-inline-item"><a href="#" class="link-secondary">Soporte</a></li>
                </ul>
              </div>
              <div class="col-12 col-lg-auto mt-3 mt-lg-0">
                <ul class="list-inline list-inline-dots mb-0">
                  <li class="list-inline-item">
                    © 2025 Sistema de Evaluación Psicométrica
                  </li>
                  <li class="list-inline-item">
                    v2.0
                  </li>
                </ul>
              </div>
            </div>
          </div>
        </footer>
      </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/@tabler/core@1.4.0/dist/js/tabler.min.js" defer></script>
    <script>
        // Configuration management functions - Ensuring global scope
        window.guardarConfiguracion = function() {
            try {
                console.log('Guardando configuración...');

                // Collect form data from all configuration sections
                const formData = {
                    company: {
                        name: document.querySelector('input[placeholder="Mi Empresa S.A."]')?.value || '',
                        ruc: document.querySelector('input[placeholder="20123456789"]')?.value || '',
                        phone: document.querySelector('input[placeholder="+51 999 999 999"]')?.value || '',
                        email: document.querySelector('input[placeholder="admin@empresa.com"]')?.value || '',
                        address: document.querySelector('textarea[placeholder*="Av. Principal"]')?.value || ''
                    },
                    evaluation: {
                        timeLimit: document.querySelector('input[value="60"]')?.value || 60,
                        tokenExpiration: document.querySelector('input[value="48"]')?.value || 48,
                        allowedAttempts: document.querySelector('select')?.value || 1,
                        scoreThresholds: {
                            excellent: document.querySelector('input[value="80"]')?.value || 80,
                            good: document.querySelector('input[value="65"]')?.value || 65,
                            regular: document.querySelector('input[value="50"]')?.value || 50
                        },
                        settings: {
                            autoSave: document.querySelector('#autoSave')?.checked || false,
                            showProgress: document.querySelector('#showProgress')?.checked || false,
                            randomizeQuestions: document.querySelector('#randomizeQuestions')?.checked || false,
                            requireCompleteAnswers: document.querySelector('#requireCompleteAnswers')?.checked || false,
                            preventBackButton: document.querySelector('#preventBackButton')?.checked || false,
                            mobileFriendly: document.querySelector('#mobileFriendly')?.checked || false
                        }
                    },
                    email: {
                        provider: document.querySelector('#email-provider')?.value || 'custom',
                        enabled: document.querySelector('#email-enabled')?.checked || false,
                        smtp: {
                            host: document.querySelector('#smtp-host')?.value || '',
                            port: document.querySelector('#smtp-port')?.value || '587',
                            username: document.querySelector('#smtp-username')?.value || '',
                            password: document.querySelector('#smtp-password')?.value || '',
                            security: document.querySelector('#smtp-security')?.value || 'tls',
                            fromEmail: document.querySelector('#from-email')?.value || ''
                        },
                        notifications: {
                            autoSendInvitations: document.querySelector('#auto-send-invitations')?.checked || false,
                            autoReminders: document.querySelector('#auto-reminders')?.checked || false,
                            reminderFrequency: document.querySelector('#reminder-frequency')?.value || '48',
                            adminNotifications: document.querySelector('#admin-notifications')?.checked || false,
                            adminEmails: document.querySelector('#admin-emails')?.value || ''
                        },
                        templates: {
                            invitation: {
                                subject: document.querySelector('#invitation-subject')?.value || '',
                                content: document.querySelector('#invitation-template')?.value || ''
                            },
                            reminder: {
                                subject: document.querySelector('#reminder-subject')?.value || '',
                                content: document.querySelector('#reminder-template')?.value || ''
                            },
                            results: {
                                subject: document.querySelector('#results-subject')?.value || '',
                                content: document.querySelector('#results-template')?.value || ''
                            }
                        }
                    },
                    colors: {
                        primary: document.querySelector('.color-picker[value="#206bc4"]')?.value || '#206bc4',
                        secondary: document.querySelector('.color-picker[value="#6c757d"]')?.value || '#6c757d'
                    },
                    appearance: {
                        theme: {
                            defaultTheme: document.querySelector('#defaultTheme')?.value || 'auto',
                            allowThemeToggle: document.querySelector('#allowThemeToggle')?.checked || true
                        },
                        colors: {
                            primary: document.querySelector('#appearance-primary')?.value || '#206bc4',
                            secondary: document.querySelector('#appearance-secondary')?.value || '#6c757d',
                            accent: document.querySelector('#appearance-accent')?.value || '#17a2b8',
                            success: document.querySelector('#appearance-success')?.value || '#198754'
                        },
                        branding: {
                            customFont: document.querySelector('#customFont')?.value || '',
                            customCSS: document.querySelector('#customCSS')?.value || ''
                        },
                        dashboard: {
                            sidebarPosition: document.querySelector('#sidebarPosition')?.value || 'left',
                            navStyle: document.querySelector('#navStyle')?.value || 'horizontal',
                            cardLayout: document.querySelector('#cardLayout')?.value || 'standard',
                            stickyHeader: document.querySelector('#stickyHeader')?.checked || true,
                            showBreadcrumbs: document.querySelector('#showBreadcrumbs')?.checked || true
                        },
                        ui: {
                            fontSize: document.querySelector('#fontSize')?.value || 'medium',
                            animationSpeed: document.querySelector('#animationSpeed')?.value || 'normal',
                            interfaceLanguage: document.querySelector('#interfaceLanguage')?.value || 'es',
                            dataDensity: document.querySelector('#dataDensity')?.value || 'standard',
                            showTooltips: document.querySelector('#showTooltips')?.checked || true,
                            enableAnimations: document.querySelector('#enableAnimations')?.checked || true,
                            highContrast: document.querySelector('#highContrast')?.checked || false
                        },
                        candidateTest: {
                            testColorScheme: document.querySelector('#testColorScheme')?.value || 'professional',
                            testFontFamily: document.querySelector('#testFontFamily')?.value || 'system',
                            mobileLayout: document.querySelector('#mobileLayout')?.value || 'stacked',
                            showTestProgress: document.querySelector('#showTestProgress')?.checked || true,
                            largeButtonsTouch: document.querySelector('#largeButtonsTouch')?.checked || true
                        },
                        accessibility: {
                            screenReaderSupport: document.querySelector('#screenReaderSupport')?.checked || true,
                            keyboardNavigation: document.querySelector('#keyboardNavigation')?.checked || true,
                            reducedMotion: document.querySelector('#reducedMotion')?.checked || false,
                            focusIndicators: document.querySelector('#focusIndicators')?.checked || true,
                            alternativeText: document.querySelector('#alternativeText')?.checked || true,
                            autoPlayVideo: document.querySelector('#autoPlayVideo')?.checked || false
                        }
                    },
                    timestamp: new Date().toISOString()
                };

                // Also save reports configuration if available
                const reportsConfigSaved = saveReportsConfiguration();

                // Store in localStorage
                localStorage.setItem('psicometric_config', JSON.stringify(formData));

                // Show success message
                if (reportsConfigSaved) {
                    alert('✅ Configuración guardada exitosamente (incluyendo configuración de reportes)');
                } else {
                    alert('✅ Configuración guardada exitosamente');
                }
                console.log('Configuration saved:', formData);

            } catch (error) {
                console.error('Error saving configuration:', error);
                alert('❌ Error al guardar la configuración: ' + error.message);
            }
        };

        window.exportarConfiguracion = function() {
            try {
                console.log('Exportando configuración...');

                // Get configuration from localStorage or collect current form data
                let configData = localStorage.getItem('psicometric_config');

                if (!configData) {
                    // Call save function to collect current data
                    guardarConfiguracion();
                    configData = localStorage.getItem('psicometric_config');
                }

                if (configData) {
                    // Create and download file
                    const blob = new Blob([configData], { type: 'application/json' });
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = `psicometric_config_${new Date().toISOString().split('T')[0]}.json`;
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                    URL.revokeObjectURL(url);

                    alert('✅ Configuración exportada exitosamente');
                } else {
                    alert('⚠️ No hay configuración para exportar');
                }

            } catch (error) {
                console.error('Error exporting configuration:', error);
                alert('❌ Error al exportar la configuración: ' + error.message);
            }
        };

        window.importarConfiguracion = function() {
            try {
                console.log('Importando configuración...');

                const input = document.createElement('input');
                input.type = 'file';
                input.accept = '.json';
                input.style.display = 'none';

                input.onchange = function(event) {
                    const file = event.target.files[0];
                    if (!file) return;

                    const reader = new FileReader();
                    reader.onload = function(e) {
                        try {
                            const configData = JSON.parse(e.target.result);

                            // Validate configuration structure
                            if (!configData || typeof configData !== 'object') {
                                throw new Error('Formato de archivo inválido');
                            }

                            // Store configuration
                            localStorage.setItem('psicometric_config', JSON.stringify(configData));

                            // Load configuration into form
                            loadConfigurationToForm(configData);

                            alert('✅ Configuración importada exitosamente');
                            console.log('Configuration imported:', configData);

                        } catch (error) {
                            console.error('Error parsing configuration file:', error);
                            alert('❌ Error al importar la configuración: ' + error.message);
                        }
                    };
                    reader.readAsText(file);
                };

                document.body.appendChild(input);
                input.click();
                document.body.removeChild(input);

            } catch (error) {
                console.error('Error importing configuration:', error);
                alert('❌ Error al importar la configuración: ' + error.message);
            }
        };

        // Helper function to load configuration into form
        function loadConfigurationToForm(config) {
            try {
                if (config.company) {
                    document.querySelector('input[placeholder="Mi Empresa S.A."]').value = config.company.name || '';
                    document.querySelector('input[placeholder="20123456789"]').value = config.company.ruc || '';
                    document.querySelector('input[placeholder="+51 999 999 999"]').value = config.company.phone || '';
                    document.querySelector('input[placeholder="admin@empresa.com"]').value = config.company.email || '';
                    document.querySelector('textarea[placeholder*="Av. Principal"]').value = config.company.address || '';
                }

                if (config.evaluation) {
                    document.querySelector('input[value="60"]').value = config.evaluation.timeLimit || 60;
                    document.querySelector('input[value="48"]').value = config.evaluation.tokenExpiration || 48;
                    document.querySelector('select').value = config.evaluation.allowedAttempts || 1;

                    if (config.evaluation.scoreThresholds) {
                        document.querySelector('input[value="80"]').value = config.evaluation.scoreThresholds.excellent || 80;
                        document.querySelector('input[value="65"]').value = config.evaluation.scoreThresholds.good || 65;
                        document.querySelector('input[value="50"]').value = config.evaluation.scoreThresholds.regular || 50;
                    }

                    if (config.evaluation.settings) {
                        document.querySelector('#autoSave').checked = config.evaluation.settings.autoSave || false;
                        document.querySelector('#showProgress').checked = config.evaluation.settings.showProgress || false;
                        document.querySelector('#randomizeQuestions').checked = config.evaluation.settings.randomizeQuestions || false;
                        document.querySelector('#requireCompleteAnswers').checked = config.evaluation.settings.requireCompleteAnswers || false;
                        document.querySelector('#preventBackButton').checked = config.evaluation.settings.preventBackButton || false;
                        document.querySelector('#mobileFriendly').checked = config.evaluation.settings.mobileFriendly || false;
                    }
                }

                if (config.email) {
                    // Email server configuration
                    if (config.email.provider) {
                        document.querySelector('#email-provider').value = config.email.provider;
                    }
                    if (config.email.enabled !== undefined) {
                        document.querySelector('#email-enabled').checked = config.email.enabled;
                    }

                    if (config.email.smtp) {
                        document.querySelector('#smtp-host').value = config.email.smtp.host || '';
                        document.querySelector('#smtp-port').value = config.email.smtp.port || '587';
                        document.querySelector('#smtp-username').value = config.email.smtp.username || '';
                        document.querySelector('#smtp-password').value = config.email.smtp.password || '';
                        document.querySelector('#smtp-security').value = config.email.smtp.security || 'tls';
                        document.querySelector('#from-email').value = config.email.smtp.fromEmail || '';
                    }

                    // Notifications configuration
                    if (config.email.notifications) {
                        document.querySelector('#auto-send-invitations').checked = config.email.notifications.autoSendInvitations || false;
                        document.querySelector('#auto-reminders').checked = config.email.notifications.autoReminders || false;
                        document.querySelector('#reminder-frequency').value = config.email.notifications.reminderFrequency || '48';
                        document.querySelector('#admin-notifications').checked = config.email.notifications.adminNotifications || false;
                        document.querySelector('#admin-emails').value = config.email.notifications.adminEmails || '';
                    }

                    // Email templates
                    if (config.email.templates) {
                        if (config.email.templates.invitation) {
                            document.querySelector('#invitation-subject').value = config.email.templates.invitation.subject || '';
                            document.querySelector('#invitation-template').value = config.email.templates.invitation.content || '';
                        }
                        if (config.email.templates.reminder) {
                            document.querySelector('#reminder-subject').value = config.email.templates.reminder.subject || '';
                            document.querySelector('#reminder-template').value = config.email.templates.reminder.content || '';
                        }
                        if (config.email.templates.results) {
                            document.querySelector('#results-subject').value = config.email.templates.results.subject || '';
                            document.querySelector('#results-template').value = config.email.templates.results.content || '';
                        }
                    }
                }

                if (config.colors) {
                    const primaryPicker = document.querySelector('.color-picker[value="#206bc4"]');
                    const secondaryPicker = document.querySelector('.color-picker[value="#6c757d"]');

                    if (primaryPicker) {
                        primaryPicker.value = config.colors.primary || '#206bc4';
                        primaryPicker.nextElementSibling.value = config.colors.primary || '#206bc4';
                    }

                    if (secondaryPicker) {
                        secondaryPicker.value = config.colors.secondary || '#6c757d';
                        secondaryPicker.nextElementSibling.value = config.colors.secondary || '#6c757d';
                    }
                }
            } catch (error) {
                console.error('Error loading configuration to form:', error);
            }
        }

        // Color picker sync
        document.addEventListener('DOMContentLoaded', function() {
            // Load saved configuration on page load
            try {
                const savedConfig = localStorage.getItem('psicometric_config');
                if (savedConfig) {
                    const config = JSON.parse(savedConfig);
                    loadConfigurationToForm(config);
                }
            } catch (error) {
                console.error('Error loading saved configuration:', error);
            }

            // Setup color picker synchronization
            const colorPickers = document.querySelectorAll('.color-picker');
            colorPickers.forEach(picker => {
                const textInput = picker.nextElementSibling;
                if (textInput) {
                    picker.addEventListener('change', function() {
                        textInput.value = this.value;
                    });
                }
            });

            // Test if functions are accessible
            console.log('Configuration functions loaded:', {
                guardarConfiguracion: typeof window.guardarConfiguracion,
                exportarConfiguracion: typeof window.exportarConfiguracion,
                importarConfiguracion: typeof window.importarConfiguracion
            });
        });

        // Appearance Settings Functions
        window.updateColorText = function(colorPickerId, textInputId) {
            const colorPicker = document.getElementById(colorPickerId);
            const textInput = document.getElementById(textInputId);
            if (colorPicker && textInput) {
                textInput.value = colorPicker.value;
                updateColorPreview();
            }
        };

        window.updateColorPicker = function(textInputId, colorPickerId) {
            const textInput = document.getElementById(textInputId);
            const colorPicker = document.getElementById(colorPickerId);
            if (textInput && colorPicker) {
                const colorValue = textInput.value;
                if (/^#[0-9A-F]{6}$/i.test(colorValue)) {
                    colorPicker.value = colorValue;
                    updateColorPreview();
                }
            }
        };

        window.updateColorPreview = function() {
            const primaryColor = document.getElementById('appearance-primary')?.value || '#206bc4';
            const secondaryColor = document.getElementById('appearance-secondary')?.value || '#6c757d';
            const accentColor = document.getElementById('appearance-accent')?.value || '#17a2b8';
            const successColor = document.getElementById('appearance-success')?.value || '#198754';

            // Update preview buttons
            const primaryBtn = document.getElementById('preview-primary');
            const secondaryBtn = document.getElementById('preview-secondary');
            const accentAlert = document.getElementById('preview-accent');
            const successAlert = document.getElementById('preview-success');

            if (primaryBtn) primaryBtn.style.backgroundColor = primaryColor;
            if (secondaryBtn) secondaryBtn.style.backgroundColor = secondaryColor;
            if (accentAlert) accentAlert.style.backgroundColor = accentColor + '20';
            if (successAlert) successAlert.style.backgroundColor = successColor + '20';
        };

        window.previewTheme = function(theme) {
            // Temporarily apply theme for preview
            document.documentElement.setAttribute('data-bs-theme', theme);
            localStorage.setItem('theme', theme);
            updateThemeToggleIcon();

            // Show confirmation message
            const message = theme === 'light' ? 'Tema claro aplicado' : 'Tema oscuro aplicado';
            showToast(message, 'info');
        };

        window.applyColorPreview = function() {
            updateColorPreview();
            showToast('Vista previa de colores aplicada', 'success');
        };

        window.previewAppearanceChanges = function() {
            try {
                // Apply theme changes
                const defaultTheme = document.getElementById('defaultTheme')?.value || 'auto';
                previewTheme(defaultTheme);

                // Apply color changes
                updateColorPreview();

                // Apply font changes
                const customFont = document.getElementById('customFont')?.value;
                if (customFont) {
                    // Load Google Font dynamically
                    const link = document.createElement('link');
                    link.href = `https://fonts.googleapis.com/css2?family=${encodeURIComponent(customFont)}:wght@400;500;600;700&display=swap`;
                    link.rel = 'stylesheet';
                    document.head.appendChild(link);

                    // Apply font to body
                    document.body.style.fontFamily = `"${customFont}", -apple-system, BlinkMacSystemFont, sans-serif`;
                }

                // Apply custom CSS
                const customCSS = document.getElementById('customCSS')?.value;
                if (customCSS) {
                    let styleElement = document.getElementById('custom-appearance-styles');
                    if (!styleElement) {
                        styleElement = document.createElement('style');
                        styleElement.id = 'custom-appearance-styles';
                        document.head.appendChild(styleElement);
                    }
                    styleElement.textContent = customCSS;
                }

                showToast('Vista previa de apariencia aplicada exitosamente', 'success');
            } catch (error) {
                console.error('Error applying appearance preview:', error);
                showToast('Error al aplicar vista previa', 'danger');
            }
        };

        window.resetAppearanceChanges = function() {
            try {
                // Reset theme
                document.documentElement.setAttribute('data-bs-theme', 'light');
                localStorage.setItem('theme', 'light');
                updateThemeToggleIcon();

                // Reset colors to defaults
                document.getElementById('appearance-primary').value = '#206bc4';
                document.getElementById('appearance-primary-text').value = '#206bc4';
                document.getElementById('appearance-secondary').value = '#6c757d';
                document.getElementById('appearance-secondary-text').value = '#6c757d';
                document.getElementById('appearance-accent').value = '#17a2b8';
                document.getElementById('appearance-accent-text').value = '#17a2b8';
                document.getElementById('appearance-success').value = '#198754';
                document.getElementById('appearance-success-text').value = '#198754';

                // Update preview with defaults
                updateColorPreview();

                // Reset custom font
                document.body.style.fontFamily = '';

                // Remove custom CSS
                const styleElement = document.getElementById('custom-appearance-styles');
                if (styleElement) {
                    styleElement.remove();
                }

                showToast('Configuración de apariencia restaurada', 'info');
            } catch (error) {
                console.error('Error resetting appearance:', error);
                showToast('Error al restaurar configuración', 'danger');
            }
        };

        window.exportAppearanceConfig = function() {
            try {
                const appearanceConfig = {
                    theme: {
                        defaultTheme: document.getElementById('defaultTheme')?.value || 'auto',
                        allowThemeToggle: document.getElementById('allowThemeToggle')?.checked || true
                    },
                    colors: {
                        primary: document.getElementById('appearance-primary')?.value || '#206bc4',
                        secondary: document.getElementById('appearance-secondary')?.value || '#6c757d',
                        accent: document.getElementById('appearance-accent')?.value || '#17a2b8',
                        success: document.getElementById('appearance-success')?.value || '#198754'
                    },
                    branding: {
                        customFont: document.getElementById('customFont')?.value || '',
                        customCSS: document.getElementById('customCSS')?.value || ''
                    },
                    dashboard: {
                        sidebarPosition: document.getElementById('sidebarPosition')?.value || 'left',
                        navStyle: document.getElementById('navStyle')?.value || 'horizontal',
                        cardLayout: document.getElementById('cardLayout')?.value || 'standard',
                        stickyHeader: document.getElementById('stickyHeader')?.checked || true,
                        showBreadcrumbs: document.getElementById('showBreadcrumbs')?.checked || true
                    },
                    ui: {
                        fontSize: document.getElementById('fontSize')?.value || 'medium',
                        animationSpeed: document.getElementById('animationSpeed')?.value || 'normal',
                        interfaceLanguage: document.getElementById('interfaceLanguage')?.value || 'es',
                        dataDensity: document.getElementById('dataDensity')?.value || 'standard',
                        showTooltips: document.getElementById('showTooltips')?.checked || true,
                        enableAnimations: document.getElementById('enableAnimations')?.checked || true,
                        highContrast: document.getElementById('highContrast')?.checked || false
                    },
                    candidateTest: {
                        testColorScheme: document.getElementById('testColorScheme')?.value || 'professional',
                        testFontFamily: document.getElementById('testFontFamily')?.value || 'system',
                        mobileLayout: document.getElementById('mobileLayout')?.value || 'stacked',
                        showTestProgress: document.getElementById('showTestProgress')?.checked || true,
                        largeButtonsTouch: document.getElementById('largeButtonsTouch')?.checked || true
                    },
                    accessibility: {
                        screenReaderSupport: document.getElementById('screenReaderSupport')?.checked || true,
                        keyboardNavigation: document.getElementById('keyboardNavigation')?.checked || true,
                        reducedMotion: document.getElementById('reducedMotion')?.checked || false,
                        focusIndicators: document.getElementById('focusIndicators')?.checked || true,
                        alternativeText: document.getElementById('alternativeText')?.checked || true,
                        autoPlayVideo: document.getElementById('autoPlayVideo')?.checked || false
                    },
                    exportDate: new Date().toISOString()
                };

                // Create and download file
                const blob = new Blob([JSON.stringify(appearanceConfig, null, 2)], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `appearance_theme_${new Date().toISOString().split('T')[0]}.json`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);

                showToast('Tema de apariencia exportado exitosamente', 'success');
            } catch (error) {
                console.error('Error exporting appearance config:', error);
                showToast('Error al exportar tema', 'danger');
            }
        };

        // Helper function to show toast notifications
        function showToast(message, type = 'info') {
            // Create toast element if it doesn't exist
            let toastContainer = document.getElementById('toast-container');
            if (!toastContainer) {
                toastContainer = document.createElement('div');
                toastContainer.id = 'toast-container';
                toastContainer.className = 'position-fixed top-0 end-0 p-3';
                toastContainer.style.zIndex = '9999';
                document.body.appendChild(toastContainer);
            }

            const toastId = 'toast-' + Date.now();
            const toast = document.createElement('div');
            toast.id = toastId;
            toast.className = `toast align-items-center text-white bg-${type} border-0`;
            toast.setAttribute('role', 'alert');
            toast.innerHTML = `
                <div class="d-flex">
                    <div class="toast-body">${message}</div>
                    <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"></button>
                </div>
            `;

            toastContainer.appendChild(toast);
            const bsToast = new bootstrap.Toast(toast);
            bsToast.show();

            // Remove toast after it's hidden
            toast.addEventListener('hidden.bs.toast', function() {
                toast.remove();
            });
        }

        // Initialize appearance settings on page load
        document.addEventListener('DOMContentLoaded', function() {
            // Load appearance configuration if it exists
            try {
                const savedConfig = localStorage.getItem('psicometric_config');
                if (savedConfig) {
                    const config = JSON.parse(savedConfig);
                    if (config.appearance) {
                        loadAppearanceConfig(config.appearance);
                    }
                }
            } catch (error) {
                console.error('Error loading appearance configuration:', error);
            }

            // Initialize color preview
            updateColorPreview();

            // Setup file upload preview for favicon
            const faviconUpload = document.getElementById('faviconUpload');
            if (faviconUpload) {
                faviconUpload.addEventListener('change', function(e) {
                    const file = e.target.files[0];
                    if (file) {
                        const reader = new FileReader();
                        reader.onload = function(e) {
                            // Show preview (could be enhanced to actually update favicon)
                            showToast(`Favicon "${file.name}" cargado (vista previa)`, 'info');
                        };
                        reader.readAsDataURL(file);
                    }
                });
            }
        });

        function loadAppearanceConfig(appearance) {
            try {
                // Load theme settings
                if (appearance.theme) {
                    const defaultTheme = document.getElementById('defaultTheme');
                    const allowThemeToggle = document.getElementById('allowThemeToggle');
                    if (defaultTheme) defaultTheme.value = appearance.theme.defaultTheme || 'auto';
                    if (allowThemeToggle) allowThemeToggle.checked = appearance.theme.allowThemeToggle !== false;
                }

                // Load color settings
                if (appearance.colors) {
                    const elements = [
                        { id: 'appearance-primary', textId: 'appearance-primary-text', value: appearance.colors.primary },
                        { id: 'appearance-secondary', textId: 'appearance-secondary-text', value: appearance.colors.secondary },
                        { id: 'appearance-accent', textId: 'appearance-accent-text', value: appearance.colors.accent },
                        { id: 'appearance-success', textId: 'appearance-success-text', value: appearance.colors.success }
                    ];

                    elements.forEach(({ id, textId, value }) => {
                        if (value) {
                            const colorPicker = document.getElementById(id);
                            const textInput = document.getElementById(textId);
                            if (colorPicker) colorPicker.value = value;
                            if (textInput) textInput.value = value;
                        }
                    });

                    updateColorPreview();
                }

                // Load branding settings
                if (appearance.branding) {
                    const customFont = document.getElementById('customFont');
                    const customCSS = document.getElementById('customCSS');
                    if (customFont && appearance.branding.customFont) {
                        customFont.value = appearance.branding.customFont;
                    }
                    if (customCSS && appearance.branding.customCSS) {
                        customCSS.value = appearance.branding.customCSS;
                    }
                }

                // Load dashboard settings
                if (appearance.dashboard) {
                    const dashboardElements = ['sidebarPosition', 'navStyle', 'cardLayout'];
                    dashboardElements.forEach(id => {
                        const element = document.getElementById(id);
                        if (element && appearance.dashboard[id]) {
                            element.value = appearance.dashboard[id];
                        }
                    });

                    const checkboxElements = ['stickyHeader', 'showBreadcrumbs'];
                    checkboxElements.forEach(id => {
                        const element = document.getElementById(id);
                        if (element && appearance.dashboard[id] !== undefined) {
                            element.checked = appearance.dashboard[id];
                        }
                    });
                }

                // Load UI settings
                if (appearance.ui) {
                    const uiSelectElements = ['fontSize', 'animationSpeed', 'interfaceLanguage', 'dataDensity'];
                    uiSelectElements.forEach(id => {
                        const element = document.getElementById(id);
                        if (element && appearance.ui[id]) {
                            element.value = appearance.ui[id];
                        }
                    });

                    const uiCheckboxElements = ['showTooltips', 'enableAnimations', 'highContrast'];
                    uiCheckboxElements.forEach(id => {
                        const element = document.getElementById(id);
                        if (element && appearance.ui[id] !== undefined) {
                            element.checked = appearance.ui[id];
                        }
                    });
                }

                // Load candidate test settings
                if (appearance.candidateTest) {
                    const testSelectElements = ['testColorScheme', 'testFontFamily', 'mobileLayout'];
                    testSelectElements.forEach(id => {
                        const element = document.getElementById(id);
                        if (element && appearance.candidateTest[id]) {
                            element.value = appearance.candidateTest[id];
                        }
                    });

                    const testCheckboxElements = ['showTestProgress', 'largeButtonsTouch'];
                    testCheckboxElements.forEach(id => {
                        const element = document.getElementById(id);
                        if (element && appearance.candidateTest[id] !== undefined) {
                            element.checked = appearance.candidateTest[id];
                        }
                    });
                }

                // Load accessibility settings
                if (appearance.accessibility) {
                    const accessibilityElements = [
                        'screenReaderSupport', 'keyboardNavigation', 'reducedMotion',
                        'focusIndicators', 'alternativeText', 'autoPlayVideo'
                    ];
                    accessibilityElements.forEach(id => {
                        const element = document.getElementById(id);
                        if (element && appearance.accessibility[id] !== undefined) {
                            element.checked = appearance.accessibility[id];
                        }
                    });
                }
            } catch (error) {
                console.error('Error loading appearance configuration to form:', error);
            }
        }

        // Job Positions Management Functions
        window.agregarPuesto = function() {
            const modalId = 'modal-nuevo-puesto';

            // Create modal if it doesn't exist
            if (!document.getElementById(modalId)) {
                const modalHtml = `
                    <div class="modal fade" id="${modalId}" tabindex="-1" aria-hidden="true">
                        <div class="modal-dialog modal-lg">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <h5 class="modal-title">Agregar Nuevo Puesto</h5>
                                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                                </div>
                                <div class="modal-body">
                                    <form id="form-nuevo-puesto">
                                        <div class="row">
                                            <div class="col-md-6 mb-3">
                                                <label class="form-label">Nombre del Puesto</label>
                                                <input type="text" class="form-control" name="nombre" required>
                                            </div>
                                            <div class="col-md-6 mb-3">
                                                <label class="form-label">Descripción</label>
                                                <input type="text" class="form-control" name="descripcion">
                                            </div>
                                            <div class="col-md-6 mb-3">
                                                <label class="form-label">Prioridad</label>
                                                <select class="form-select" name="prioridad">
                                                    <option value="critico">Crítico</option>
                                                    <option value="alto">Alto</option>
                                                    <option value="medio">Medio</option>
                                                    <option value="bajo">Bajo</option>
                                                </select>
                                            </div>
                                            <div class="col-md-6 mb-3">
                                                <label class="form-label">Estado</label>
                                                <select class="form-select" name="estado">
                                                    <option value="activo">Activo</option>
                                                    <option value="inactivo">Inactivo</option>
                                                </select>
                                            </div>
                                        </div>

                                        <h6 class="mb-3">Criterios DISC</h6>
                                        <div class="row">
                                            <div class="col-md-3 mb-3">
                                                <label class="form-label">Dominancia (D)</label>
                                                <div class="input-group">
                                                    <input type="number" class="form-control" name="d_min" value="2" min="1" max="9">
                                                    <span class="input-group-text">-</span>
                                                    <input type="number" class="form-control" name="d_max" value="4" min="1" max="9">
                                                </div>
                                            </div>
                                            <div class="col-md-3 mb-3">
                                                <label class="form-label">Influencia (I)</label>
                                                <div class="input-group">
                                                    <input type="number" class="form-control" name="i_min" value="3" min="1" max="9">
                                                    <span class="input-group-text">-</span>
                                                    <input type="number" class="form-control" name="i_max" value="5" min="1" max="9">
                                                </div>
                                            </div>
                                            <div class="col-md-3 mb-3">
                                                <label class="form-label">Estabilidad (S)</label>
                                                <div class="input-group">
                                                    <input type="number" class="form-control" name="s_min" value="6" min="1" max="9">
                                                    <span class="input-group-text">-</span>
                                                    <input type="number" class="form-control" name="s_max" value="9" min="1" max="9">
                                                </div>
                                            </div>
                                            <div class="col-md-3 mb-3">
                                                <label class="form-label">Conformidad (C)</label>
                                                <div class="input-group">
                                                    <input type="number" class="form-control" name="c_min" value="7" min="1" max="9">
                                                    <span class="input-group-text">-</span>
                                                    <input type="number" class="form-control" name="c_max" value="9" min="1" max="9">
                                                </div>
                                            </div>
                                        </div>
                                    </form>
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                                    <button type="button" class="btn btn-primary" onclick="guardarNuevoPuesto()">Guardar Puesto</button>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
                document.body.insertAdjacentHTML('beforeend', modalHtml);
            }

            // Show modal
            const modal = new bootstrap.Modal(document.getElementById(modalId));
            modal.show();
        };

        window.editarPuesto = function(positionId) {
            const positions = getStoredPositions();
            const position = positions.find(p => p.id === positionId);

            if (!position) {
                alert('❌ Puesto no encontrado');
                return;
            }

            // Create edit modal
            const modalId = 'modal-editar-puesto';

            // Remove existing modal if any
            const existingModal = document.getElementById(modalId);
            if (existingModal) {
                existingModal.remove();
            }

            const modalHtml = `
                <div class="modal fade" id="${modalId}" tabindex="-1" aria-hidden="true">
                    <div class="modal-dialog modal-lg">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title">Editar Puesto: ${position.nombre}</h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                            </div>
                            <div class="modal-body">
                                <form id="form-editar-puesto">
                                    <input type="hidden" name="id" value="${position.id}">
                                    <div class="row">
                                        <div class="col-md-6 mb-3">
                                            <label class="form-label">Nombre del Puesto</label>
                                            <input type="text" class="form-control" name="nombre" value="${position.nombre}" required>
                                        </div>
                                        <div class="col-md-6 mb-3">
                                            <label class="form-label">Descripción</label>
                                            <input type="text" class="form-control" name="descripcion" value="${position.descripcion || ''}">
                                        </div>
                                        <div class="col-md-6 mb-3">
                                            <label class="form-label">Prioridad</label>
                                            <select class="form-select" name="prioridad">
                                                <option value="critico" ${position.prioridad === 'critico' ? 'selected' : ''}>Crítico</option>
                                                <option value="alto" ${position.prioridad === 'alto' ? 'selected' : ''}>Alto</option>
                                                <option value="medio" ${position.prioridad === 'medio' ? 'selected' : ''}>Medio</option>
                                                <option value="bajo" ${position.prioridad === 'bajo' ? 'selected' : ''}>Bajo</option>
                                            </select>
                                        </div>
                                        <div class="col-md-6 mb-3">
                                            <label class="form-label">Estado</label>
                                            <select class="form-select" name="estado">
                                                <option value="activo" ${position.estado === 'activo' ? 'selected' : ''}>Activo</option>
                                                <option value="inactivo" ${position.estado === 'inactivo' ? 'selected' : ''}>Inactivo</option>
                                            </select>
                                        </div>
                                    </div>

                                    <h6 class="mb-3">Criterios DISC</h6>
                                    <div class="row">
                                        <div class="col-md-3 mb-3">
                                            <label class="form-label">Dominancia (D)</label>
                                            <div class="input-group">
                                                <input type="number" class="form-control" name="d_min" value="${position.disc.d_min}" min="1" max="9">
                                                <span class="input-group-text">-</span>
                                                <input type="number" class="form-control" name="d_max" value="${position.disc.d_max}" min="1" max="9">
                                            </div>
                                        </div>
                                        <div class="col-md-3 mb-3">
                                            <label class="form-label">Influencia (I)</label>
                                            <div class="input-group">
                                                <input type="number" class="form-control" name="i_min" value="${position.disc.i_min}" min="1" max="9">
                                                <span class="input-group-text">-</span>
                                                <input type="number" class="form-control" name="i_max" value="${position.disc.i_max}" min="1" max="9">
                                            </div>
                                        </div>
                                        <div class="col-md-3 mb-3">
                                            <label class="form-label">Estabilidad (S)</label>
                                            <div class="input-group">
                                                <input type="number" class="form-control" name="s_min" value="${position.disc.s_min}" min="1" max="9">
                                                <span class="input-group-text">-</span>
                                                <input type="number" class="form-control" name="s_max" value="${position.disc.s_max}" min="1" max="9">
                                            </div>
                                        </div>
                                        <div class="col-md-3 mb-3">
                                            <label class="form-label">Conformidad (C)</label>
                                            <div class="input-group">
                                                <input type="number" class="form-control" name="c_min" value="${position.disc.c_min}" min="1" max="9">
                                                <span class="input-group-text">-</span>
                                                <input type="number" class="form-control" name="c_max" value="${position.disc.c_max}" min="1" max="9">
                                            </div>
                                        </div>
                                    </div>
                                </form>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                                <button type="button" class="btn btn-primary" onclick="actualizarPuesto()">Actualizar Puesto</button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            document.body.insertAdjacentHTML('beforeend', modalHtml);

            // Show modal
            const modal = new bootstrap.Modal(document.getElementById(modalId));
            modal.show();
        };

        window.eliminarPuesto = function(positionId) {
            if (confirm('¿Estás seguro de que quieres eliminar este puesto?')) {
                let positions = getStoredPositions();
                positions = positions.filter(p => p.id !== positionId);
                storePositions(positions);

                // Remove from table
                const row = document.querySelector(`tr[data-position-id="${positionId}"]`);
                if (row) {
                    row.remove();
                }

                alert('✅ Puesto eliminado exitosamente');
            }
        };

        window.guardarNuevoPuesto = function() {
            const form = document.getElementById('form-nuevo-puesto');
            const formData = new FormData(form);

            const newPosition = {
                id: formData.get('nombre').toLowerCase().replace(/\s+/g, '-'),
                nombre: formData.get('nombre'),
                descripcion: formData.get('descripcion'),
                prioridad: formData.get('prioridad'),
                estado: formData.get('estado'),
                disc: {
                    d_min: parseInt(formData.get('d_min')),
                    d_max: parseInt(formData.get('d_max')),
                    i_min: parseInt(formData.get('i_min')),
                    i_max: parseInt(formData.get('i_max')),
                    s_min: parseInt(formData.get('s_min')),
                    s_max: parseInt(formData.get('s_max')),
                    c_min: parseInt(formData.get('c_min')),
                    c_max: parseInt(formData.get('c_max'))
                }
            };

            // Validate
            if (!newPosition.nombre.trim()) {
                alert('❌ El nombre del puesto es requerido');
                return;
            }

            // Check for duplicates
            const existingPositions = getStoredPositions();
            if (existingPositions.find(p => p.id === newPosition.id)) {
                alert('❌ Ya existe un puesto con ese nombre');
                return;
            }

            // Save
            existingPositions.push(newPosition);
            storePositions(existingPositions);

            // Add to table
            addPositionToTable(newPosition);

            // Close modal
            const modal = bootstrap.Modal.getInstance(document.getElementById('modal-nuevo-puesto'));
            modal.hide();

            alert('✅ Puesto agregado exitosamente');
        };

        window.actualizarPuesto = function() {
            const form = document.getElementById('form-editar-puesto');
            const formData = new FormData(form);

            const updatedPosition = {
                id: formData.get('id'),
                nombre: formData.get('nombre'),
                descripcion: formData.get('descripcion'),
                prioridad: formData.get('prioridad'),
                estado: formData.get('estado'),
                disc: {
                    d_min: parseInt(formData.get('d_min')),
                    d_max: parseInt(formData.get('d_max')),
                    i_min: parseInt(formData.get('i_min')),
                    i_max: parseInt(formData.get('i_max')),
                    s_min: parseInt(formData.get('s_min')),
                    s_max: parseInt(formData.get('s_max')),
                    c_min: parseInt(formData.get('c_min')),
                    c_max: parseInt(formData.get('c_max'))
                }
            };

            // Update in storage
            let positions = getStoredPositions();
            const index = positions.findIndex(p => p.id === updatedPosition.id);
            if (index !== -1) {
                positions[index] = updatedPosition;
                storePositions(positions);

                // Update table row
                updatePositionInTable(updatedPosition);

                // Close modal
                const modal = bootstrap.Modal.getInstance(document.getElementById('modal-editar-puesto'));
                modal.hide();

                alert('✅ Puesto actualizado exitosamente');
            } else {
                alert('❌ Error al actualizar el puesto');
            }
        };

        // Helper functions
        function getStoredPositions() {
            const stored = localStorage.getItem('job_positions');
            if (stored) {
                return JSON.parse(stored);
            }

            // Default positions
            return [
                {
                    id: 'soldador',
                    nombre: 'Soldador',
                    descripcion: 'Soldadura en letreros luminosos',
                    prioridad: 'critico',
                    estado: 'activo',
                    disc: { d_min: 2, d_max: 3, i_min: 4, i_max: 5, s_min: 7, s_max: 9, c_min: 7, c_max: 8 }
                },
                {
                    id: 'electricista',
                    nombre: 'Electricista',
                    descripcion: 'Instalaciones eléctricas',
                    prioridad: 'critico',
                    estado: 'activo',
                    disc: { d_min: 3, d_max: 4, i_min: 3, i_max: 4, s_min: 6, s_max: 8, c_min: 8, c_max: 9 }
                }
            ];
        }

        function storePositions(positions) {
            localStorage.setItem('job_positions', JSON.stringify(positions));
        }

        function addPositionToTable(position) {
            const tableBody = document.getElementById('positionsTableBody');
            const priorityBadge = getPriorityBadge(position.prioridad);
            const statusBadge = getStatusBadge(position.estado);
            const avatar = position.nombre.charAt(0).toUpperCase();

            const row = `
                <tr data-position-id="${position.id}">
                    <td>
                        <div class="d-flex align-items-center">
                            <div class="avatar avatar-sm me-2" style="background-color: #206bc4; color: white;">
                                ${avatar}
                            </div>
                            <div>
                                <div class="fw-bold">${position.nombre}</div>
                                <div class="text-muted small">${position.descripcion || ''}</div>
                            </div>
                        </div>
                    </td>
                    <td>
                        <div class="d-flex gap-1">
                            <span class="badge bg-secondary">D: ${position.disc.d_min}-${position.disc.d_max}</span>
                            <span class="badge bg-warning">I: ${position.disc.i_min}-${position.disc.i_max}</span>
                            <span class="badge bg-success">S: ${position.disc.s_min}-${position.disc.s_max}</span>
                            <span class="badge bg-info">C: ${position.disc.c_min}-${position.disc.c_max}</span>
                        </div>
                    </td>
                    <td>${priorityBadge}</td>
                    <td>${statusBadge}</td>
                    <td>
                        <div class="btn-group" role="group">
                            <button type="button" class="btn btn-sm btn-outline-primary" onclick="editarPuesto('${position.id}')">
                                <svg xmlns="http://www.w3.org/2000/svg" class="icon" width="16" height="16" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none">
                                    <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                                    <path d="M7 7h-1a2 2 0 0 0 -2 2v9a2 2 0 0 0 2 2h9a2 2 0 0 0 2 -2v-1"/>
                                    <path d="M20.385 6.585a2.1 2.1 0 0 0 -2.97 -2.97l-8.415 8.385v3h3l8.385 -8.415z"/>
                                    <path d="M16 5l3 3"/>
                                </svg>
                            </button>
                            <button type="button" class="btn btn-sm btn-outline-danger" onclick="eliminarPuesto('${position.id}')">
                                <svg xmlns="http://www.w3.org/2000/svg" class="icon" width="16" height="16" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none">
                                    <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                                    <path d="M4 7l16 0"/>
                                    <path d="M10 11l0 6"/>
                                    <path d="M14 11l0 6"/>
                                    <path d="M5 7l1 12a2 2 0 0 0 2 2h8a2 2 0 0 0 2 -2l1 -12"/>
                                    <path d="M9 7v-3a1 1 0 0 1 1 -1h4a1 1 0 0 1 1 1v3"/>
                                </svg>
                            </button>
                        </div>
                    </td>
                </tr>
            `;

            tableBody.insertAdjacentHTML('beforeend', row);
        }

        function updatePositionInTable(position) {
            const row = document.querySelector(`tr[data-position-id="${position.id}"]`);
            if (row) {
                row.remove();
                addPositionToTable(position);
            }
        }

        function getPriorityBadge(priority) {
            const badges = {
                'critico': '<span class="badge bg-red">Crítico</span>',
                'alto': '<span class="badge bg-orange">Alto</span>',
                'medio': '<span class="badge bg-yellow">Medio</span>',
                'bajo': '<span class="badge bg-blue">Bajo</span>'
            };
            return badges[priority] || badges['medio'];
        }

        function getStatusBadge(status) {
            const badges = {
                'activo': '<span class="badge bg-green">Activo</span>',
                'inactivo': '<span class="badge bg-secondary">Inactivo</span>'
            };
            return badges[status] || badges['activo'];
        }

        // Email Configuration Functions
        window.testEmailConnection = function() {
            try {
                console.log('Testing email connection...');

                // Get email configuration
                const emailConfig = {
                    provider: document.querySelector('#email-provider')?.value || 'custom',
                    host: document.querySelector('#smtp-host')?.value || '',
                    port: document.querySelector('#smtp-port')?.value || '587',
                    username: document.querySelector('#smtp-username')?.value || '',
                    password: document.querySelector('#smtp-password')?.value || '',
                    security: document.querySelector('#smtp-security')?.value || 'tls',
                    fromEmail: document.querySelector('#from-email')?.value || ''
                };

                // Validate required fields
                if (!emailConfig.host || !emailConfig.username || !emailConfig.fromEmail) {
                    alert('⚠️ Por favor completa los campos obligatorios: Servidor SMTP, Usuario y Email remitente');
                    return;
                }

                // Show testing state
                const button = event.target;
                const originalText = button.innerHTML;
                button.innerHTML = '<span class="spinner-border spinner-border-sm me-2"></span>Probando...';
                button.disabled = true;

                // Simulate test (in production, this would call a Netlify Function)
                setTimeout(() => {
                    // Reset button
                    button.innerHTML = originalText;
                    button.disabled = false;

                    // Show result
                    alert('✅ Configuración de email válida. En producción, se enviaría un email de prueba.');
                    console.log('Email test config:', emailConfig);
                }, 2000);

            } catch (error) {
                console.error('Error testing email connection:', error);
                alert('❌ Error al probar la conexión de email: ' + error.message);
            }
        };

        window.updateEmailPreview = function(templateType) {
            try {
                const companyName = document.querySelector('input[placeholder="Mi Empresa S.A."]')?.value || 'Sistema Psicométrico';
                const supportEmail = document.querySelector('input[placeholder="admin@empresa.com"]')?.value || 'admin@empresa.com';

                // Sample data for preview
                const sampleData = {
                    candidateName: 'Juan Pérez',
                    candidateEmail: 'juan.perez@email.com',
                    jobPosition: 'Soldador',
                    testLink: 'https://evaluacion.empresa.com/test/abc123',
                    resultsLink: 'https://evaluacion.empresa.com/admin/resultado-detalle.html?id=123',
                    companyName: companyName,
                    supportEmail: supportEmail,
                    tokenExpiration: '48',
                    expirationDate: new Date(Date.now() + 48*60*60*1000).toLocaleDateString('es-ES'),
                    timeRemaining: '24 horas',
                    totalScore: '78',
                    recommendation: 'Recomendado para segunda entrevista',
                    completionDate: new Date().toLocaleDateString('es-ES'),
                    redFlags: 'Ninguna alerta detectada'
                };

                if (templateType === 'invitation') {
                    const subject = document.querySelector('#invitation-subject')?.value || '';
                    const content = document.querySelector('#invitation-template')?.value || '';

                    // Replace variables in subject and content
                    const processedSubject = replaceTemplateVariables(subject, sampleData);
                    const processedContent = replaceTemplateVariables(content, sampleData);

                    document.querySelector('#preview-invitation-subject').textContent = processedSubject;
                    document.querySelector('#preview-invitation-content').innerHTML = processedContent.replace(/\n/g, '<br>');

                } else if (templateType === 'reminder') {
                    const subject = document.querySelector('#reminder-subject')?.value || '';
                    const content = document.querySelector('#reminder-template')?.value || '';

                    const processedSubject = replaceTemplateVariables(subject, sampleData);
                    const processedContent = replaceTemplateVariables(content, sampleData);

                    document.querySelector('#preview-reminder-subject').textContent = processedSubject;
                    document.querySelector('#preview-reminder-content').innerHTML = processedContent.replace(/\n/g, '<br>');

                } else if (templateType === 'results') {
                    const subject = document.querySelector('#results-subject')?.value || '';
                    const content = document.querySelector('#results-template')?.value || '';

                    const processedSubject = replaceTemplateVariables(subject, sampleData);
                    const processedContent = replaceTemplateVariables(content, sampleData);

                    document.querySelector('#preview-results-subject').textContent = processedSubject;
                    document.querySelector('#preview-results-content').innerHTML = processedContent.replace(/\n/g, '<br>');
                }

                console.log(`Updated ${templateType} preview`);

            } catch (error) {
                console.error('Error updating email preview:', error);
                alert('❌ Error al actualizar la vista previa: ' + error.message);
            }
        };

        function replaceTemplateVariables(template, data) {
            if (!template) return '';

            let result = template;

            // Replace all template variables
            Object.keys(data).forEach(key => {
                const regex = new RegExp(`{{${key}}}`, 'g');
                result = result.replace(regex, data[key] || '');
            });

            // Handle conditional blocks (basic implementation)
            result = result.replace(/{{#redFlags}}[\s\S]*?{{\/redFlags}}/g, data.redFlags ? data.redFlags : '');

            return result;
        }

        // Auto-update previews when templates change
        document.addEventListener('DOMContentLoaded', function() {
            // Update previews initially
            setTimeout(() => {
                updateEmailPreview('invitation');
                updateEmailPreview('reminder');
                updateEmailPreview('results');
            }, 500);

            // Setup auto-update on template changes
            const templateInputs = [
                '#invitation-subject', '#invitation-template',
                '#reminder-subject', '#reminder-template',
                '#results-subject', '#results-template'
            ];

            templateInputs.forEach(selector => {
                const element = document.querySelector(selector);
                if (element) {
                    element.addEventListener('input', function() {
                        const templateType = selector.includes('invitation') ? 'invitation' :
                                           selector.includes('reminder') ? 'reminder' : 'results';
                        updateEmailPreview(templateType);
                    });
                }
            });

            // Setup email provider presets
            const emailProvider = document.querySelector('#email-provider');
            if (emailProvider) {
                emailProvider.addEventListener('change', function() {
                    setEmailProviderPresets(this.value);
                });
            }
        });

        function setEmailProviderPresets(provider) {
            const presets = {
                gmail: {
                    host: 'smtp.gmail.com',
                    port: '587',
                    security: 'tls'
                },
                outlook: {
                    host: 'smtp.office365.com',
                    port: '587',
                    security: 'tls'
                },
                sendgrid: {
                    host: 'smtp.sendgrid.net',
                    port: '587',
                    security: 'tls'
                },
                mailgun: {
                    host: 'smtp.mailgun.org',
                    port: '587',
                    security: 'tls'
                }
            };

            if (presets[provider]) {
                document.querySelector('#smtp-host').value = presets[provider].host;
                document.querySelector('#smtp-port').value = presets[provider].port;
                document.querySelector('#smtp-security').value = presets[provider].security;
            }
        }

        // Security Settings Functions
        window.exportarConfiguracionSeguridad = function() {
            try {
                console.log('Exportando configuración de seguridad...');

                const securityConfig = {
                    passwordPolicy: {
                        minLength: document.querySelector('#minPasswordLength')?.value || 8,
                        expiry: document.querySelector('#passwordExpiry')?.value || 90,
                        requireUppercase: document.querySelector('#requireUppercase')?.checked || false,
                        requireLowercase: document.querySelector('#requireLowercase')?.checked || false,
                        requireNumbers: document.querySelector('#requireNumbers')?.checked || false,
                        requireSpecialChars: document.querySelector('#requireSpecialChars')?.checked || false
                    },
                    authentication: {
                        enableTwoFactor: document.querySelector('#enableTwoFactor')?.checked || false,
                        sessionTimeout: document.querySelector('#sessionTimeout')?.value || 30,
                        maxLoginAttempts: document.querySelector('#maxLoginAttempts')?.value || 5
                    },
                    accessControl: {
                        ipWhitelist: document.querySelector('#ipWhitelist')?.value.split('\n').filter(ip => ip.trim()) || [],
                        ipBlacklist: document.querySelector('#ipBlacklist')?.value.split('\n').filter(ip => ip.trim()) || [],
                        enableIpRestriction: document.querySelector('#enableIpRestriction')?.checked || false
                    },
                    dataProtection: {
                        dataRetentionDays: document.querySelector('#dataRetentionDays')?.value || 365,
                        backupFrequency: document.querySelector('#backupFrequency')?.value || 'daily',
                        backupRetention: document.querySelector('#backupRetention')?.value || 30,
                        enableAuditLog: document.querySelector('#enableAuditLog')?.checked || false,
                        enableGdprCompliance: document.querySelector('#enableGdprCompliance')?.checked || false
                    },
                    timestamp: new Date().toISOString()
                };

                // Create and download file
                const blob = new Blob([JSON.stringify(securityConfig, null, 2)], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `security_config_${new Date().toISOString().split('T')[0]}.json`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);

                alert('✅ Configuración de seguridad exportada exitosamente');

            } catch (error) {
                console.error('Error exporting security configuration:', error);
                alert('❌ Error al exportar configuración de seguridad: ' + error.message);
            }
        };

        // Advanced Settings Functions
        window.agregarWebhook = function() {
            const webhooksList = document.getElementById('webhooksList');
            const newWebhookHtml = `
                <div class="webhook-item mb-2 p-2 border rounded">
                    <div class="row align-items-center">
                        <div class="col-md-4">
                            <input type="text" class="form-control form-control-sm" placeholder="Nombre del webhook" value="">
                        </div>
                        <div class="col-md-6">
                            <input type="url" class="form-control form-control-sm" placeholder="https://mi-sistema.com/webhook" value="">
                        </div>
                        <div class="col-md-2">
                            <button type="button" class="btn btn-sm btn-outline-danger" onclick="eliminarWebhook(this)">
                                <svg xmlns="http://www.w3.org/2000/svg" class="icon" width="16" height="16" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none">
                                    <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                                    <path d="M4 7l16 0"/>
                                    <path d="M10 11l0 6"/>
                                    <path d="M14 11l0 6"/>
                                    <path d="M5 7l1 12a2 2 0 0 0 2 2h8a2 2 0 0 0 2 -2l1 -12"/>
                                    <path d="M9 7v-3a1 1 0 0 1 1 -1h4a1 1 0 0 1 1 1v3"/>
                                </svg>
                            </button>
                        </div>
                    </div>
                </div>
            `;

            webhooksList.insertAdjacentHTML('beforeend', newWebhookHtml);
        };

        window.eliminarWebhook = function(button) {
            if (confirm('¿Está seguro de que desea eliminar este webhook?')) {
                button.closest('.webhook-item').remove();
            }
        };

        window.exportarDatosCompletos = function() {
            try {
                console.log('Exportando datos completos del sistema...');

                const format = document.querySelector('#exportFormat')?.value || 'json';
                const includeSystemData = document.querySelector('#includeSystemData')?.checked || false;

                // Collect all system data
                const completeData = {
                    // Configuration data
                    configuration: JSON.parse(localStorage.getItem('psicometric_config') || '{}'),
                    jobPositions: JSON.parse(localStorage.getItem('job_positions') || '[]'),

                    // System metadata (if enabled)
                    ...(includeSystemData && {
                        systemInfo: {
                            version: '3.6',
                            exportDate: new Date().toISOString(),
                            browser: navigator.userAgent,
                            platform: navigator.platform
                        }
                    }),

                    // Advanced settings
                    advancedSettings: {
                        database: {
                            maintenanceTime: document.querySelector('#maintenanceTime')?.value || '02:00',
                            queryLimit: document.querySelector('#queryLimit')?.value || 1000,
                            cacheTime: document.querySelector('#cacheTime')?.value || 15,
                            enableAutoVacuum: document.querySelector('#enableAutoVacuum')?.checked || false,
                            enableCompression: document.querySelector('#enableCompression')?.checked || false
                        },
                        api: {
                            rateLimit: document.querySelector('#apiRateLimit')?.value || 60,
                            timeout: document.querySelector('#apiTimeout')?.value || 30,
                            corsOrigins: document.querySelector('#corsOrigins')?.value.split('\n').filter(origin => origin.trim()) || [],
                            enableLogging: document.querySelector('#enableApiLogging')?.checked || false,
                            enableCache: document.querySelector('#enableApiCache')?.checked || false
                        },
                        webhooks: {
                            enabled: document.querySelector('#enableWebhooks')?.checked || false,
                            retries: document.querySelector('#webhookRetries')?.value || 3,
                            urls: Array.from(document.querySelectorAll('.webhook-item')).map(item => ({
                                name: item.querySelector('input[type="text"]')?.value || '',
                                url: item.querySelector('input[type="url"]')?.value || ''
                            })).filter(webhook => webhook.url.trim())
                        },
                        debug: {
                            logLevel: document.querySelector('#logLevel')?.value || 'info',
                            logRetentionDays: document.querySelector('#logRetentionDays')?.value || 30,
                            monitoringEmail: document.querySelector('#monitoringEmail')?.value || '',
                            enableDebugMode: document.querySelector('#enableDebugMode')?.checked || false,
                            enablePerformanceMonitoring: document.querySelector('#enablePerformanceMonitoring')?.checked || false
                        },
                        customCode: {
                            css: document.querySelector('#customCSS')?.value || '',
                            js: document.querySelector('#customJS')?.value || '',
                            enabled: document.querySelector('#enableCustomCode')?.checked || false
                        }
                    }
                };

                let filename, content, mimeType;

                switch (format) {
                    case 'json':
                        content = JSON.stringify(completeData, null, 2);
                        filename = `psicometric_complete_export_${new Date().toISOString().split('T')[0]}.json`;
                        mimeType = 'application/json';
                        break;
                    case 'csv':
                        // Simplified CSV export for main data
                        content = convertToCSV(completeData);
                        filename = `psicometric_export_${new Date().toISOString().split('T')[0]}.csv`;
                        mimeType = 'text/csv';
                        break;
                    default:
                        throw new Error('Formato de exportación no soportado: ' + format);
                }

                // Create and download file
                const blob = new Blob([content], { type: mimeType });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = filename;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);

                alert('✅ Datos exportados exitosamente como ' + format.toUpperCase());

            } catch (error) {
                console.error('Error exporting complete data:', error);
                alert('❌ Error al exportar datos: ' + error.message);
            }
        };

        window.importarDatosCompletos = function() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json,.csv';

            input.onchange = function(event) {
                const file = event.target.files[0];
                if (!file) return;

                const reader = new FileReader();
                reader.onload = function(e) {
                    try {
                        const data = JSON.parse(e.target.result);

                        if (confirm('¿Está seguro de que desea importar estos datos? Esto sobrescribirá la configuración actual.')) {
                            // Import configuration
                            if (data.configuration) {
                                localStorage.setItem('psicometric_config', JSON.stringify(data.configuration));
                            }

                            // Import job positions
                            if (data.jobPositions) {
                                localStorage.setItem('job_positions', JSON.stringify(data.jobPositions));
                            }

                            alert('✅ Datos importados exitosamente. Recarga la página para ver los cambios.');
                        }
                    } catch (error) {
                        alert('❌ Error al importar datos: ' + error.message);
                    }
                };
                reader.readAsText(file);
            };

            input.click();
        };

        window.resetearSistema = function() {
            if (confirm('⚠️ ADVERTENCIA: Esta acción limpiará todas las configuraciones del sistema.\n\n¿Está seguro de que desea continuar?')) {
                if (confirm('🚨 CONFIRMACIÓN FINAL: Esta acción es irreversible. ¿Continuar con el reseteo?')) {
                    try {
                        // Clear all stored data
                        localStorage.removeItem('psicometric_config');
                        localStorage.removeItem('job_positions');

                        // Clear other possible stored data
                        Object.keys(localStorage).forEach(key => {
                            if (key.startsWith('psicometric_') || key.startsWith('job_')) {
                                localStorage.removeItem(key);
                            }
                        });

                        alert('✅ Sistema reseteado exitosamente. Recarga la página para ver los cambios.');

                        // Optional: reload the page
                        setTimeout(() => {
                            window.location.reload();
                        }, 2000);

                    } catch (error) {
                        alert('❌ Error al resetear el sistema: ' + error.message);
                    }
                }
            }
        };

        window.confirmarReseteoCompleto = function() {
            if (confirm('🚨 PELIGRO: Esta acción eliminará TODOS los datos del sistema incluyendo candidatos y resultados.\n\nEsta acción es IRREVERSIBLE.\n\n¿Está seguro?')) {
                if (confirm('⚠️ CONFIRMACIÓN FINAL: Se eliminarán todos los datos. ¿Continuar?')) {
                    if (confirm('🔴 ÚLTIMA ADVERTENCIA: ¿Realmente desea eliminar TODO?')) {
                        try {
                            // Clear all localStorage
                            localStorage.clear();

                            alert('✅ Todos los datos han sido eliminados. El sistema se reiniciará.');

                            // Reload to reset everything
                            setTimeout(() => {
                                window.location.reload();
                            }, 1000);

                        } catch (error) {
                            alert('❌ Error al eliminar datos: ' + error.message);
                        }
                    }
                }
            }
        };

        window.restaurarConfiguracionDefecto = function() {
            if (confirm('¿Está seguro de que desea restaurar la configuración por defecto?\n\nEsto sobrescribirá todas las configuraciones actuales.')) {
                try {
                    // Remove current configuration
                    localStorage.removeItem('psicometric_config');

                    // Reset job positions to defaults
                    const defaultPositions = [
                        {
                            id: 'soldador',
                            nombre: 'Soldador',
                            descripcion: 'Soldadura en letreros luminosos',
                            prioridad: 'critico',
                            estado: 'activo',
                            disc: { d_min: 2, d_max: 3, i_min: 4, i_max: 5, s_min: 7, s_max: 9, c_min: 7, c_max: 8 }
                        },
                        {
                            id: 'electricista',
                            nombre: 'Electricista',
                            descripcion: 'Instalaciones eléctricas',
                            prioridad: 'critico',
                            estado: 'activo',
                            disc: { d_min: 3, d_max: 4, i_min: 3, i_max: 4, s_min: 6, s_max: 8, c_min: 8, c_max: 9 }
                        }
                    ];

                    localStorage.setItem('job_positions', JSON.stringify(defaultPositions));

                    alert('✅ Configuración restaurada a valores por defecto. Recarga la página para ver los cambios.');

                } catch (error) {
                    alert('❌ Error al restaurar configuración: ' + error.message);
                }
            }
        };

        // Helper function for CSV conversion
        function convertToCSV(data) {
            // Simple CSV conversion for main configuration data
            let csv = 'Section,Key,Value\n';

            function addToCSV(obj, prefix = '') {
                Object.keys(obj).forEach(key => {
                    const value = obj[key];
                    const fullKey = prefix ? `${prefix}.${key}` : key;

                    if (typeof value === 'object' && value !== null && !Array.isArray(value)) {
                        addToCSV(value, fullKey);
                    } else {
                        csv += `"${fullKey}","${key}","${Array.isArray(value) ? value.join(';') : value}"\n`;
                    }
                });
            }

            addToCSV(data);
            return csv;
        }

        // Initialize tooltips for the new elements
        // Reports Configuration Functions
        function toggleCustomNaming() {
            const select = document.getElementById('file-naming');
            const customDiv = document.getElementById('custom-naming-pattern');

            if (select.value === 'custom') {
                customDiv.style.display = 'block';
            } else {
                customDiv.style.display = 'none';
            }
        }

        function previewReportConfiguration() {
            // Update enabled reports preview
            const enabledReports = [];
            if (document.getElementById('report-individual').checked) enabledReports.push('Individual');
            if (document.getElementById('report-bulk').checked) enabledReports.push('Masivo');
            if (document.getElementById('report-disc').checked) enabledReports.push('DISC');
            if (document.getElementById('report-hiring').checked) enabledReports.push('Contratación');

            const reportsPreview = document.getElementById('enabled-reports-preview');
            reportsPreview.innerHTML = '';
            enabledReports.forEach(report => {
                const badge = document.createElement('span');
                badge.className = 'badge bg-success-lt me-1';
                badge.textContent = report;
                reportsPreview.appendChild(badge);
            });

            // Update formats preview
            const enabledFormats = [];
            if (document.getElementById('format-pdf').checked) enabledFormats.push('PDF');
            if (document.getElementById('format-excel').checked) enabledFormats.push('Excel');
            if (document.getElementById('format-csv').checked) enabledFormats.push('CSV');
            if (document.getElementById('format-json').checked) enabledFormats.push('JSON');

            const formatsPreview = document.getElementById('formats-preview');
            formatsPreview.innerHTML = '';
            enabledFormats.forEach(format => {
                const badge = document.createElement('span');
                badge.className = 'badge bg-primary-lt me-1';
                badge.textContent = format;
                formatsPreview.appendChild(badge);
            });

            // Update template preview
            const template = document.getElementById('default-template').value;
            const templateText = document.getElementById('default-template').selectedOptions[0].text;
            const templatePreview = document.getElementById('template-preview');
            templatePreview.innerHTML = `<span class="badge bg-info-lt">${templateText}</span>`;

            // Update automation preview
            const scheduledEnabled = document.getElementById('enable-scheduled-reports').checked;
            const emailEnabled = document.getElementById('enable-email-delivery').checked;
            const automationPreview = document.getElementById('automation-preview');

            if (scheduledEnabled || emailEnabled) {
                const features = [];
                if (scheduledEnabled) features.push('Programado');
                if (emailEnabled) features.push('Email');
                automationPreview.innerHTML = `<span class="badge bg-success-lt">${features.join(', ')}</span>`;
            } else {
                automationPreview.innerHTML = `<span class="badge bg-warning-lt">Deshabilitado</span>`;
            }
        }

        function testReportGeneration() {
            // Show loading state
            const button = event.target;
            const originalText = button.innerHTML;
            button.innerHTML = '<div class="spinner-border spinner-border-sm me-2" role="status"></div>Generando...';
            button.disabled = true;

            // Simulate report generation
            setTimeout(() => {
                // Reset button
                button.innerHTML = originalText;
                button.disabled = false;

                // Show success message
                const alertDiv = document.createElement('div');
                alertDiv.className = 'alert alert-success alert-dismissible fade show mt-3';
                alertDiv.innerHTML = `
                    <strong>¡Prueba exitosa!</strong> La configuración de reportes funciona correctamente.
                    <div class="mt-2">
                        <small>
                            • Reportes habilitados: ${document.querySelectorAll('input[id^="report-"]:checked').length}<br>
                            • Formatos disponibles: ${document.querySelectorAll('input[id^="format-"]:checked').length}<br>
                            • Automatización: ${document.getElementById('enable-scheduled-reports').checked ? 'Habilitada' : 'Deshabilitada'}
                        </small>
                    </div>
                    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                `;

                // Insert after the buttons
                button.parentNode.parentNode.appendChild(alertDiv);

                // Auto-remove alert after 5 seconds
                setTimeout(() => {
                    if (alertDiv.parentNode) {
                        alertDiv.remove();
                    }
                }, 5000);
            }, 2000);
        }

        function validateReportsConfiguration() {
            const errors = [];

            // Check if at least one report type is enabled
            const reportTypes = ['report-individual', 'report-bulk', 'report-disc', 'report-hiring'];
            const enabledReports = reportTypes.filter(id => document.getElementById(id).checked);

            if (enabledReports.length === 0) {
                errors.push('Debe habilitar al menos un tipo de reporte');
            }

            // Check if at least one format is enabled
            const formats = ['format-pdf', 'format-excel', 'format-csv', 'format-json'];
            const enabledFormats = formats.filter(id => document.getElementById(id).checked);

            if (enabledFormats.length === 0) {
                errors.push('Debe habilitar al menos un formato de exportación');
            }

            // Validate custom naming pattern if selected
            const fileNaming = document.getElementById('file-naming').value;
            if (fileNaming === 'custom') {
                const customPattern = document.getElementById('custom-pattern').value.trim();
                if (!customPattern) {
                    errors.push('Debe especificar un patrón personalizado para los nombres de archivo');
                }
            }

            // Validate performance settings
            const maxCandidates = parseInt(document.getElementById('max-candidates').value);
            if (maxCandidates < 10 || maxCandidates > 10000) {
                errors.push('El máximo de candidatos debe estar entre 10 y 10,000');
            }

            const timeout = parseInt(document.getElementById('generation-timeout').value);
            if (timeout < 30 || timeout > 1800) {
                errors.push('El timeout debe estar entre 30 y 1,800 segundos');
            }

            // Validate email settings if automation is enabled
            const emailDelivery = document.getElementById('enable-email-delivery').checked;
            if (emailDelivery) {
                const emails = document.getElementById('auto-delivery-emails').value.trim();
                if (!emails) {
                    errors.push('Debe especificar al menos un email para la entrega automática');
                } else {
                    // Basic email validation
                    const emailList = emails.split(',').map(e => e.trim());
                    const emailPattern = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                    const invalidEmails = emailList.filter(email => !emailPattern.test(email));

                    if (invalidEmails.length > 0) {
                        errors.push(`Emails inválidos: ${invalidEmails.join(', ')}`);
                    }
                }
            }

            return errors;
        }

        function saveReportsConfiguration() {
            const errors = validateReportsConfiguration();

            if (errors.length > 0) {
                // Show validation errors
                const alertDiv = document.createElement('div');
                alertDiv.className = 'alert alert-danger alert-dismissible fade show';
                alertDiv.innerHTML = `
                    <strong>Errores de validación:</strong>
                    <ul class="mb-0">
                        ${errors.map(error => `<li>${error}</li>`).join('')}
                    </ul>
                    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                `;

                // Insert at the top of the reports tab
                const reportsTab = document.getElementById('reports');
                reportsTab.insertBefore(alertDiv, reportsTab.firstChild);

                // Auto-remove after 8 seconds
                setTimeout(() => {
                    if (alertDiv.parentNode) {
                        alertDiv.remove();
                    }
                }, 8000);

                return false;
            }

            // Collect all configuration data
            const reportsConfig = {
                availableReports: {
                    individual: {
                        enabled: document.getElementById('report-individual').checked,
                        fields: {
                            scores: document.getElementById('individual-scores').checked,
                            disc: document.getElementById('individual-disc').checked,
                            recommendations: document.getElementById('individual-recommendations').checked,
                            redFlags: document.getElementById('individual-red-flags').checked,
                            responses: document.getElementById('individual-responses').checked,
                            charts: document.getElementById('individual-charts').checked
                        }
                    },
                    bulk: {
                        enabled: document.getElementById('report-bulk').checked,
                        fields: {
                            summary: document.getElementById('bulk-summary').checked,
                            statistics: document.getElementById('bulk-statistics').checked,
                            comparisons: document.getElementById('bulk-comparisons').checked,
                            trends: document.getElementById('bulk-trends').checked,
                            rankings: document.getElementById('bulk-rankings').checked,
                            filters: document.getElementById('bulk-filters').checked
                        }
                    },
                    disc: {
                        enabled: document.getElementById('report-disc').checked,
                        fields: {
                            profiles: document.getElementById('disc-profiles').checked,
                            charts: document.getElementById('disc-charts').checked,
                            compatibilities: document.getElementById('disc-compatibilities').checked,
                            interpretations: document.getElementById('disc-interpretations').checked,
                            recommendations: document.getElementById('disc-recommendations').checked,
                            development: document.getElementById('disc-development').checked
                        }
                    },
                    hiring: {
                        enabled: document.getElementById('report-hiring').checked,
                        fields: {
                            decisions: document.getElementById('hiring-decisions').checked,
                            risks: document.getElementById('hiring-risks').checked,
                            strengths: document.getElementById('hiring-strengths').checked,
                            areas: document.getElementById('hiring-areas').checked,
                            fit: document.getElementById('hiring-fit').checked,
                            scores: document.getElementById('hiring-scores').checked
                        }
                    }
                },
                customization: {
                    defaultTemplate: document.getElementById('default-template').value,
                    language: document.getElementById('report-language').value,
                    charts: {
                        bar: document.getElementById('chart-bar').checked,
                        pie: document.getElementById('chart-pie').checked,
                        line: document.getElementById('chart-line').checked,
                        radar: document.getElementById('chart-radar').checked
                    },
                    branding: {
                        companyBranding: document.getElementById('include-company-branding').checked,
                        watermark: document.getElementById('include-watermark').checked
                    }
                },
                export: {
                    defaultFormat: document.getElementById('default-export-format').value,
                    pdfQuality: document.getElementById('pdf-quality').value,
                    fileNaming: document.getElementById('file-naming').value,
                    customPattern: document.getElementById('custom-pattern').value,
                    availableFormats: {
                        pdf: document.getElementById('format-pdf').checked,
                        excel: document.getElementById('format-excel').checked,
                        csv: document.getElementById('format-csv').checked,
                        json: document.getElementById('format-json').checked
                    }
                },
                privacy: {
                    permissions: {
                        individual: {
                            admin: document.getElementById('individual-admin').checked,
                            manager: document.getElementById('individual-manager').checked,
                            analyst: document.getElementById('individual-analyst').checked,
                            readonly: document.getElementById('individual-readonly').checked
                        },
                        bulk: {
                            admin: document.getElementById('bulk-admin').checked,
                            manager: document.getElementById('bulk-manager').checked,
                            analyst: document.getElementById('bulk-analyst').checked,
                            readonly: document.getElementById('bulk-readonly').checked
                        },
                        disc: {
                            admin: document.getElementById('disc-admin').checked,
                            manager: document.getElementById('disc-manager').checked,
                            analyst: document.getElementById('disc-analyst').checked,
                            readonly: document.getElementById('disc-readonly').checked
                        },
                        hiring: {
                            admin: document.getElementById('hiring-admin').checked,
                            manager: document.getElementById('hiring-manager').checked,
                            analyst: document.getElementById('hiring-analyst').checked,
                            readonly: document.getElementById('hiring-readonly').checked
                        }
                    },
                    options: {
                        anonymizeData: document.getElementById('anonymize-data').checked,
                        maskPersonalInfo: document.getElementById('mask-personal-info').checked,
                        gdprCompliance: document.getElementById('gdpr-compliance').checked
                    },
                    retention: {
                        period: document.getElementById('retention-period').value,
                        autoDelete: document.getElementById('auto-delete').checked
                    }
                },
                automation: {
                    scheduledReports: document.getElementById('enable-scheduled-reports').checked,
                    emailDelivery: document.getElementById('enable-email-delivery').checked,
                    defaultFrequency: document.getElementById('default-frequency').value,
                    weeklyDay: document.getElementById('weekly-day').value,
                    deliveryTime: document.getElementById('delivery-time').value,
                    autoDeliveryEmails: document.getElementById('auto-delivery-emails').value
                },
                performance: {
                    maxCandidates: parseInt(document.getElementById('max-candidates').value),
                    generationTimeout: parseInt(document.getElementById('generation-timeout').value),
                    dataRefresh: document.getElementById('data-refresh').value,
                    enableCaching: document.getElementById('enable-caching').checked,
                    compressFiles: document.getElementById('compress-files').checked
                }
            };

            // Save to existing configuration structure (using same key as main config)
            const existingConfig = JSON.parse(localStorage.getItem('psicometric_config') || '{}');
            existingConfig.reports = reportsConfig;
            localStorage.setItem('psicometric_config', JSON.stringify(existingConfig));

            return true;
        }

        function loadReportsConfiguration() {
            const config = JSON.parse(localStorage.getItem('psicometric_config') || '{}');
            const reportsConfig = config.reports;

            if (!reportsConfig) return;

            // Load available reports configuration
            if (reportsConfig.availableReports) {
                const reports = reportsConfig.availableReports;

                // Individual report
                if (reports.individual) {
                    document.getElementById('report-individual').checked = reports.individual.enabled || false;
                    if (reports.individual.fields) {
                        Object.keys(reports.individual.fields).forEach(field => {
                            const element = document.getElementById(`individual-${field}`);
                            if (element) element.checked = reports.individual.fields[field] || false;
                        });
                    }
                }

                // Bulk report
                if (reports.bulk) {
                    document.getElementById('report-bulk').checked = reports.bulk.enabled || false;
                    if (reports.bulk.fields) {
                        Object.keys(reports.bulk.fields).forEach(field => {
                            const element = document.getElementById(`bulk-${field}`);
                            if (element) element.checked = reports.bulk.fields[field] || false;
                        });
                    }
                }

                // DISC report
                if (reports.disc) {
                    document.getElementById('report-disc').checked = reports.disc.enabled || false;
                    if (reports.disc.fields) {
                        Object.keys(reports.disc.fields).forEach(field => {
                            const element = document.getElementById(`disc-${field}`);
                            if (element) element.checked = reports.disc.fields[field] || false;
                        });
                    }
                }

                // Hiring report
                if (reports.hiring) {
                    document.getElementById('report-hiring').checked = reports.hiring.enabled || false;
                    if (reports.hiring.fields) {
                        Object.keys(reports.hiring.fields).forEach(field => {
                            const element = document.getElementById(`hiring-${field}`);
                            if (element) element.checked = reports.hiring.fields[field] || false;
                        });
                    }
                }
            }

            // Load customization settings
            if (reportsConfig.customization) {
                const custom = reportsConfig.customization;
                if (custom.defaultTemplate) document.getElementById('default-template').value = custom.defaultTemplate;
                if (custom.language) document.getElementById('report-language').value = custom.language;

                if (custom.charts) {
                    Object.keys(custom.charts).forEach(chart => {
                        const element = document.getElementById(`chart-${chart}`);
                        if (element) element.checked = custom.charts[chart] || false;
                    });
                }

                if (custom.branding) {
                    if (custom.branding.companyBranding !== undefined) {
                        document.getElementById('include-company-branding').checked = custom.branding.companyBranding;
                    }
                    if (custom.branding.watermark !== undefined) {
                        document.getElementById('include-watermark').checked = custom.branding.watermark;
                    }
                }
            }

            // Load export settings
            if (reportsConfig.export) {
                const exp = reportsConfig.export;
                if (exp.defaultFormat) document.getElementById('default-export-format').value = exp.defaultFormat;
                if (exp.pdfQuality) document.getElementById('pdf-quality').value = exp.pdfQuality;
                if (exp.fileNaming) {
                    document.getElementById('file-naming').value = exp.fileNaming;
                    toggleCustomNaming(); // Show/hide custom pattern field
                }
                if (exp.customPattern) document.getElementById('custom-pattern').value = exp.customPattern;

                if (exp.availableFormats) {
                    Object.keys(exp.availableFormats).forEach(format => {
                        const element = document.getElementById(`format-${format}`);
                        if (element) element.checked = exp.availableFormats[format] || false;
                    });
                }
            }

            // Load privacy settings
            if (reportsConfig.privacy) {
                const privacy = reportsConfig.privacy;

                if (privacy.permissions) {
                    Object.keys(privacy.permissions).forEach(reportType => {
                        Object.keys(privacy.permissions[reportType]).forEach(role => {
                            const element = document.getElementById(`${reportType}-${role}`);
                            if (element) element.checked = privacy.permissions[reportType][role] || false;
                        });
                    });
                }

                if (privacy.options) {
                    Object.keys(privacy.options).forEach(option => {
                        const element = document.getElementById(option.replace(/([A-Z])/g, '-$1').toLowerCase());
                        if (element) element.checked = privacy.options[option] || false;
                    });
                }

                if (privacy.retention) {
                    if (privacy.retention.period) document.getElementById('retention-period').value = privacy.retention.period;
                    if (privacy.retention.autoDelete !== undefined) {
                        document.getElementById('auto-delete').checked = privacy.retention.autoDelete;
                    }
                }
            }

            // Load automation settings
            if (reportsConfig.automation) {
                const automation = reportsConfig.automation;
                if (automation.scheduledReports !== undefined) {
                    document.getElementById('enable-scheduled-reports').checked = automation.scheduledReports;
                }
                if (automation.emailDelivery !== undefined) {
                    document.getElementById('enable-email-delivery').checked = automation.emailDelivery;
                }
                if (automation.defaultFrequency) document.getElementById('default-frequency').value = automation.defaultFrequency;
                if (automation.weeklyDay) document.getElementById('weekly-day').value = automation.weeklyDay;
                if (automation.deliveryTime) document.getElementById('delivery-time').value = automation.deliveryTime;
                if (automation.autoDeliveryEmails) document.getElementById('auto-delivery-emails').value = automation.autoDeliveryEmails;
            }

            // Load performance settings
            if (reportsConfig.performance) {
                const perf = reportsConfig.performance;
                if (perf.maxCandidates) document.getElementById('max-candidates').value = perf.maxCandidates;
                if (perf.generationTimeout) document.getElementById('generation-timeout').value = perf.generationTimeout;
                if (perf.dataRefresh) document.getElementById('data-refresh').value = perf.dataRefresh;
                if (perf.enableCaching !== undefined) {
                    document.getElementById('enable-caching').checked = perf.enableCaching;
                }
                if (perf.compressFiles !== undefined) {
                    document.getElementById('compress-files').checked = perf.compressFiles;
                }
            }
        }

        document.addEventListener('DOMContentLoaded', function() {
            // Initialize Bootstrap tooltips
            const tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
            tooltipTriggerList.map(function (tooltipTriggerEl) {
                return new bootstrap.Tooltip(tooltipTriggerEl);
            });

            // Load reports configuration on page load
            loadReportsConfiguration();
        });
    </script>
  </body>
</html>