<!doctype html>
<!--
* Evaluaci√≥n Psicom√©trica - Sistema de Contrataci√≥n
* Basado en Tabler Framework - Template Wizard
-->
<html lang="es">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>Evaluaci√≥n Psicom√©trica - Anuncios Luminosos</title>
    
    <!-- Tabler CSS -->
    <link href="../admin/dist/css/tabler.css" rel="stylesheet" />
    <link href="../admin/dist/css/theme-custom.css" rel="stylesheet" />
    
    <style>
        @import url('https://rsms.me/inter/inter.css');
        
        /* Variables personalizadas */
        :root {
            --primary-color: #066fd1;
            --success-color: #2fb344;
            --danger-color: #dc3545;
            --warning-color: #ffc107;
        }
        
        /* Auto-save indicator */
        .save-indicator {
            position: fixed;
            top: 20px;
            right: 20px;
            background: var(--success-color);
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 14px;
            display: none;
            z-index: 1000;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        /* Section progress */
        .section-progress {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 8px;
            margin-bottom: 2rem;
        }
        
        .progress-step {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 14px;
            border: 2px solid #e6e6e6;
            background: #f8f9fa;
            color: #6c757d;
            transition: all 0.3s;
        }
        
        .progress-step.active {
            background: var(--primary-color);
            border-color: var(--primary-color);
            color: white;
        }
        
        .progress-step.completed {
            background: var(--success-color);
            border-color: var(--success-color);
            color: white;
        }
        
        .progress-line {
            width: 60px;
            height: 2px;
            background: #e6e6e6;
            transition: background 0.3s;
        }
        
        .progress-line.completed {
            background: var(--success-color);
        }
        
        /* Question styles */
        .question-card {
            margin-bottom: 1.5rem;
            border: 1px solid #dee2e6;
            border-radius: 0.5rem;
            overflow: hidden;
        }
        
        .question-header {
            background: #f8f9fa;
            padding: 1rem;
            border-bottom: 1px solid #dee2e6;
            display: flex;
            justify-content: between;
            align-items: center;
        }
        
        .question-number {
            font-weight: 600;
            color: var(--primary-color);
            margin-right: 0.5rem;
        }
        
        .question-body {
            padding: 1.5rem;
        }
        
        /* CLEAVER specific styles */
        .cleaver-words {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 1.5rem;
        }
        
        .word-card {
            text-align: center;
            padding: 1rem;
            border: 2px solid #e6e6e6;
            border-radius: 0.5rem;
            background: #f8f9fa;
            transition: all 0.3s;
        }
        
        .word-card.selected-mas {
            border-color: var(--primary-color);
            background: rgba(6, 111, 209, 0.1);
        }
        
        .word-card.selected-menos {
            border-color: var(--danger-color);
            background: rgba(220, 53, 69, 0.1);
        }
        
        .word-card.selected-both {
            border-color: var(--warning-color);
            background: rgba(255, 193, 7, 0.1);
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.02); }
        }
        
        .word-letter {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 28px;
            height: 28px;
            background: #6c757d;
            color: white;
            border-radius: 50%;
            font-weight: 600;
            font-size: 14px;
            margin-bottom: 0.5rem;
        }
        
        .word-text {
            font-weight: 500;
            color: #495057;
        }
        
        /* Choice section */
        .choice-section {
            background: #f8f9fa;
            border-radius: 0.5rem;
            padding: 1.5rem;
            margin-top: 1.5rem;
        }
        
        .choice-grid {
            display: grid;
            grid-template-columns: 1fr auto 1fr;
            gap: 2rem;
            align-items: start;
            width: 100%;
            min-height: 120px;
        }
        
        .choice-column {
            text-align: center;
            min-width: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
        }
        
        .choice-column:first-child {
            justify-self: center;
        }
        
        .choice-column:last-child {
            justify-self: center;
        }
        
        .choice-label {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            font-weight: 600;
            font-size: 16px;
            margin-bottom: 1rem;
            padding: 0.5rem 1rem;
            border-radius: 1.5rem;
        }
        
        .choice-label.mas {
            background: linear-gradient(135deg, var(--primary-color), #0056b3);
            color: white;
        }
        
        .choice-label.menos {
            background: linear-gradient(135deg, var(--danger-color), #c82333);
            color: white;
        }
        
        .choice-buttons {
            display: flex;
            gap: 0.5rem;
            justify-content: center;
        }
        
        .choice-btn {
            width: 45px;
            height: 45px;
            border: 2px solid #dee2e6;
            border-radius: 0.375rem;
            background: white;
            color: #6c757d;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .choice-btn:hover {
            border-color: var(--primary-color);
            color: var(--primary-color);
            transform: scale(1.05);
        }
        
        .choice-btn.selected {
            background: var(--primary-color);
            border-color: var(--primary-color);
            color: white;
            transform: scale(1.05);
        }
        
        .choice-column:last-child .choice-btn.selected {
            background: var(--danger-color);
            border-color: var(--danger-color);
        }
        
        .choice-separator {
            width: 2px;
            height: 80px;
            background: linear-gradient(to bottom, #dee2e6, #adb5bd, #dee2e6);
            border-radius: 1px;
        }
        
        /* Navigation buttons */
        .form-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 1rem;
            margin-top: 2rem;
            padding-top: 1.5rem;
            border-top: 1px solid #dee2e6;
        }
        
        /* Desktop styles - default */
        @media (min-width: 769px) {
            .container {
                padding-left: 2rem;
                padding-right: 2rem;
            }
            
            .choice-grid {
                display: grid;
                grid-template-columns: 1fr auto 1fr;
                gap: 3rem;
                align-items: start;
            }
            
            .choice-separator {
                width: 3px;
                height: 100px;
                background: linear-gradient(to bottom, #dee2e6, #adb5bd, #dee2e6);
            }
            
            .cleaver-words {
                grid-template-columns: repeat(4, 1fr);
                gap: 1.5rem;
            }
            
            .choice-btn {
                width: 50px;
                height: 50px;
                font-size: 16px;
            }
            
            .choice-buttons {
                gap: 1rem;
            }
        }
        
        /* Tablet responsive */
        @media (max-width: 768px) and (min-width: 481px) {
            .container {
                padding: 1rem;
            }
            
            .choice-grid {
                display: grid;
                grid-template-columns: 1fr auto 1fr;
                gap: 2rem;
                align-items: start;
            }
            
            .choice-separator {
                width: 2px;
                height: 80px;
            }
            
            .cleaver-words {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .choice-buttons {
                gap: 0.75rem;
            }
            
            .choice-btn {
                width: 45px;
                height: 45px;
            }
        }
        
        /* Mobile responsive */
        @media (max-width: 480px) {
            .container {
                padding: 1rem;
            }
            
            .choice-grid {
                display: flex;
                flex-direction: column;
                gap: 1.5rem;
            }
            
            .choice-separator {
                width: 80px;
                height: 2px;
                align-self: center;
                margin: 0 auto;
            }
            
            .cleaver-words {
                grid-template-columns: 1fr;
            }
            
            .choice-buttons {
                gap: 0.5rem;
            }
            
            .choice-btn {
                width: 45px;
                height: 45px;
            }
            
            .form-footer {
                flex-direction: column;
                gap: 1rem;
            }
            
            .form-footer .btn {
                width: 100%;
            }
            
            .choice-label {
                font-size: 14px;
                padding: 0.375rem 0.75rem;
            }
        }
        
        /* Card styling improvements */
        .card-lg {
            box-shadow: 0 0.5rem 1rem rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(0, 0, 0, 0.05);
        }
        
        /* Hidden sections */
        .section {
            display: none;
        }
        
        .section.active {
            display: block;
        }
    </style>
</head>

<body>
    <!-- Auto-save indicator -->
    <div class="save-indicator" id="saveIndicator">
        ‚úì Guardado autom√°ticamente
    </div>
    
    <!-- Main layout -->
    <div class="page page-center">
        <div class="container py-4" style="max-width: 1200px;">
            
            <!-- Logo/Brand -->
            <div class="text-center mb-4">
                <h1 class="h2 text-primary mb-0">Sistema de Evaluaci√≥n</h1>
                <p class="text-secondary">Anuncios Luminosos</p>
            </div>
            
            <!-- Main card -->
            <div class="card card-lg">
                <div class="card-body">
                    
                    <!-- Progress indicator -->
                    <div class="section-progress">
                        <div class="progress-step active" id="step1">1</div>
                        <div class="progress-line" id="line1"></div>
                        <div class="progress-step" id="step2">2</div>
                        <div class="progress-line" id="line2"></div>
                        <div class="progress-step" id="step3">3</div>
                        <div class="progress-line" id="line3"></div>
                        <div class="progress-step" id="step4">4</div>
                    </div>
                    
                    <!-- Section 1: CLEAVER -->
                    <div class="section active" id="section1">
                        <div class="text-center mb-4">
                            <h3 class="h4 mb-1">Perfil de Comportamiento</h3>
                            <p class="text-secondary">Para cada grupo de palabras, elija la que M√ÅS y MENOS lo describe</p>
                        </div>
                        
                        <!-- CLEAVER Questions will be generated here -->
                        <div id="cleaverQuestions"></div>
                        
                        <div class="form-footer">
                            <div></div>
                            <button type="button" class="btn btn-primary" onclick="nextSection()">
                                Continuar
                                <svg xmlns="http://www.w3.org/2000/svg" class="icon" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
                                    <path stroke="none" d="m0 0h24v24H0z" fill="none"/>
                                    <path d="M5 12l14 0"/>
                                    <path d="M13 18l6 -6"/>
                                    <path d="M13 6l6 6"/>
                                </svg>
                            </button>
                        </div>
                    </div>
                    
                    <!-- Section 2: KOSTICK -->
                    <div class="section" id="section2">
                        <div class="text-center mb-4">
                            <h3 class="h4 mb-1">Preferencias Laborales</h3>
                            <p class="text-secondary">Indique qu√© tan de acuerdo est√° con cada afirmaci√≥n</p>
                        </div>
                        
                        <div id="kostickQuestions"></div>
                        
                        <div class="form-footer">
                            <button type="button" class="btn btn-secondary" onclick="prevSection()">
                                <svg xmlns="http://www.w3.org/2000/svg" class="icon" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
                                    <path stroke="none" d="m0 0h24v24H0z" fill="none"/>
                                    <path d="M5 12l14 0"/>
                                    <path d="M5 18l6 -6"/>
                                    <path d="M5 6l6 6"/>
                                </svg>
                                Anterior
                            </button>
                            <button type="button" class="btn btn-primary" onclick="nextSection()">
                                Continuar
                                <svg xmlns="http://www.w3.org/2000/svg" class="icon" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
                                    <path stroke="none" d="m0 0h24v24H0z" fill="none"/>
                                    <path d="M5 12l14 0"/>
                                    <path d="M13 18l6 -6"/>
                                    <path d="M13 6l6 6"/>
                                </svg>
                            </button>
                        </div>
                    </div>
                    
                    <!-- Section 3: Situaciones -->
                    <div class="section" id="section3">
                        <div class="text-center mb-4">
                            <h3 class="h4 mb-1">Situaciones Laborales</h3>
                            <p class="text-secondary">¬øC√≥mo actuar√≠a en las siguientes situaciones?</p>
                        </div>
                        
                        <div id="situationsQuestions"></div>
                        
                        <div class="form-footer">
                            <button type="button" class="btn btn-secondary" onclick="prevSection()">
                                <svg xmlns="http://www.w3.org/2000/svg" class="icon" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
                                    <path stroke="none" d="m0 0h24v24H0z" fill="none"/>
                                    <path d="M5 12l14 0"/>
                                    <path d="M5 18l6 -6"/>
                                    <path d="M5 6l6 6"/>
                                </svg>
                                Anterior
                            </button>
                            <button type="button" class="btn btn-primary" onclick="nextSection()">
                                Continuar
                                <svg xmlns="http://www.w3.org/2000/svg" class="icon" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
                                    <path stroke="none" d="m0 0h24v24H0z" fill="none"/>
                                    <path d="M5 12l14 0"/>
                                    <path d="M13 18l6 -6"/>
                                    <path d="M13 6l6 6"/>
                                </svg>
                            </button>
                        </div>
                    </div>
                    
                    <!-- Section 4: Aptitudes T√©cnicas -->
                    <div class="section" id="section4">
                        <div class="text-center mb-4">
                            <h3 class="h4 mb-1">Aptitudes T√©cnicas</h3>
                            <p class="text-secondary">Eval√∫e su experiencia en las siguientes √°reas</p>
                        </div>
                        
                        <div id="aptitudesQuestions"></div>
                        
                        <div class="form-footer">
                            <button type="button" class="btn btn-secondary" onclick="prevSection()">
                                <svg xmlns="http://www.w3.org/2000/svg" class="icon" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
                                    <path stroke="none" d="m0 0h24v24H0z" fill="none"/>
                                    <path d="M5 12l14 0"/>
                                    <path d="M5 18l6 -6"/>
                                    <path d="M5 6l6 6"/>
                                </svg>
                                Anterior
                            </button>
                            <button type="button" class="btn btn-success" onclick="submitForm()">
                                <svg xmlns="http://www.w3.org/2000/svg" class="icon" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
                                    <path stroke="none" d="m0 0h24v24H0z" fill="none"/>
                                    <path d="M5 12l14 0"/>
                                    <path d="M13 18l6 -6"/>
                                    <path d="M13 6l6 6"/>
                                </svg>
                                Finalizar Evaluaci√≥n
                            </button>
                        </div>
                    </div>
                    
                </div>
            </div>
            
            <!-- Footer -->
            <div class="text-center text-secondary mt-3">
                <small>Sistema de Evaluaci√≥n Psicom√©trica v2.0</small>
            </div>
            
        </div>
    </div>
    
    <!-- JavaScript -->
    <script>
        // Current section tracking
        let currentSection = 1;
        let totalSections = 4;
        
        // Test data storage
        let testData = {
            cleaver: {},
            kostick: {},
            situations: {},
            aptitudes: {}
        };
        
        // CLEAVER questions data
        const CLEAVER_QUESTIONS = [
            { A: "Aventurero", B: "Adaptable", C: "Animoso", D: "Anal√≠tico" },
            { A: "Persistente", B: "Juguet√≥n", C: "Persuasivo", D: "Pl√°cido" },
            { A: "Sumiso", B: "Sociable", C: "Fuerte", D: "Seguro de s√≠ mismo" },
            { A: "Considerado", B: "Controlado", C: "Competitivo", D: "Convincente" },
            { A: "Refrescante", B: "Reservado", C: "Recursivo", D: "Respetuoso" },
            { A: "Satisfecho", B: "Sensitivo", C: "Seguro", D: "Sencillo" },
            { A: "Calmado", B: "Confiado", C: "Convencedor", D: "Coherente" },
            { A: "Paciente", B: "Positivo", C: "Promotor", D: "Perfeccionista" }
        ];
        
        // KOSTICK questions
        const KOSTICK_QUESTIONS = [
            "Me gusta trabajar en equipo m√°s que trabajar solo",
            "Prefiero seguir instrucciones claras antes que improvisar",
            "Me motiva m√°s ayudar a otros que obtener reconocimiento personal",
            "Trabajo mejor bajo presi√≥n y con plazos ajustados",
            "Prefiero planificar detalladamente antes de actuar", // Cr√≠tica
            "Me adapto f√°cilmente a los cambios en el trabajo",
            "Me gusta asumir responsabilidades de liderazgo",
            "Prefiero trabajos que requieren atenci√≥n al detalle",
            "Me siento c√≥modo tomando decisiones r√°pidas",
            "Disfruto de tareas que requieren creatividad e innovaci√≥n",
            "Prefiero un ambiente de trabajo estructurado y predecible", // Cr√≠tica  
            "Me gusta competir y superar a mis compa√±eros",
            "Considero m√°s importante la calidad que la velocidad", // Cr√≠tica
            "Me motivan los desaf√≠os t√©cnicos complejos",
            "Prefiero trabajar con personas conocidas que con extra√±os"
        ];
        
        // Situational questions
        const SITUATIONS = [
            {
                scenario: "üö® Su supervisor le pide que termine un trabajo urgente, pero nota que faltan materiales importantes. El supervisor no est√° disponible para consultar.",
                options: {
                    A: "Busco materiales alternativos y completo el trabajo lo mejor posible",
                    B: "Espero a que regrese el supervisor para consultarle",
                    C: "Busco a otro supervisor para que me autorice los materiales",
                    D: "Improviso con lo que tengo aunque el resultado no sea el mejor"
                },
                critical: true
            },
            {
                scenario: "Un compa√±ero de trabajo constantemente llega tarde y usted tiene que cubrir su trabajo extra.",
                options: {
                    A: "Hablo directamente con el compa√±ero sobre el problema",
                    B: "Reporto la situaci√≥n a mi supervisor inmediatamente",
                    C: "Contin√∫o cubriendo sin decir nada para mantener la armon√≠a",
                    D: "Busco una soluci√≥n que beneficie al equipo completo"
                },
                critical: false
            },
            {
                scenario: "Encuentra un error importante en el trabajo de un compa√±ero que ya fue entregado al cliente.",
                options: {
                    A: "Informo inmediatamente a mi supervisor sobre el error",
                    B: "Hablo primero con el compa√±ero para que corrija su error",
                    C: "Corrijo discretamente el error sin mencionarlo",
                    D: "Documento el error pero no tomo acci√≥n inmediata"
                },
                critical: false
            },
            {
                scenario: "üö® Le ofrecen un soborno para aprobar un trabajo que no cumple con los est√°ndares de calidad.",
                options: {
                    A: "Rechazo el soborno y reporto el incidente inmediatamente",
                    B: "Rechazo el soborno pero no reporto para evitar problemas",
                    C: "Acepto el dinero pero me aseguro de que el trabajo se corrija",
                    D: "Acepto el dinero y apruebo el trabajo para evitar conflictos"
                },
                critical: true
            }
        ];
        
        // Technical aptitudes
        const APTITUDES = [
            "Soldadura con electrodo",
            "Instalaciones el√©ctricas b√°sicas",
            "Manejo de herramientas el√©ctricas",
            "Lectura de planos t√©cnicos",
            "Trabajo en alturas",
            "Instalaci√≥n de letreros luminosos",
            "Mantenimiento preventivo",
            "Trabajo con tubos de ne√≥n/LED"
        ];
        
        // Initialize form
        function initializeForm() {
            generateCleaverQuestions();
            generateKostickQuestions();
            generateSituationsQuestions();
            generateAptitudesQuestions();
            loadSavedData();
            startAutoSave();
        }
        
        // Generate CLEAVER questions
        function generateCleaverQuestions() {
            const container = document.getElementById('cleaverQuestions');
            
            CLEAVER_QUESTIONS.forEach((question, index) => {
                const questionCard = document.createElement('div');
                questionCard.className = 'question-card';
                
                questionCard.innerHTML = `
                    <div class="question-header">
                        <span class="question-number">Pregunta ${index + 1}</span>
                    </div>
                    <div class="question-body">
                        <div class="cleaver-words">
                            <div class="word-card" data-option="A" data-question="${index}">
                                <div class="word-letter">A</div>
                                <div class="word-text">${question.A}</div>
                            </div>
                            <div class="word-card" data-option="B" data-question="${index}">
                                <div class="word-letter">B</div>
                                <div class="word-text">${question.B}</div>
                            </div>
                            <div class="word-card" data-option="C" data-question="${index}">
                                <div class="word-letter">C</div>
                                <div class="word-text">${question.C}</div>
                            </div>
                            <div class="word-card" data-option="D" data-question="${index}">
                                <div class="word-letter">D</div>
                                <div class="word-text">${question.D}</div>
                            </div>
                        </div>
                        
                        <div class="choice-section">
                            <div class="choice-grid">
                                <div class="choice-column">
                                    <div class="choice-label mas">
                                        üîµ M√ÅS describe
                                    </div>
                                    <div class="choice-buttons">
                                        <button type="button" class="choice-btn" data-type="mas" data-question="${index}" data-option="A">A</button>
                                        <button type="button" class="choice-btn" data-type="mas" data-question="${index}" data-option="B">B</button>
                                        <button type="button" class="choice-btn" data-type="mas" data-question="${index}" data-option="C">C</button>
                                        <button type="button" class="choice-btn" data-type="mas" data-question="${index}" data-option="D">D</button>
                                    </div>
                                </div>
                                
                                <div class="choice-separator"></div>
                                
                                <div class="choice-column">
                                    <div class="choice-label menos">
                                        üî¥ MENOS describe
                                    </div>
                                    <div class="choice-buttons">
                                        <button type="button" class="choice-btn" data-type="menos" data-question="${index}" data-option="A">A</button>
                                        <button type="button" class="choice-btn" data-type="menos" data-question="${index}" data-option="B">B</button>
                                        <button type="button" class="choice-btn" data-type="menos" data-question="${index}" data-option="C">C</button>
                                        <button type="button" class="choice-btn" data-type="menos" data-question="${index}" data-option="D">D</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
                
                container.appendChild(questionCard);
            });
            
            // Add event listeners for CLEAVER choices
            document.querySelectorAll('.choice-btn').forEach(btn => {
                btn.addEventListener('click', handleCleaverChoice);
            });
        }
        
        // Handle CLEAVER choice selection
        function handleCleaverChoice(event) {
            const button = event.target;
            const type = button.dataset.type;
            const question = parseInt(button.dataset.question);
            const option = button.dataset.option;
            
            // Remove selection from other buttons in the same group
            document.querySelectorAll(`[data-type="${type}"][data-question="${question}"]`)
                .forEach(btn => btn.classList.remove('selected'));
            
            // Add selection to clicked button
            button.classList.add('selected');
            
            // Save choice
            if (!testData.cleaver[question]) {
                testData.cleaver[question] = {};
            }
            testData.cleaver[question][type] = option;
            
            // Update word card styling
            updateCleaverWordCards(question);
            
            // Auto-save
            saveData();
        }
        
        // Update word card visual feedback
        function updateCleaverWordCards(questionIndex) {
            const questionData = testData.cleaver[questionIndex];
            if (!questionData) return;
            
            // Reset all cards for this question
            document.querySelectorAll(`[data-question="${questionIndex}"].word-card`)
                .forEach(card => {
                    card.classList.remove('selected-mas', 'selected-menos', 'selected-both');
                });
            
            // Apply styling based on selections
            if (questionData.mas) {
                const masCard = document.querySelector(`[data-question="${questionIndex}"][data-option="${questionData.mas}"].word-card`);
                if (masCard) masCard.classList.add('selected-mas');
            }
            
            if (questionData.menos) {
                const menosCard = document.querySelector(`[data-question="${questionIndex}"][data-option="${questionData.menos}"].word-card`);
                if (menosCard) menosCard.classList.add('selected-menos');
            }
            
            // Check for same selection (warning)
            if (questionData.mas === questionData.menos && questionData.mas) {
                const bothCard = document.querySelector(`[data-question="${questionIndex}"][data-option="${questionData.mas}"].word-card`);
                if (bothCard) {
                    bothCard.classList.remove('selected-mas', 'selected-menos');
                    bothCard.classList.add('selected-both');
                }
            }
        }
        
        // Generate KOSTICK questions
        function generateKostickQuestions() {
            const container = document.getElementById('kostickQuestions');
            
            KOSTICK_QUESTIONS.forEach((question, index) => {
                const isCritical = [4, 10, 12].includes(index);
                const questionCard = document.createElement('div');
                questionCard.className = 'question-card';
                if (isCritical) {
                    questionCard.style.borderLeft = '4px solid var(--warning-color)';
                }
                
                questionCard.innerHTML = `
                    <div class="question-header">
                        <span class="question-number">Pregunta ${index + 1}</span>
                        ${isCritical ? '<span class="badge bg-warning text-dark ms-2">‚ö†Ô∏è Importante</span>' : ''}
                    </div>
                    <div class="question-body">
                        <p class="mb-3">${question}</p>
                        
                        <div class="row g-2">
                            <div class="col">
                                <label class="form-selectgroup-item">
                                    <input type="radio" name="kostick_${index}" value="TD" class="form-selectgroup-input" onchange="updateKostickChoice(${index}, 'TD')">
                                    <span class="form-selectgroup-label">
                                        <strong>TD</strong><br>
                                        <small>Totalmente en Desacuerdo</small>
                                    </span>
                                </label>
                            </div>
                            <div class="col">
                                <label class="form-selectgroup-item">
                                    <input type="radio" name="kostick_${index}" value="D" class="form-selectgroup-input" onchange="updateKostickChoice(${index}, 'D')">
                                    <span class="form-selectgroup-label">
                                        <strong>D</strong><br>
                                        <small>En Desacuerdo</small>
                                    </span>
                                </label>
                            </div>
                            <div class="col">
                                <label class="form-selectgroup-item">
                                    <input type="radio" name="kostick_${index}" value="N" class="form-selectgroup-input" onchange="updateKostickChoice(${index}, 'N')">
                                    <span class="form-selectgroup-label">
                                        <strong>N</strong><br>
                                        <small>Neutral</small>
                                    </span>
                                </label>
                            </div>
                            <div class="col">
                                <label class="form-selectgroup-item">
                                    <input type="radio" name="kostick_${index}" value="A" class="form-selectgroup-input" onchange="updateKostickChoice(${index}, 'A')">
                                    <span class="form-selectgroup-label">
                                        <strong>A</strong><br>
                                        <small>De Acuerdo</small>
                                    </span>
                                </label>
                            </div>
                            <div class="col">
                                <label class="form-selectgroup-item">
                                    <input type="radio" name="kostick_${index}" value="TA" class="form-selectgroup-input" onchange="updateKostickChoice(${index}, 'TA')">
                                    <span class="form-selectgroup-label">
                                        <strong>TA</strong><br>
                                        <small>Totalmente de Acuerdo</small>
                                    </span>
                                </label>
                            </div>
                        </div>
                    </div>
                `;
                
                container.appendChild(questionCard);
            });
        }
        
        // Generate situational questions
        function generateSituationsQuestions() {
            const container = document.getElementById('situationsQuestions');
            
            SITUATIONS.forEach((situation, index) => {
                const questionCard = document.createElement('div');
                questionCard.className = 'question-card';
                if (situation.critical) {
                    questionCard.style.borderLeft = '4px solid var(--danger-color)';
                }
                
                questionCard.innerHTML = `
                    <div class="question-header">
                        <span class="question-number">Situaci√≥n ${index + 1}</span>
                        ${situation.critical ? '<span class="badge bg-danger ms-2">üö® Cr√≠tica</span>' : ''}
                    </div>
                    <div class="question-body">
                        <div class="alert alert-info mb-3">
                            ${situation.scenario}
                        </div>
                        
                        <p class="fw-bold mb-3">¬øQu√© har√≠a?</p>
                        
                        <div class="form-selectgroup form-selectgroup-boxes d-flex flex-column">
                            <label class="form-selectgroup-item">
                                <input type="radio" name="situation_${index}" value="A" class="form-selectgroup-input" onchange="updateSituationChoice(${index}, 'A')">
                                <span class="form-selectgroup-label d-flex align-items-center p-3">
                                    <span class="me-3">
                                        <span class="form-selectgroup-check"></span>
                                    </span>
                                    <span>
                                        <strong>A)</strong> ${situation.options.A}
                                    </span>
                                </span>
                            </label>
                            <label class="form-selectgroup-item">
                                <input type="radio" name="situation_${index}" value="B" class="form-selectgroup-input" onchange="updateSituationChoice(${index}, 'B')">
                                <span class="form-selectgroup-label d-flex align-items-center p-3">
                                    <span class="me-3">
                                        <span class="form-selectgroup-check"></span>
                                    </span>
                                    <span>
                                        <strong>B)</strong> ${situation.options.B}
                                    </span>
                                </span>
                            </label>
                            <label class="form-selectgroup-item">
                                <input type="radio" name="situation_${index}" value="C" class="form-selectgroup-input" onchange="updateSituationChoice(${index}, 'C')">
                                <span class="form-selectgroup-label d-flex align-items-center p-3">
                                    <span class="me-3">
                                        <span class="form-selectgroup-check"></span>
                                    </span>
                                    <span>
                                        <strong>C)</strong> ${situation.options.C}
                                    </span>
                                </span>
                            </label>
                            <label class="form-selectgroup-item">
                                <input type="radio" name="situation_${index}" value="D" class="form-selectgroup-input" onchange="updateSituationChoice(${index}, 'D')">
                                <span class="form-selectgroup-label d-flex align-items-center p-3">
                                    <span class="me-3">
                                        <span class="form-selectgroup-check"></span>
                                    </span>
                                    <span>
                                        <strong>D)</strong> ${situation.options.D}
                                    </span>
                                </span>
                            </label>
                        </div>
                    </div>
                `;
                
                container.appendChild(questionCard);
            });
        }
        
        // Generate aptitudes questions
        function generateAptitudesQuestions() {
            const container = document.getElementById('aptitudesQuestions');
            
            APTITUDES.forEach((aptitude, index) => {
                const questionCard = document.createElement('div');
                questionCard.className = 'question-card';
                
                questionCard.innerHTML = `
                    <div class="question-header">
                        <span class="question-number">Aptitud ${index + 1}</span>
                    </div>
                    <div class="question-body">
                        <p class="mb-3"><strong>${aptitude}</strong></p>
                        <p class="text-secondary mb-3">¬øCu√°l es su nivel de experiencia en esta √°rea?</p>
                        
                        <div class="row g-2">
                            <div class="col-6 col-md">
                                <label class="form-selectgroup-item">
                                    <input type="radio" name="aptitud_${index}" value="0" class="form-selectgroup-input" onchange="updateAptitudeChoice(${index}, '0')">
                                    <span class="form-selectgroup-label">
                                        <strong>Sin experiencia</strong><br>
                                        <small class="text-secondary">Nunca lo he hecho</small>
                                    </span>
                                </label>
                            </div>
                            <div class="col-6 col-md">
                                <label class="form-selectgroup-item">
                                    <input type="radio" name="aptitud_${index}" value="1" class="form-selectgroup-input" onchange="updateAptitudeChoice(${index}, '1')">
                                    <span class="form-selectgroup-label">
                                        <strong>B√°sico</strong><br>
                                        <small class="text-secondary">He observado o ayudado</small>
                                    </span>
                                </label>
                            </div>
                            <div class="col-6 col-md">
                                <label class="form-selectgroup-item">
                                    <input type="radio" name="aptitud_${index}" value="2" class="form-selectgroup-input" onchange="updateAptitudeChoice(${index}, '2')">
                                    <span class="form-selectgroup-label">
                                        <strong>Intermedio</strong><br>
                                        <small class="text-secondary">Puedo hacerlo con supervisi√≥n</small>
                                    </span>
                                </label>
                            </div>
                            <div class="col-6 col-md">
                                <label class="form-selectgroup-item">
                                    <input type="radio" name="aptitud_${index}" value="3" class="form-selectgroup-input" onchange="updateAptitudeChoice(${index}, '3')">
                                    <span class="form-selectgroup-label">
                                        <strong>Avanzado</strong><br>
                                        <small class="text-secondary">Trabajo independientemente</small>
                                    </span>
                                </label>
                            </div>
                            <div class="col-6 col-md">
                                <label class="form-selectgroup-item">
                                    <input type="radio" name="aptitud_${index}" value="4" class="form-selectgroup-input" onchange="updateAptitudeChoice(${index}, '4')">
                                    <span class="form-selectgroup-label">
                                        <strong>Experto</strong><br>
                                        <small class="text-secondary">Puedo ense√±ar a otros</small>
                                    </span>
                                </label>
                            </div>
                        </div>
                    </div>
                `;
                
                container.appendChild(questionCard);
            });
        }
        
        // Handle choice updates
        function updateKostickChoice(questionIndex, value) {
            testData.kostick[questionIndex] = value;
            saveData();
        }
        
        function updateSituationChoice(questionIndex, value) {
            testData.situations[questionIndex] = value;
            saveData();
        }
        
        function updateAptitudeChoice(questionIndex, value) {
            testData.aptitudes[questionIndex] = value;
            saveData();
        }
        
        // Navigation functions
        function nextSection() {
            if (currentSection < totalSections) {
                // Validate current section before proceeding
                if (!validateCurrentSection()) {
                    return;
                }
                
                // Hide current section
                document.getElementById(`section${currentSection}`).classList.remove('active');
                
                // Update progress
                document.getElementById(`step${currentSection}`).classList.remove('active');
                document.getElementById(`step${currentSection}`).classList.add('completed');
                if (currentSection < totalSections) {
                    document.getElementById(`line${currentSection}`).classList.add('completed');
                }
                
                // Show next section
                currentSection++;
                document.getElementById(`section${currentSection}`).classList.add('active');
                document.getElementById(`step${currentSection}`).classList.add('active');
                
                // Scroll to top
                window.scrollTo(0, 0);
            }
        }
        
        // Validate current section
        function validateCurrentSection() {
            switch (currentSection) {
                case 1: // CLEAVER
                    return validateCleaverSection();
                case 2: // KOSTICK
                    return validateKostickSection();
                case 3: // SITUATIONS
                    return validateSituationsSection();
                case 4: // APTITUDES
                    return validateAptitudesSection();
                default:
                    return true;
            }
        }
        
        function validateCleaverSection() {
            const totalQuestions = CLEAVER_QUESTIONS.length;
            const completedQuestions = Object.keys(testData.cleaver || {}).filter(questionIndex => {
                const questionData = testData.cleaver[questionIndex];
                return questionData && questionData.mas && questionData.menos;
            }).length;
            
            if (completedQuestions < totalQuestions) {
                alert(`Por favor complete todas las preguntas. Completadas: ${completedQuestions}/${totalQuestions}`);
                return false;
            }
            return true;
        }
        
        function validateKostickSection() {
            const totalQuestions = KOSTICK_QUESTIONS.length;
            const completedQuestions = Object.keys(testData.kostick || {}).length;
            
            if (completedQuestions < totalQuestions) {
                alert(`Por favor complete todas las preguntas. Completadas: ${completedQuestions}/${totalQuestions}`);
                return false;
            }
            return true;
        }
        
        function validateSituationsSection() {
            const totalQuestions = SITUATIONS.length;
            const completedQuestions = Object.keys(testData.situations || {}).length;
            
            if (completedQuestions < totalQuestions) {
                alert(`Por favor complete todas las situaciones. Completadas: ${completedQuestions}/${totalQuestions}`);
                return false;
            }
            return true;
        }
        
        function validateAptitudesSection() {
            const totalQuestions = APTITUDES.length;
            const completedQuestions = Object.keys(testData.aptitudes || {}).length;
            
            if (completedQuestions < totalQuestions) {
                alert(`Por favor complete todas las aptitudes. Completadas: ${completedQuestions}/${totalQuestions}`);
                return false;
            }
            return true;
        }
        
        function prevSection() {
            if (currentSection > 1) {
                // Hide current section
                document.getElementById(`section${currentSection}`).classList.remove('active');
                document.getElementById(`step${currentSection}`).classList.remove('active');
                
                // Update progress
                currentSection--;
                document.getElementById(`step${currentSection}`).classList.remove('completed');
                document.getElementById(`step${currentSection}`).classList.add('active');
                if (currentSection < totalSections) {
                    document.getElementById(`line${currentSection}`).classList.remove('completed');
                }
                
                // Show previous section
                document.getElementById(`section${currentSection}`).classList.add('active');
                
                // Scroll to top
                window.scrollTo(0, 0);
            }
        }
        
        // Auto-save functionality
        function startAutoSave() {
            setInterval(saveData, 30000); // Save every 30 seconds
        }
        
        function saveData() {
            try {
                localStorage.setItem('evaluacion_psicometrica', JSON.stringify(testData));
                showSaveIndicator();
            } catch (error) {
                console.error('Error saving data:', error);
            }
        }
        
        function loadSavedData() {
            try {
                const saved = localStorage.getItem('evaluacion_psicometrica');
                if (saved) {
                    testData = JSON.parse(saved);
                    restoreUIState();
                }
            } catch (error) {
                console.error('Error loading data:', error);
            }
        }
        
        function restoreUIState() {
            // Restore CLEAVER selections
            Object.keys(testData.cleaver || {}).forEach(questionIndex => {
                const questionData = testData.cleaver[questionIndex];
                
                if (questionData.mas) {
                    const masBtn = document.querySelector(`[data-type="mas"][data-question="${questionIndex}"][data-option="${questionData.mas}"]`);
                    if (masBtn) masBtn.classList.add('selected');
                }
                
                if (questionData.menos) {
                    const menosBtn = document.querySelector(`[data-type="menos"][data-question="${questionIndex}"][data-option="${questionData.menos}"]`);
                    if (menosBtn) menosBtn.classList.add('selected');
                }
                
                updateCleaverWordCards(parseInt(questionIndex));
            });
            
            // Restore KOSTICK selections
            Object.keys(testData.kostick || {}).forEach(questionIndex => {
                const value = testData.kostick[questionIndex];
                const radio = document.querySelector(`input[name="kostick_${questionIndex}"][value="${value}"]`);
                if (radio) radio.checked = true;
            });
            
            // Restore SITUATIONS selections
            Object.keys(testData.situations || {}).forEach(questionIndex => {
                const value = testData.situations[questionIndex];
                const radio = document.querySelector(`input[name="situation_${questionIndex}"][value="${value}"]`);
                if (radio) radio.checked = true;
            });
            
            // Restore APTITUDES selections
            Object.keys(testData.aptitudes || {}).forEach(questionIndex => {
                const value = testData.aptitudes[questionIndex];
                const radio = document.querySelector(`input[name="aptitud_${questionIndex}"][value="${value}"]`);
                if (radio) radio.checked = true;
            });
        }
        
        function showSaveIndicator() {
            const indicator = document.getElementById('saveIndicator');
            indicator.style.display = 'block';
            setTimeout(() => {
                indicator.style.display = 'none';
            }, 2000);
        }
        
        function submitForm() {
            // Final validation
            if (!validateCurrentSection()) {
                return;
            }
            
            // Show completion confirmation
            const confirmSubmit = confirm('¬øEst√° seguro de que desea finalizar la evaluaci√≥n? No podr√° hacer cambios despu√©s de enviarla.');
            
            if (confirmSubmit) {
                // Prepare data for submission
                const submissionData = {
                    timestamp: new Date().toISOString(),
                    cleaver: testData.cleaver,
                    kostick: testData.kostick,
                    situations: testData.situations,
                    aptitudes: testData.aptitudes,
                    metadata: {
                        userAgent: navigator.userAgent,
                        screenResolution: `${screen.width}x${screen.height}`,
                        timeZone: Intl.DateTimeFormat().resolvedOptions().timeZone
                    }
                };
                
                // Save final submission
                localStorage.setItem('evaluacion_psicometrica_final', JSON.stringify(submissionData));
                
                // Show success message
                alert('‚úÖ Evaluaci√≥n completada exitosamente. Gracias por su tiempo.');
                
                // Here you would normally submit to server
                console.log('Submission data:', submissionData);
                
                // Optional: redirect to thank you page
                // window.location.href = 'gracias.html';
            }
        }
        
        // Initialize when DOM is loaded
        document.addEventListener('DOMContentLoaded', initializeForm);
    </script>
</body>
</html>